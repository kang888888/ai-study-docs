{
  "title": "æ¨¡å‹åˆå¹¶ï¼ˆModel Mergingï¼‰",
  "subtitle": "æ— éœ€é‡æ–°è®­ç»ƒå³å¯ç»„åˆå¤šä¸ªå¤§è¯­è¨€æ¨¡å‹ä¼˜åŠ¿çš„æŠ€æœ¯ï¼Œé€šè¿‡MergeKitç­‰å·¥å…·å¯ä»¥è½»æ¾åˆ›å»ºå®šåˆ¶æ¨¡å‹ã€‚",
  "content": [
    {
      "type": "section",
      "title": "ğŸ“– æ ¸å¿ƒæ¦‚å¿µ",
      "content": [
        {
          "type": "desc-box",
          "content": [
            "æ¨¡å‹åˆå¹¶æ˜¯ä¸€ç§æ— éœ€é‡æ–°è®­ç»ƒå³å¯ç»„åˆå¤šä¸ªé¢„è®­ç»ƒæ¨¡å‹ä¼˜åŠ¿çš„æŠ€æœ¯ã€‚é€šè¿‡å‚æ•°ç©ºé—´æ“ä½œã€ä»»åŠ¡å‘é‡æå–æˆ–åˆ†å±‚ç­–ç•¥ï¼Œå¯ä»¥å°†ä¸åŒæ¨¡å‹çš„ä¸“é•¿èåˆåˆ°ä¸€ä¸ªç»Ÿä¸€æ¨¡å‹ä¸­ï¼Œå®ç°å¤šä»»åŠ¡èƒ½åŠ›æˆ–æ€§èƒ½æå‡ã€‚"
          ]
        }
      ]
    },
    {
      "type": "section",
      "title": "ğŸ“Š æ¶æ„å›¾è§£",
      "content": [
        {
          "type": "diagram-gallery",
          "images": [
            {
              "type": "svg-d3",
              "component": "GenericDiagram",
              "caption": "æ¨¡å‹åˆå¹¶æ–¹æ³•",
              "width": 1000,
              "height": 800,
              "interactive": true,
              "props": {
                "type": "concept",
                "title": "æ¨¡å‹åˆå¹¶æ–¹æ³•",
                "data": null
              }
            },
            {
              "type": "svg-d3",
              "component": "GenericDiagram",
              "caption": "æ¨¡å‹åˆå¹¶å¯¹æ¯”",
              "width": 1000,
              "height": 800,
              "interactive": true,
              "props": {
                "type": "comparison",
                "title": "æ¨¡å‹åˆå¹¶å¯¹æ¯”",
                "data": null
              }
            },
            {
              "type": "svg-d3",
              "component": "GenericDiagram",
              "caption": "åˆå¹¶æµç¨‹",
              "width": 1000,
              "height": 800,
              "interactive": true,
              "props": {
                "type": "flow",
                "title": "åˆå¹¶æµç¨‹",
                "data": null
              }
            }
          ]
        }
      ]
    },
    {
      "type": "section",
      "title": "ğŸŒŸ æ ¸å¿ƒç‰¹ç‚¹",
      "content": [
        {
          "type": "features",
          "items": [
            "æ— éœ€GPUè®­ç»ƒï¼šåœ¨CPUä¸Šå®Œæˆæ¨¡å‹åˆå¹¶ï¼Œèµ„æºæ¶ˆè€—ä½",
            "å¤šç§ç­–ç•¥ï¼šæ”¯æŒçº¿æ€§åˆå¹¶ã€ä»»åŠ¡å‘é‡åˆå¹¶ã€åˆ†å±‚åˆå¹¶ç­‰å¤šç§æ–¹æ³•",
            "çµæ´»ç»„åˆï¼šå¯ä»¥ç»„åˆä¸åŒæ¨¡å‹çš„ä¼˜åŠ¿ï¼Œå®ç°å¤šä»»åŠ¡èƒ½åŠ›",
            "å¿«é€Ÿå®éªŒï¼šæ— éœ€é‡æ–°è®­ç»ƒï¼Œå¿«é€Ÿå°è¯•ä¸åŒæ¨¡å‹ç»„åˆ",
            "ä¿æŒæ€§èƒ½ï¼šåˆå¹¶åçš„æ¨¡å‹é€šå¸¸èƒ½ä¿æŒæˆ–æ¥è¿‘åŸå§‹æ¨¡å‹çš„æ€§èƒ½",
            "å·¥å…·æ”¯æŒï¼šMergeKitç­‰å·¥å…·ç®€åŒ–åˆå¹¶æµç¨‹ï¼Œæ”¯æŒå¤šç§æ ¼å¼"
          ]
        }
      ]
    },
    {
      "type": "section",
      "title": "ğŸ”§ åˆå¹¶æ–¹æ³•",
      "content": [
        {
          "type": "desc-box",
          "content": [
            "æ¨¡å‹åˆå¹¶æœ‰å¤šç§æ–¹æ³•ï¼Œæ¯ç§æ–¹æ³•é€‚ç”¨äºä¸åŒçš„åœºæ™¯ï¼š"
          ]
        },
        {
          "type": "features",
          "items": [
            "çº¿æ€§åˆå¹¶ï¼ˆLinear Mergeï¼‰ï¼šç®€å•çš„åŠ æƒå¹³å‡ï¼Œé€‚åˆç›¸ä¼¼æ¶æ„çš„æ¨¡å‹",
            "ä»»åŠ¡å‘é‡åˆå¹¶ï¼ˆTask Vector Mergeï¼‰ï¼šåŸºäºä»»åŠ¡å‘é‡çš„åˆå¹¶ï¼Œé€‚åˆä»»åŠ¡ç‰¹åŒ–æ¨¡å‹",
            "åˆ†å±‚åˆå¹¶ï¼ˆLayer-wise Mergeï¼‰ï¼šå¯¹ä¸åŒå±‚ä½¿ç”¨ä¸åŒç­–ç•¥ï¼Œç²¾ç»†æ§åˆ¶åˆå¹¶è¿‡ç¨‹",
            "å‚æ•°ç©ºé—´åˆå¹¶ï¼ˆParameter Space Mergeï¼‰ï¼šç›´æ¥å¯¹æ¨¡å‹å‚æ•°è¿›è¡Œç®—æœ¯æ“ä½œ",
            "åŠŸèƒ½é”šç‚¹åˆå¹¶ï¼ˆFunctional Anchor Mergeï¼‰ï¼šåˆ©ç”¨åŠŸèƒ½é”šç‚¹æ•æ‰ä»»åŠ¡ç‰¹å®šåŠŸèƒ½å˜åŒ–"
          ]
        }
      ]
    },
    {
      "type": "section",
      "title": "ğŸ“ æ•°å­¦åŸç†",
      "content": [
        {
          "type": "math-box",
          "title": "çº¿æ€§åˆå¹¶",
          "formulas": [
            {
              "display": "\\theta_{merged} = \\sum_{i=1}^{n} w_i \\theta_i"
            },
            {
              "text": "å…¶ä¸­ $w_i$ æ˜¯ç¬¬ $i$ ä¸ªæ¨¡å‹çš„æƒé‡ï¼Œ$\\theta_i$ æ˜¯ç¬¬ $i$ ä¸ªæ¨¡å‹çš„å‚æ•°ï¼Œé€šå¸¸ $\\sum_{i=1}^{n} w_i = 1$ã€‚",
              "inline": "w_i"
            }
          ]
        },
        {
          "type": "math-box",
          "title": "ä»»åŠ¡å‘é‡åˆå¹¶",
          "formulas": [
            {
              "display": "\\tau = \\theta_{fine-tuned} - \\theta_{base}"
            },
            {
              "text": "ä»»åŠ¡å‘é‡ $\\tau$ è¡¨ç¤ºå¾®è°ƒæ¨¡å‹ä¸åŸºç¡€æ¨¡å‹çš„å·®å¼‚ï¼Œåˆå¹¶æ—¶ï¼š",
              "inline": "\\tau"
            },
            {
              "display": "\\theta_{merged} = \\theta_{base} + \\sum_{i=1}^{n} \\alpha_i \\tau_i"
            },
            {
              "text": "å…¶ä¸­ $\\alpha_i$ æ§åˆ¶ä¸åŒä»»åŠ¡å‘é‡çš„è´¡çŒ®ã€‚",
              "inline": "\\alpha_i"
            }
          ]
        },
        {
          "type": "math-box",
          "title": "åˆ†å±‚åˆå¹¶",
          "formulas": [
            {
              "display": "\\theta_{merged}^{(l)} = f_l(\\theta_1^{(l)}, \\theta_2^{(l)}, \\ldots, \\theta_n^{(l)})"
            },
            {
              "text": "å¯¹æ¯ä¸€å±‚ $l$ ä½¿ç”¨ä¸åŒçš„åˆå¹¶å‡½æ•° $f_l$ï¼Œå¯ä»¥æ˜¯åŠ æƒå¹³å‡ã€æœ€å¤§å€¼æˆ–å…¶ä»–ç­–ç•¥ã€‚",
              "inline": "f_l"
            }
          ]
        }
      ]
    },
    {
      "type": "section",
      "title": "ğŸ’» Python ä»£ç ç¤ºä¾‹",
      "content": [
        {
          "type": "code-box",
          "title": "ä½¿ç”¨MergeKitè¿›è¡Œæ¨¡å‹åˆå¹¶",
          "language": "python",
          "code": "# å®‰è£…MergeKit\n!pip install mergekit\n!pip install transformers torch\n\n# åŸºæœ¬åˆå¹¶é…ç½®\nmerge_config = {\n    \"models\": [\n        {\n            \"model\": \"microsoft/DialoGPT-medium\",\n            \"weight\": 0.5\n        },\n        {\n            \"model\": \"microsoft/DialoGPT-large\", \n            \"weight\": 0.5\n        }\n    ],\n    \"merge_method\": \"linear\",\n    \"output_path\": \"./merged_model\"\n}\n\n# æ‰§è¡Œåˆå¹¶\nfrom mergekit import MergeKit\nmerger = MergeKit()\nmerged_model = merger.merge(merge_config)"
        },
        {
          "type": "code-box",
          "title": "ä»»åŠ¡å‘é‡åˆå¹¶ç¤ºä¾‹",
          "language": "python",
          "code": "import torch\nfrom transformers import AutoModelForCausalLM\n\n# åŠ è½½åŸºç¡€æ¨¡å‹å’Œå¾®è°ƒæ¨¡å‹\nbase_model = AutoModelForCausalLM.from_pretrained(\"base-model\")\nft_model = AutoModelForCausalLM.from_pretrained(\"fine-tuned-model\")\n\n# è®¡ç®—ä»»åŠ¡å‘é‡\ntask_vector = {}\nfor key in base_model.state_dict():\n    task_vector[key] = ft_model.state_dict()[key] - base_model.state_dict()[key]\n\n# åˆå¹¶å¤šä¸ªä»»åŠ¡å‘é‡\nmerged_params = base_model.state_dict().copy()\nalphas = [0.3, 0.4, 0.3]  # ä¸åŒä»»åŠ¡çš„æƒé‡\ntask_vectors = [task_vector_1, task_vector_2, task_vector_3]\n\nfor key in merged_params:\n    merged_params[key] = base_model.state_dict()[key]\n    for alpha, tv in zip(alphas, task_vectors):\n        merged_params[key] += alpha * tv[key]\n\n# ä¿å­˜åˆå¹¶åçš„æ¨¡å‹\nmerged_model = AutoModelForCausalLM.from_pretrained(\"base-model\")\nmerged_model.load_state_dict(merged_params)\nmerged_model.save_pretrained(\"./merged_model\")"
        }
      ]
    },
    {
      "type": "section",
      "title": "ğŸš€ åº”ç”¨åœºæ™¯",
      "content": [
        {
          "type": "app-box",
          "content": "å¤šä»»åŠ¡å­¦ä¹ ï¼šé€šè¿‡åˆå¹¶å¤šä¸ªä»»åŠ¡ç‰¹å®šæ¨¡å‹ï¼Œåˆ›å»ºä¸€ä¸ªèƒ½å¤ŸåŒæ—¶å¤„ç†å¤šé¡¹ä»»åŠ¡çš„ç»Ÿä¸€æ¨¡å‹ã€‚æ¨¡å‹å‹ç¼©ï¼šå°†å¤šä¸ªæ¨¡å‹åˆå¹¶ä¸ºä¸€ä¸ªï¼Œä»¥å‡å°‘å­˜å‚¨å’Œè®¡ç®—èµ„æºçš„æ¶ˆè€—ã€‚æ€§èƒ½æå‡ï¼šç»„åˆä¸åŒæ¨¡å‹çš„ä¼˜åŠ¿ï¼Œå®ç°æ€§èƒ½æå‡ã€‚å¿«é€Ÿå®éªŒï¼šæ— éœ€é‡æ–°è®­ç»ƒï¼Œå¿«é€Ÿå°è¯•ä¸åŒæ¨¡å‹ç»„åˆã€‚"
        }
      ]
    },
    {
      "type": "section",
      "title": "âš ï¸ æ³¨æ„äº‹é¡¹",
      "content": [
        {
          "type": "features",
          "items": [
            "æ¨¡å‹æ¶æ„å…¼å®¹æ€§ï¼šåˆå¹¶çš„æ¨¡å‹éœ€è¦å…·æœ‰ç›¸åŒçš„æ¶æ„æˆ–å…¼å®¹çš„æ¶æ„",
            "ä»»åŠ¡å¹²æ‰°ï¼šä¸åŒä»»åŠ¡ä¹‹é—´å¯èƒ½å­˜åœ¨å¹²æ‰°ï¼Œå¯¼è‡´åˆå¹¶æ¨¡å‹æ€§èƒ½ä¸‹é™",
            "æ•°æ®å¼‚è´¨æ€§ï¼šæµ‹è¯•æ•°æ®çš„å¤šæ ·æ€§å¯èƒ½å½±å“åˆå¹¶æ¨¡å‹çš„é€‚åº”æ€§å’Œæ€§èƒ½",
            "æƒé‡é€‰æ‹©ï¼šéœ€è¦ä»”ç»†é€‰æ‹©å„æ¨¡å‹çš„æƒé‡ï¼Œä»¥è·å¾—æœ€ä½³æ€§èƒ½",
            "éªŒè¯æµ‹è¯•ï¼šåˆå¹¶åéœ€è¦è¿›è¡Œå……åˆ†çš„éªŒè¯æµ‹è¯•ï¼Œç¡®ä¿æ€§èƒ½ç¬¦åˆé¢„æœŸ"
          ]
        }
      ]
    }
  ]
}
