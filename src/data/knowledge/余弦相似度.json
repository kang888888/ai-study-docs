{
  "title": "ä½™å¼¦ç›¸ä¼¼åº¦ (Cosine Similarity)",
  "subtitle": "è¡¡é‡å‘é‡é—´å¤¹è§’çš„ç›¸ä¼¼åº¦åº¦é‡",
  "content": [
    {
      "type": "section",
      "title": "ğŸ“– æ ¸å¿ƒæ¦‚å¿µ",
      "content": [
        {
          "type": "desc-box",
          "content": [
            "ä½™å¼¦ç›¸ä¼¼åº¦é€šè¿‡è®¡ç®—ä¸¤ä¸ªå‘é‡çš„å¤¹è§’ä½™å¼¦å€¼æ¥è¡¡é‡å®ƒä»¬çš„ç›¸ä¼¼æ€§ï¼Œè€Œä¸è€ƒè™‘å‘é‡çš„é•¿åº¦ã€‚å®ƒå¹¿æ³›åº”ç”¨äºæ–‡æœ¬ç›¸ä¼¼åº¦ã€æ¨èç³»ç»Ÿã€ç‰¹å¾åŒ¹é…ç­‰åœºæ™¯ã€‚ä½™å¼¦ç›¸ä¼¼åº¦çš„å–å€¼èŒƒå›´æ˜¯[-1, 1]ï¼Œå€¼è¶Šå¤§è¡¨ç¤ºè¶Šç›¸ä¼¼ã€‚"
          ]
        }
      ]
    },
    {
      "type": "section",
      "title": "ğŸ“ æ•°å­¦è¡¨è¾¾",
      "content": [
        {
          "type": "math-box",
          "title": "ä½™å¼¦ç›¸ä¼¼åº¦å®šä¹‰",
          "formulas": [
            {
              "text": "ä½™å¼¦ç›¸ä¼¼åº¦å®šä¹‰ä¸ºï¼š"
            },
            {
              "display": "\\text{cos}(\\mathbf{x}, \\mathbf{y}) = \\frac{\\mathbf{x} \\cdot \\mathbf{y}}{||\\mathbf{x}|| \\cdot ||\\mathbf{y}||} = \\frac{\\sum_{i=1}^{n}x_i y_i}{\\sqrt{\\sum_{i=1}^{n}x_i^2} \\cdot \\sqrt{\\sum_{i=1}^{n}y_i^2}}"
            },
            {
              "text": "ç­‰ä»·äºå‘é‡å¤¹è§’çš„ä½™å¼¦å€¼ï¼š"
            },
            {
              "display": "\\text{cos}(\\mathbf{x}, \\mathbf{y}) = \\cos(\\theta)"
            },
            {
              "text": "å…¶ä¸­ $\\theta$ æ˜¯ä¸¤ä¸ªå‘é‡ä¹‹é—´çš„å¤¹è§’"
            }
          ]
        },
        {
          "type": "math-box",
          "title": "å½’ä¸€åŒ–å½¢å¼",
          "formulas": [
            {
              "text": "å¦‚æœå‘é‡å·²å½’ä¸€åŒ–ï¼ˆL2èŒƒæ•°ä¸º1ï¼‰ï¼Œåˆ™ï¼š"
            },
            {
              "display": "\\text{cos}(\\mathbf{x}, \\mathbf{y}) = \\mathbf{x} \\cdot \\mathbf{y}"
            },
            {
              "text": "æ­¤æ—¶ä½™å¼¦ç›¸ä¼¼åº¦ç­‰äºç‚¹ç§¯"
            }
          ]
        },
        {
          "type": "math-box",
          "title": "æ€§è´¨",
          "formulas": [
            {
              "text": "é‡è¦æ€§è´¨ï¼š"
            },
            {
              "text": "- å–å€¼èŒƒå›´ï¼š$[-1, 1]$"
            },
            {
              "text": "- å¯¹ç§°æ€§ï¼š$\\text{cos}(\\mathbf{x}, \\mathbf{y}) = \\text{cos}(\\mathbf{y}, \\mathbf{x})$"
            },
            {
              "text": "- å°ºåº¦ä¸å˜ï¼šåªè€ƒè™‘æ–¹å‘ï¼Œä¸è€ƒè™‘é•¿åº¦"
            },
            {
              "text": "- 1è¡¨ç¤ºå®Œå…¨ç›¸åŒæ–¹å‘ï¼Œ-1è¡¨ç¤ºå®Œå…¨ç›¸åæ–¹å‘ï¼Œ0è¡¨ç¤ºæ­£äº¤"
            }
          ]
        }
      ]
    },
    {
      "type": "section",
      "title": "ğŸŒŸ ç‰¹ç‚¹",
      "content": [
        {
          "type": "features",
          "items": [
            "å°ºåº¦ä¸å˜ï¼šåªè€ƒè™‘æ–¹å‘ï¼Œä¸å—å‘é‡é•¿åº¦å½±å“",
            "èŒƒå›´æ˜ç¡®ï¼š[-1, 1]çš„å›ºå®šèŒƒå›´ï¼Œæ˜“äºè§£é‡Š",
            "è®¡ç®—é«˜æ•ˆï¼šåªéœ€ç‚¹ç§¯å’ŒèŒƒæ•°è®¡ç®—",
            "å¹¿æ³›åº”ç”¨ï¼šæ–‡æœ¬ç›¸ä¼¼åº¦ã€æ¨èç³»ç»Ÿã€ç‰¹å¾åŒ¹é…",
            "å‡ ä½•ç›´è§‚ï¼šç›´æ¥å¯¹åº”å‘é‡å¤¹è§’"
          ]
        }
      ]
    },
    {
      "type": "section",
      "title": "ğŸ“Š å¯è§†åŒ–",
      "content": [
        {
          "type": "diagram-gallery",
          "images": [
            {
              "type": "svg-d3",
              "component": "MathFunctionDiagram",
              "caption": "ä½™å¼¦ç›¸ä¼¼åº¦å¯è§†åŒ–",
              "width": 1000,
              "height": 600,
              "interactive": true,
              "props": {
                "type": "distance",
                "title": "ä½™å¼¦ç›¸ä¼¼åº¦å¯è§†åŒ–"
              }
            }
          ]
        }
      ]
    },
    {
      "type": "section",
      "title": "ğŸš€ åº”ç”¨åœºæ™¯",
      "content": [
        {
          "type": "app-box",
          "content": "æ–‡æœ¬ç›¸ä¼¼åº¦è®¡ç®—ã€æ¨èç³»ç»Ÿã€ç‰¹å¾åŒ¹é…ã€è¯å‘é‡ç›¸ä¼¼åº¦ã€å›¾åƒæ£€ç´¢ã€CLIPç­‰å¯¹æ¯”å­¦ä¹ æ¨¡å‹"
        }
      ]
    },
    {
      "type": "section",
      "title": "ğŸ’» Python ä»£ç ç¤ºä¾‹",
      "content": [
        {
          "type": "code-box",
          "title": "ä½™å¼¦ç›¸ä¼¼åº¦å®ç°ä¸ä½¿ç”¨",
          "language": "python",
          "code": "import torch\nimport torch.nn.functional as F\nimport numpy as np\nfrom sklearn.metrics.pairwise import cosine_similarity\n\n# 1. åŸºç¡€å®ç°\ndef cosine_similarity_np(x, y):\n    \"\"\"è®¡ç®—ä¸¤ä¸ªå‘é‡çš„ä½™å¼¦ç›¸ä¼¼åº¦\"\"\"\n    dot_product = np.dot(x, y)\n    norm_x = np.linalg.norm(x)\n    norm_y = np.linalg.norm(y)\n    return dot_product / (norm_x * norm_y)\n\n# æµ‹è¯•\nx = np.array([1, 2, 3])\ny = np.array([2, 4, 6])  # y = 2xï¼Œæ–¹å‘ç›¸åŒ\nsimilarity = cosine_similarity_np(x, y)\nprint(f\"ä½™å¼¦ç›¸ä¼¼åº¦: {similarity:.4f}\")  # åº”è¯¥æ¥è¿‘1.0\n\n# 2. PyTorchå®ç°\nx_tensor = torch.tensor([1.0, 2.0, 3.0])\ny_tensor = torch.tensor([2.0, 4.0, 6.0])\nsimilarity_torch = F.cosine_similarity(x_tensor.unsqueeze(0), y_tensor.unsqueeze(0))\nprint(f\"PyTorchä½™å¼¦ç›¸ä¼¼åº¦: {similarity_torch.item():.4f}\")\n\n# 3. æ‰¹é‡è®¡ç®—ï¼ˆå¤šä¸ªå‘é‡å¯¹ï¼‰\n# è®¡ç®—çŸ©é˜µä¸­æ¯å¯¹å‘é‡çš„ä½™å¼¦ç›¸ä¼¼åº¦\nvectors = torch.randn(10, 128)  # [num_vectors, dim]\n# å½’ä¸€åŒ–\nvectors_norm = F.normalize(vectors, p=2, dim=1)\n# è®¡ç®—ç›¸ä¼¼åº¦çŸ©é˜µ\nsimilarity_matrix = torch.mm(vectors_norm, vectors_norm.t())\nprint(f\"ç›¸ä¼¼åº¦çŸ©é˜µå½¢çŠ¶: {similarity_matrix.shape}\")\nprint(f\"å¯¹è§’çº¿ï¼ˆè‡ªç›¸ä¼¼ï¼‰: {similarity_matrix.diag()}\")  # åº”è¯¥å…¨ä¸º1\n\n# 4. åœ¨æ¨èç³»ç»Ÿä¸­ä½¿ç”¨\n# ç”¨æˆ·ç‰¹å¾å‘é‡\nuser_features = torch.randn(100, 64)  # [num_users, feature_dim]\n# ç‰©å“ç‰¹å¾å‘é‡\nitem_features = torch.randn(1000, 64)  # [num_items, feature_dim]\n\n# å½’ä¸€åŒ–\nuser_norm = F.normalize(user_features, p=2, dim=1)\nitem_norm = F.normalize(item_features, p=2, dim=1)\n\n# è®¡ç®—ç”¨æˆ·-ç‰©å“ç›¸ä¼¼åº¦çŸ©é˜µ\nuser_item_similarity = torch.mm(user_norm, item_norm.t())  # [100, 1000]\nprint(f\"ç”¨æˆ·-ç‰©å“ç›¸ä¼¼åº¦çŸ©é˜µå½¢çŠ¶: {user_item_similarity.shape}\")\n\n# ä¸ºæ¯ä¸ªç”¨æˆ·æ¨èæœ€ç›¸ä¼¼çš„ç‰©å“\nuser_id = 0\ntop_k = 5\n_, top_items = torch.topk(user_item_similarity[user_id], k=top_k)\nprint(f\"ç”¨æˆ·{user_id}çš„Top-{top_k}æ¨èç‰©å“: {top_items}\")\n\n# 5. åœ¨æ–‡æœ¬ç›¸ä¼¼åº¦ä¸­ä½¿ç”¨\n# è¯å‘é‡ï¼ˆWord Embeddingsï¼‰\nword1 = torch.randn(300)  # 300ç»´è¯å‘é‡\nword2 = torch.randn(300)\nword3 = torch.randn(300)\n\n# è®¡ç®—è¯é—´ç›¸ä¼¼åº¦\nsim_12 = F.cosine_similarity(word1.unsqueeze(0), word2.unsqueeze(0))\nsim_13 = F.cosine_similarity(word1.unsqueeze(0), word3.unsqueeze(0))\nprint(f\"è¯1-è¯2ç›¸ä¼¼åº¦: {sim_12.item():.4f}\")\nprint(f\"è¯1-è¯3ç›¸ä¼¼åº¦: {sim_13.item():.4f}\")\n\n# 6. åœ¨CLIPç­‰å¯¹æ¯”å­¦ä¹ ä¸­ä½¿ç”¨\n# å›¾åƒç‰¹å¾å’Œæ–‡æœ¬ç‰¹å¾\nimage_features = torch.randn(32, 512)  # [batch_size, feature_dim]\ntext_features = torch.randn(32, 512)\n\n# å½’ä¸€åŒ–\nimage_norm = F.normalize(image_features, p=2, dim=1)\ntext_norm = F.normalize(text_features, p=2, dim=1)\n\n# è®¡ç®—ç›¸ä¼¼åº¦çŸ©é˜µï¼ˆå¯¹è§’çº¿æ˜¯åŒ¹é…å¯¹ï¼‰\nsimilarity = torch.mm(image_norm, text_norm.t())  # [32, 32]\nprint(f\"å›¾åƒ-æ–‡æœ¬ç›¸ä¼¼åº¦çŸ©é˜µå½¢çŠ¶: {similarity.shape}\")\n\n# 7. ä½™å¼¦è·ç¦»ï¼ˆ1 - ä½™å¼¦ç›¸ä¼¼åº¦ï¼‰\ndef cosine_distance(x, y):\n    return 1 - F.cosine_similarity(x.unsqueeze(0), y.unsqueeze(0))\n\n# 8. å®é™…åº”ç”¨ï¼šæŸ¥æ‰¾æœ€ç›¸ä¼¼çš„å‘é‡\nquery_vector = torch.randn(128)\ndatabase = torch.randn(1000, 128)  # æ•°æ®åº“ä¸­çš„å‘é‡\n\n# å½’ä¸€åŒ–\nquery_norm = F.normalize(query_vector.unsqueeze(0), p=2, dim=1)\ndb_norm = F.normalize(database, p=2, dim=1)\n\n# è®¡ç®—ä¸æ‰€æœ‰æ•°æ®åº“å‘é‡çš„ç›¸ä¼¼åº¦\nsimilarities = torch.mm(query_norm, db_norm.t()).squeeze(0)\n\n# æ‰¾åˆ°æœ€ç›¸ä¼¼çš„å‘é‡\nmost_similar_idx = torch.argmax(similarities)\nmost_similar_score = similarities[most_similar_idx]\nprint(f\"æœ€ç›¸ä¼¼å‘é‡ç´¢å¼•: {most_similar_idx.item()}\")\nprint(f\"ç›¸ä¼¼åº¦åˆ†æ•°: {most_similar_score.item():.4f}\")"
        }
      ]
    }
  ]
}
