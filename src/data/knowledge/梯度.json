{
  "title": "æ¢¯åº¦ (Gradient)",
  "subtitle": "æŸå¤±å‡½æ•°å¯¹å‚æ•°çš„åå¯¼æ•°ï¼ŒæŒ‡ç¤ºå‚æ•°æ›´æ–°çš„æ–¹å‘",
  "content": [
    {
      "type": "section",
      "title": "ğŸ“– æ ¸å¿ƒæ¦‚å¿µ",
      "content": [
        {
          "type": "desc-box",
          "content": [
            "æ¢¯åº¦æ˜¯å¤šå…ƒå‡½æ•°åœ¨æŸä¸€ç‚¹å¤„çš„åå¯¼æ•°å‘é‡ï¼Œåœ¨æ·±åº¦å­¦ä¹ ä¸­è¡¨ç¤ºæŸå¤±å‡½æ•°å¯¹æ¨¡å‹å‚æ•°çš„åå¯¼æ•°ã€‚æ¢¯åº¦æŒ‡ç¤ºäº†æŸå¤±å‡½æ•°å¢é•¿æœ€å¿«çš„æ–¹å‘ï¼Œè´Ÿæ¢¯åº¦æ–¹å‘åˆ™æ˜¯æŸå¤±å‡½æ•°ä¸‹é™æœ€å¿«çš„æ–¹å‘ï¼Œå› æ­¤æ¢¯åº¦ä¸‹é™æ³•é€šè¿‡æ²¿ç€è´Ÿæ¢¯åº¦æ–¹å‘æ›´æ–°å‚æ•°æ¥æœ€å°åŒ–æŸå¤±å‡½æ•°ã€‚"
          ]
        }
      ]
    },
    {
      "type": "section",
      "title": "ğŸŒŸ æ ¸å¿ƒç‰¹ç‚¹",
      "content": [
        {
          "type": "features",
          "items": [
            "æ–¹å‘æ€§ï¼šæ¢¯åº¦æŒ‡å‘å‡½æ•°å€¼å¢é•¿æœ€å¿«çš„æ–¹å‘",
            "å¤§å°ï¼šæ¢¯åº¦çš„æ¨¡é•¿è¡¨ç¤ºå˜åŒ–ç‡çš„å¤§å°",
            "é“¾å¼æ³•åˆ™ï¼šé€šè¿‡åå‘ä¼ æ’­è®¡ç®—æ·±å±‚ç½‘ç»œçš„æ¢¯åº¦",
            "æ¢¯åº¦æ¶ˆå¤±ï¼šæ·±å±‚ç½‘ç»œä¸­æ¢¯åº¦å¯èƒ½å˜å¾—æå°",
            "æ¢¯åº¦çˆ†ç‚¸ï¼šæ¢¯åº¦å¯èƒ½å˜å¾—æå¤§ï¼Œå¯¼è‡´è®­ç»ƒä¸ç¨³å®š"
          ]
        }
      ]
    },
    {
      "type": "section",
      "title": "âš™ï¸ å…³é”®æŠ€æœ¯",
      "content": [
        {
          "type": "tech-box",
          "content": "æ¢¯åº¦è®¡ç®—ã€é“¾å¼æ³•åˆ™ã€æ¢¯åº¦è£å‰ªã€æ¢¯åº¦ç´¯ç§¯ã€æ¢¯åº¦æ£€æŸ¥"
        }
      ]
    },
    {
      "type": "section",
      "title": "ğŸš€ åº”ç”¨åœºæ™¯",
      "content": [
        {
          "type": "app-box",
          "content": "å‚æ•°æ›´æ–°ã€ä¼˜åŒ–ç®—æ³•ã€æ¢¯åº¦ä¸‹é™ã€åå‘ä¼ æ’­ã€æ¨¡å‹è®­ç»ƒ"
        }
      ]
    },
    {
      "type": "section",
      "title": "ğŸ“Š æ¶æ„å›¾è§£",
      "content": [
        {
          "type": "diagram-gallery",
          "images": [
            {
              "type": "svg-d3",
              "component": "GenericDiagram",
              "caption": "æ¢¯åº¦ç¤ºæ„å›¾",
              "width": 1000,
              "height": 800,
              "interactive": true,
              "props": {
                "type": "concept",
                "title": "æ¢¯åº¦ç¤ºæ„å›¾"
              }
            }
          ]
        }
      ]
    },
    {
      "type": "section",
      "title": "ğŸ“ æ•°å­¦åŸç†",
      "content": [
        {
          "type": "math-box",
          "title": "æ¢¯åº¦å®šä¹‰",
          "formulas": [
            {
              "text": "å¯¹äºæŸå¤±å‡½æ•° $L(\\theta)$ï¼Œæ¢¯åº¦å®šä¹‰ä¸ºï¼š"
            },
            {
              "display": "\\nabla_\\theta L = \\left(\\frac{\\partial L}{\\partial \\theta_1}, \\frac{\\partial L}{\\partial \\theta_2}, \\ldots, \\frac{\\partial L}{\\partial \\theta_n}\\right)^T"
            },
            {
              "text": "å…¶ä¸­ $\\theta$ æ˜¯å‚æ•°å‘é‡ï¼Œ$n$ æ˜¯å‚æ•°æ•°é‡"
            }
          ]
        },
        {
          "type": "math-box",
          "title": "æ¢¯åº¦ä¸‹é™",
          "formulas": [
            {
              "text": "å‚æ•°æ›´æ–°å…¬å¼ï¼š"
            },
            {
              "display": "\\theta_{t+1} = \\theta_t - \\eta \\nabla_\\theta L(\\theta_t)"
            },
            {
              "text": "å…¶ä¸­ $\\eta$ æ˜¯å­¦ä¹ ç‡ï¼Œ$\\nabla_\\theta L$ æ˜¯æ¢¯åº¦",
              "inline": "\\eta"
            }
          ]
        },
        {
          "type": "math-box",
          "title": "é“¾å¼æ³•åˆ™",
          "formulas": [
            {
              "text": "å¯¹äºå¤åˆå‡½æ•° $L = f(g(x))$ï¼Œæ¢¯åº¦è®¡ç®—ï¼š"
            },
            {
              "display": "\\frac{\\partial L}{\\partial x} = \\frac{\\partial L}{\\partial g} \\cdot \\frac{\\partial g}{\\partial x}"
            },
            {
              "text": "åœ¨æ·±åº¦å­¦ä¹ ä¸­ï¼Œé€šè¿‡é“¾å¼æ³•åˆ™ä»è¾“å‡ºå±‚å‘è¾“å…¥å±‚åå‘ä¼ æ’­æ¢¯åº¦"
            }
          ]
        },
        {
          "type": "math-box",
          "title": "æ¢¯åº¦è£å‰ª",
          "formulas": [
            {
              "text": "é˜²æ­¢æ¢¯åº¦çˆ†ç‚¸ï¼Œå°†æ¢¯åº¦é™åˆ¶åœ¨é˜ˆå€¼å†…ï¼š"
            },
            {
              "display": "\\hat{g} = \\begin{cases} g & \\text{if } ||g|| \\leq c \\\\ c \\cdot \\frac{g}{||g||} & \\text{if } ||g|| > c \\end{cases}"
            },
            {
              "text": "å…¶ä¸­ $c$ æ˜¯è£å‰ªé˜ˆå€¼ï¼Œé€šå¸¸å– 1.0 æˆ– 5.0"
            }
          ]
        }
      ]
    },
    {
      "type": "section",
      "title": "ğŸ’» Python ä»£ç ç¤ºä¾‹",
      "content": [
        {
          "type": "code-box",
          "title": "PyTorch ä¸­çš„æ¢¯åº¦è®¡ç®—",
          "language": "python",
          "code": "import torch\nimport torch.nn as nn\n\n# 1. è‡ªåŠ¨æ¢¯åº¦è®¡ç®—\nx = torch.tensor([2.0], requires_grad=True)\ny = x ** 2 + 3 * x + 1\ny.backward()  # åå‘ä¼ æ’­\nprint(f\"æ¢¯åº¦å€¼: {x.grad}\")  # è¾“å‡º: tensor([7.]) å› ä¸º dy/dx = 2x + 3 = 7\n\n# 2. ç¥ç»ç½‘ç»œä¸­çš„æ¢¯åº¦\nmodel = nn.Linear(10, 1)\nx = torch.randn(32, 10)\ntarget = torch.randn(32, 1)\n\n# å‰å‘ä¼ æ’­\noutput = model(x)\nloss = nn.MSELoss()(output, target)\n\n# åå‘ä¼ æ’­\nloss.backward()\n\n# æŸ¥çœ‹æ¢¯åº¦\nprint(f\"æƒé‡æ¢¯åº¦å½¢çŠ¶: {model.weight.grad.shape}\")\nprint(f\"åç½®æ¢¯åº¦å½¢çŠ¶: {model.bias.grad.shape}\")\n\n# 3. æ¢¯åº¦è£å‰ª\noptimizer = torch.optim.SGD(model.parameters(), lr=0.01)\n\nfor epoch in range(100):\n    output = model(x)\n    loss = nn.MSELoss()(output, target)\n    \n    optimizer.zero_grad()\n    loss.backward()\n    \n    # æ¢¯åº¦è£å‰ª\n    torch.nn.utils.clip_grad_norm_(model.parameters(), max_norm=1.0)\n    \n    optimizer.step()\n\n# 4. æ¢¯åº¦ç´¯ç§¯ï¼ˆç”¨äºå¤§batchè®­ç»ƒï¼‰\naccumulation_steps = 4\noptimizer.zero_grad()\n\nfor i, (x_batch, y_batch) in enumerate(dataloader):\n    output = model(x_batch)\n    loss = criterion(output, y_batch) / accumulation_steps  # ç¼©æ”¾æŸå¤±\n    loss.backward()  # ç´¯ç§¯æ¢¯åº¦\n    \n    if (i + 1) % accumulation_steps == 0:\n        optimizer.step()  # æ›´æ–°å‚æ•°\n        optimizer.zero_grad()  # æ¸…é›¶æ¢¯åº¦\n\n# 5. æ£€æŸ¥æ¢¯åº¦ï¼ˆè°ƒè¯•ç”¨ï¼‰\ndef check_gradients(model):\n    \"\"\"æ£€æŸ¥æ¢¯åº¦æ˜¯å¦å­˜åœ¨å’Œæ˜¯å¦æ­£å¸¸\"\"\"\n    for name, param in model.named_parameters():\n        if param.grad is not None:\n            grad_norm = param.grad.norm().item()\n            if grad_norm == 0:\n                print(f\"è­¦å‘Š: {name} çš„æ¢¯åº¦ä¸ºé›¶\")\n            elif grad_norm > 100:\n                print(f\"è­¦å‘Š: {name} çš„æ¢¯åº¦å¯èƒ½çˆ†ç‚¸: {grad_norm}\")\n            else:\n                print(f\"{name}: æ¢¯åº¦èŒƒæ•° = {grad_norm:.4f}\")\n        else:\n            print(f\"è­¦å‘Š: {name} æ²¡æœ‰æ¢¯åº¦\")\n\n# ä½¿ç”¨ç¤ºä¾‹\ncheck_gradients(model)"
        }
      ]
    }
  ]
}