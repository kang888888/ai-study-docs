{
  "title": "åŠŸèƒ½é”šç‚¹åˆå¹¶ï¼ˆFunctional Anchor Mergeï¼‰",
  "subtitle": "é€šè¿‡åœ¨è¾“å…¥-è¡¨ç¤ºç©ºé—´ä¸­å»ºæ¨¡ï¼Œåˆ©ç”¨åŠŸèƒ½é”šç‚¹æ¥æ•æ‰ä»»åŠ¡ç‰¹å®šçš„åŠŸèƒ½å˜åŒ–ï¼Œå®ç°æ›´ç²¾ç¡®çš„æ¨¡å‹åˆå¹¶ã€‚",
  "content": [
    {
      "type": "section",
      "title": "ğŸ“– æ ¸å¿ƒæ¦‚å¿µ",
      "content": [
        {
          "type": "desc-box",
          "content": [
            "åŠŸèƒ½é”šç‚¹åˆå¹¶æ˜¯ä¸€ç§åŸºäºåŠŸèƒ½ç©ºé—´çš„æ¨¡å‹åˆå¹¶æ–¹æ³•ã€‚å®ƒé€šè¿‡åœ¨è¾“å…¥-è¡¨ç¤ºç©ºé—´ä¸­è¯†åˆ«åŠŸèƒ½é”šç‚¹ï¼ˆfunctional anchorsï¼‰æ¥æ•æ‰ä»»åŠ¡ç‰¹å®šçš„åŠŸèƒ½å˜åŒ–ï¼Œç„¶ååŸºäºè¿™äº›é”šç‚¹è¿›è¡Œæ¨¡å‹åˆå¹¶ã€‚è¿™ç§æ–¹æ³•èƒ½å¤Ÿæ›´ç²¾ç¡®åœ°æ•æ‰æ¨¡å‹çš„åŠŸèƒ½å˜åŒ–ï¼Œå‡å°‘ä»»åŠ¡ä¹‹é—´çš„å¹²æ‰°ã€‚"
          ]
        }
      ]
    },
    {
      "type": "section",
      "title": "ğŸ“Š æ¶æ„å›¾è§£",
      "content": [
        {
          "type": "diagram-gallery",
          "images": [
            {
              "type": "svg-d3",
              "component": "GenericDiagram",
              "caption": "åŠŸèƒ½é”šç‚¹è¯†åˆ«",
              "width": 1000,
              "height": 800,
              "interactive": true,
              "props": {
                "type": "architecture",
                "title": "åŠŸèƒ½é”šç‚¹è¯†åˆ«",
                "data": null
              }
            },
            {
              "type": "svg-d3",
              "component": "GenericDiagram",
              "caption": "åŠŸèƒ½ç©ºé—´æ˜ å°„",
              "width": 1000,
              "height": 800,
              "interactive": true,
              "props": {
                "type": "flow",
                "title": "åŠŸèƒ½ç©ºé—´æ˜ å°„",
                "data": null
              }
            },
            {
              "type": "svg-d3",
              "component": "GenericDiagram",
              "caption": "åŸºäºé”šç‚¹çš„åˆå¹¶",
              "width": 1000,
              "height": 800,
              "interactive": true,
              "props": {
                "type": "comparison",
                "title": "åŸºäºé”šç‚¹çš„åˆå¹¶",
                "data": null
              }
            }
          ]
        }
      ]
    },
    {
      "type": "section",
      "title": "ğŸŒŸ æ ¸å¿ƒç‰¹ç‚¹",
      "content": [
        {
          "type": "features",
          "items": [
            "åŠŸèƒ½æ„ŸçŸ¥ï¼šåœ¨åŠŸèƒ½ç©ºé—´è€Œéå‚æ•°ç©ºé—´è¿›è¡Œæ“ä½œ",
            "ç²¾ç¡®æ•æ‰ï¼šèƒ½å¤Ÿç²¾ç¡®æ•æ‰ä»»åŠ¡ç‰¹å®šçš„åŠŸèƒ½å˜åŒ–",
            "å‡å°‘å¹²æ‰°ï¼šé€šè¿‡åŠŸèƒ½é”šç‚¹å‡å°‘ä¸åŒä»»åŠ¡ä¹‹é—´çš„å¹²æ‰°",
            "ç†è®ºåŸºç¡€ï¼šåŸºäºè¾“å…¥-è¡¨ç¤ºç©ºé—´çš„ç†è®ºåŸºç¡€",
            "é€‚åº”æ€§å¼ºï¼šèƒ½å¤Ÿé€‚åº”ä¸åŒä»»åŠ¡çš„ç‰¹ç‚¹",
            "æ€§èƒ½æå‡ï¼šé€šå¸¸èƒ½è·å¾—æ¯”ç®€å•å‚æ•°åˆå¹¶æ›´å¥½çš„æ€§èƒ½"
          ]
        }
      ]
    },
    {
      "type": "section",
      "title": "ğŸ“ æ•°å­¦åŸç†",
      "content": [
        {
          "type": "math-box",
          "title": "åŠŸèƒ½é”šç‚¹å®šä¹‰",
          "formulas": [
            {
              "text": "åŠŸèƒ½é”šç‚¹æ˜¯åœ¨è¾“å…¥-è¡¨ç¤ºç©ºé—´ä¸­èƒ½å¤Ÿä»£è¡¨æ¨¡å‹åŠŸèƒ½çš„å…³é”®ç‚¹ã€‚å¯¹äºè¾“å…¥ $x$ å’Œæ¨¡å‹ $M$ï¼ŒåŠŸèƒ½é”šç‚¹å®šä¹‰ä¸ºï¼š"
            },
            {
              "display": "a_i = f_M(x_i)"
            },
            {
              "text": "å…¶ä¸­ $f_M$ æ˜¯æ¨¡å‹ $M$ çš„è¡¨ç¤ºå‡½æ•°ï¼Œ$x_i$ æ˜¯é”šç‚¹è¾“å…¥ã€‚",
              "inline": "f_M"
            }
          ]
        },
        {
          "type": "math-box",
          "title": "åŠŸèƒ½å˜åŒ–æ•æ‰",
          "formulas": [
            {
              "display": "\\Delta f_i = f_{M_2}(x_i) - f_{M_1}(x_i)"
            },
            {
              "text": "é€šè¿‡æ¯”è¾ƒä¸åŒæ¨¡å‹åœ¨åŠŸèƒ½é”šç‚¹ä¸Šçš„è¡¨ç¤ºå·®å¼‚æ¥æ•æ‰åŠŸèƒ½å˜åŒ–ã€‚",
              "inline": "\\Delta f_i"
            }
          ]
        },
        {
          "type": "math-box",
          "title": "åŸºäºé”šç‚¹çš„åˆå¹¶",
          "formulas": [
            {
              "display": "f_{merged}(x) = f_{base}(x) + \\sum_{i=1}^{n} \\alpha_i \\Delta f_i \\cdot \\text{sim}(x, x_i)"
            },
            {
              "text": "åŸºäºåŠŸèƒ½é”šç‚¹çš„ç›¸ä¼¼åº¦æ¥åˆå¹¶ä¸åŒæ¨¡å‹çš„åŠŸèƒ½ï¼Œå…¶ä¸­ $\\text{sim}(x, x_i)$ æ˜¯è¾“å…¥ä¸é”šç‚¹çš„ç›¸ä¼¼åº¦ã€‚",
              "inline": "\\text{sim}(x, x_i)"
            }
          ]
        }
      ]
    },
    {
      "type": "section",
      "title": "ğŸ’» Python ä»£ç ç¤ºä¾‹",
      "content": [
        {
          "type": "code-box",
          "title": "åŠŸèƒ½é”šç‚¹è¯†åˆ«",
          "language": "python",
          "code": "import torch\nimport torch.nn.functional as F\nfrom transformers import AutoModel, AutoTokenizer\n\n# åŠ è½½æ¨¡å‹\ntokenizer = AutoTokenizer.from_pretrained(\"model-path\")\nmodel = AutoModel.from_pretrained(\"model-path\")\n\n# å®šä¹‰é”šç‚¹è¾“å…¥ï¼ˆä»£è¡¨æ€§æ ·æœ¬ï¼‰\nanchor_inputs = [\n    \"What is machine learning?\",\n    \"How does neural network work?\",\n    \"Explain transformer architecture.\"\n]\n\n# æå–åŠŸèƒ½é”šç‚¹\nfunctional_anchors = []\nfor text in anchor_inputs:\n    inputs = tokenizer(text, return_tensors=\"pt\")\n    with torch.no_grad():\n        outputs = model(**inputs)\n        # ä½¿ç”¨æœ€åä¸€å±‚çš„éšè—çŠ¶æ€ä½œä¸ºåŠŸèƒ½é”šç‚¹\n        anchor = outputs.last_hidden_state.mean(dim=1)\n        functional_anchors.append(anchor)\n\nprint(f\"è¯†åˆ«åˆ° {len(functional_anchors)} ä¸ªåŠŸèƒ½é”šç‚¹\")"
        },
        {
          "type": "code-box",
          "title": "åŸºäºåŠŸèƒ½é”šç‚¹çš„åˆå¹¶",
          "language": "python",
          "code": "import torch\nfrom transformers import AutoModelForCausalLM\n\n# åŠ è½½åŸºç¡€æ¨¡å‹å’Œä»»åŠ¡æ¨¡å‹\nbase_model = AutoModelForCausalLM.from_pretrained(\"base-model-path\")\ntask_model = AutoModelForCausalLM.from_pretrained(\"task-model-path\")\n\n# è®¡ç®—åŠŸèƒ½å˜åŒ–\nfunctional_deltas = {}\nfor key in base_model.state_dict():\n    if key in task_model.state_dict():\n        functional_deltas[key] = task_model.state_dict()[key] - base_model.state_dict()[key]\n\n# åŸºäºåŠŸèƒ½é”šç‚¹ç›¸ä¼¼åº¦è¿›è¡Œåˆå¹¶\ndef compute_similarity(x, anchor):\n    # è®¡ç®—è¾“å…¥ä¸é”šç‚¹çš„ç›¸ä¼¼åº¦\n    return F.cosine_similarity(x, anchor, dim=-1)\n\n# åˆå¹¶å‚æ•°ï¼ˆç®€åŒ–ç¤ºä¾‹ï¼‰\nmerged_state_dict = base_model.state_dict().copy()\nalpha = 0.5  # åˆå¹¶æƒé‡\n\nfor key in merged_state_dict:\n    if key in functional_deltas:\n        # åŸºäºåŠŸèƒ½é”šç‚¹ç›¸ä¼¼åº¦è°ƒæ•´åˆå¹¶æƒé‡\n        similarity = compute_similarity(\n            base_model.state_dict()[key],\n            functional_deltas[key]\n        )\n        adjusted_alpha = alpha * similarity\n        merged_state_dict[key] += adjusted_alpha * functional_deltas[key]\n\n# åˆ›å»ºåˆå¹¶åçš„æ¨¡å‹\nmerged_model = AutoModelForCausalLM.from_pretrained(\"base-model-path\")\nmerged_model.load_state_dict(merged_state_dict)\nmerged_model.save_pretrained(\"./merged_model\")"
        }
      ]
    },
    {
      "type": "section",
      "title": "ğŸš€ åº”ç”¨åœºæ™¯",
      "content": [
        {
          "type": "app-box",
          "content": "ä»»åŠ¡ç‰¹åŒ–åˆå¹¶ï¼šéœ€è¦ç²¾ç¡®æ•æ‰ä»»åŠ¡ç‰¹å®šåŠŸèƒ½å˜åŒ–çš„åœºæ™¯ã€‚å‡å°‘ä»»åŠ¡å¹²æ‰°ï¼šé€šè¿‡åŠŸèƒ½é”šç‚¹å‡å°‘ä¸åŒä»»åŠ¡ä¹‹é—´çš„å¹²æ‰°ã€‚å¤šä»»åŠ¡å­¦ä¹ ï¼šåˆå¹¶å¤šä¸ªä»»åŠ¡ç‰¹åŒ–æ¨¡å‹ï¼Œå®ç°å¤šä»»åŠ¡èƒ½åŠ›ã€‚åŠŸèƒ½ç©ºé—´å»ºæ¨¡ï¼šéœ€è¦åœ¨åŠŸèƒ½ç©ºé—´è€Œéå‚æ•°ç©ºé—´æ“ä½œçš„åœºæ™¯ã€‚"
        }
      ]
    },
    {
      "type": "section",
      "title": "âš ï¸ æ³¨æ„äº‹é¡¹",
      "content": [
        {
          "type": "features",
          "items": [
            "é”šç‚¹é€‰æ‹©ï¼šéœ€è¦é€‰æ‹©å…·æœ‰ä»£è¡¨æ€§çš„é”šç‚¹è¾“å…¥",
            "ç›¸ä¼¼åº¦è®¡ç®—ï¼šç›¸ä¼¼åº¦è®¡ç®—æ–¹æ³•å½±å“åˆå¹¶æ•ˆæœ",
            "è®¡ç®—å¤æ‚åº¦ï¼šåŠŸèƒ½é”šç‚¹åˆå¹¶çš„è®¡ç®—å¤æ‚åº¦ç›¸å¯¹è¾ƒé«˜",
            "ç†è®ºåŸºç¡€ï¼šéœ€è¦ç†è§£åŠŸèƒ½ç©ºé—´çš„ç†è®ºåŸºç¡€",
            "å®éªŒéªŒè¯ï¼šéœ€è¦é€šè¿‡å®éªŒéªŒè¯é”šç‚¹é€‰æ‹©å’Œåˆå¹¶ç­–ç•¥"
          ]
        }
      ]
    }
  ]
}
