{
  "title": "æ¨¡å‹å¹¶è¡ŒåŸºç¡€",
  "subtitle": "ç†è§£å¼ é‡å¹¶è¡Œã€åˆ—å¹¶è¡Œã€è¡Œå¹¶è¡Œç­‰æ¨¡å‹å¹¶è¡Œçš„æ‹†åˆ†æ–¹æ³•ã€‚",
  "content": [
    {
      "type": "section",
      "title": "ğŸ“Š æ¶æ„å›¾è§£",
      "content": [
        {
          "type": "diagram-gallery",
          "images": [
            {
              "type": "svg-d3",
              "component": "GenericDiagram",
              "caption": "æ¨¡å‹å¹¶è¡ŒåŸç†",
              "width": 1000,
              "height": 800,
              "interactive": true,
              "props": {
                "type": "architecture",
                "title": "æ¨¡å‹å¹¶è¡ŒåŸç†",
                "data": null
              }
            },
            {
              "type": "svg-d3",
              "component": "GenericDiagram",
              "caption": "å¼ é‡å¹¶è¡Œæ‹†åˆ†",
              "width": 1000,
              "height": 800,
              "interactive": true,
              "props": {
                "type": "comparison",
                "title": "å¼ é‡å¹¶è¡Œæ‹†åˆ†",
                "data": null
              }
            }
          ]
        }
      ]
    },
    {
      "type": "section",
      "title": "ğŸ’» ä»£ç ç¤ºä¾‹",
      "content": [
        {
          "type": "code-box",
          "title": "åˆ—å¹¶è¡Œçº¿æ€§å±‚",
          "language": "python",
          "code": "import torch\nimport torch.nn as nn\nimport torch.distributed as dist\n\nclass ColumnParallelLinear(nn.Module):\n    \"\"\"åˆ—å¹¶è¡Œï¼šå°†æƒé‡çŸ©é˜µæŒ‰åˆ—æ‹†åˆ†\"\"\"\n    def __init__(self, in_features, out_features, world_size):\n        super().__init__\n        self.world_size = world_size\n        self.out_features = out_features // world_size\n        self.weight = nn.Parameter(torch.randn(self.out_features, in_features))\n    \n    def forward(self, x):\n        # æ¯ä¸ªè®¾å¤‡è®¡ç®—éƒ¨åˆ†è¾“å‡º\n        output = F.linear(x, self.weight)\n        # AllGatheræ”¶é›†æ‰€æœ‰è¾“å‡º\n        outputs = [torch.zeros_like(output) for _ in range(self.world_size)]\n        dist.all_gather(outputs, output)\n        # æ‹¼æ¥å®Œæ•´è¾“å‡º\n        return torch.cat(outputs, dim=-1)"
        },
        {
          "type": "code-box",
          "title": "è¡Œå¹¶è¡Œçº¿æ€§å±‚",
          "language": "python",
          "code": "class RowParallelLinear(nn.Module):\n    \"\"\"è¡Œå¹¶è¡Œï¼šå°†æƒé‡çŸ©é˜µæŒ‰è¡Œæ‹†åˆ†\"\"\"\n    def __init__(self, in_features, out_features, world_size):\n        super().__init__()\n        self.world_size = world_size\n        self.in_features = in_features // world_size\n        self.weight = nn.Parameter(torch.randn(out_features, self.in_features))\n    \n    def forward(self, x):\n        # å°†è¾“å…¥æŒ‰åˆ—æ‹†åˆ†\n        x_list = torch.split(x, self.in_features, dim=-1)\n        x_local = x_list[self.rank]\n        \n        # æ¯ä¸ªè®¾å¤‡è®¡ç®—éƒ¨åˆ†ç»“æœ\n        output = F.linear(x_local, self.weight)\n        # AllReduceæ±‚å’Œå¾—åˆ°æœ€ç»ˆè¾“å‡º\n        dist.all_reduce(output, op=dist.ReduceOp.SUM)\n        return output"
        }
      ]
    }
  ]
}
