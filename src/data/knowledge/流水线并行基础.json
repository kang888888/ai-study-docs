{
  "title": "æµæ°´çº¿å¹¶è¡ŒåŸºç¡€",
  "subtitle": "ç†è§£æµæ°´çº¿åˆ†æ®µã€æ°”æ³¡æŠ‘åˆ¶ã€è°ƒåº¦ç­–ç•¥ç­‰æµæ°´çº¿å¹¶è¡Œçš„æ ¸å¿ƒæ¦‚å¿µã€‚",
  "content": [
    {
      "type": "section",
      "title": "ğŸ“Š æ¶æ„å›¾è§£",
      "content": [
        {
          "type": "diagram-gallery",
          "images": [
            {
              "type": "svg-d3",
              "component": "GenericDiagram",
              "caption": "æµæ°´çº¿å¹¶è¡ŒåŸç†",
              "width": 1000,
              "height": 800,
              "interactive": true,
              "props": {
                "type": "architecture",
                "title": "æµæ°´çº¿å¹¶è¡ŒåŸç†",
                "data": null
              }
            },
            {
              "type": "svg-d3",
              "component": "GenericDiagram",
              "caption": "æ°”æ³¡æŠ‘åˆ¶ç­–ç•¥",
              "width": 1000,
              "height": 800,
              "interactive": true,
              "props": {
                "type": "flow",
                "title": "æ°”æ³¡æŠ‘åˆ¶ç­–ç•¥",
                "data": null
              }
            }
          ]
        }
      ]
    },
    {
      "type": "section",
      "title": "ğŸ’» ä»£ç ç¤ºä¾‹",
      "content": [
        {
          "type": "code-box",
          "title": "æµæ°´çº¿åˆ†æ®µ",
          "language": "python",
          "code": "import torch.nn as nn\n\ndef split_model_into_stages(model, num_stages):\n    \"\"\"å°†æ¨¡å‹åˆ†å‰²æˆå¤šä¸ªæµæ°´çº¿é˜¶æ®µ\"\"\"\n    layers = list(model.children())\n    layers_per_stage = len(layers) // num_stages\n    \n    stages = []\n    for i in range(num_stages):\n        start_idx = i * layers_per_stage\n        end_idx = (i + 1) * layers_per_stage if i < num_stages - 1 else len(layers)\n        stage = nn.Sequential(*layers[start_idx:end_idx])\n        stages.append(stage)\n    \n    return stages\n\nclass PipelineStage(nn.Module):\n    def __init__(self, stage_model, stage_id, num_stages):\n        super().__init__()\n        self.stage_model = stage_model\n        self.stage_id = stage_id\n        self.num_stages = num_stages\n    \n    def forward(self, x, micro_batch_id=None):\n        return self.stage_model(x)"
        },
        {
          "type": "code-box",
          "title": "1F1Bè°ƒåº¦ç­–ç•¥",
          "language": "python",
          "code": "def schedule_1f1b(num_microbatches, num_stages):\n    \"\"\"1F1B (One Forward One Backward) è°ƒåº¦ç­–ç•¥\"\"\"\n    schedule = []\n    \n    # å‰å‘ä¼ æ’­é˜¶æ®µ\n    for mb_id in range(num_microbatches):\n        for stage_id in range(num_stages):\n            schedule.append(('forward', mb_id, stage_id))\n    \n    # åå‘ä¼ æ’­é˜¶æ®µï¼ˆ1F1Bæ¨¡å¼ï¼‰\n    for mb_id in range(num_microbatches - 1, -1, -1):\n        for stage_id in range(num_stages - 1, -1, -1):\n            schedule.append(('backward', mb_id, stage_id))\n    \n    return schedule"
        }
      ]
    }
  ]
}
