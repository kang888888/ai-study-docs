{
  "title": "å¤§æ¨¡å‹é‡åŒ–åŸºç¡€ï¼šPTQ / INT8 / INT4",
  "subtitle": "ç†è§£æƒé‡é‡åŒ–ã€æ¿€æ´»é‡åŒ–ä¸ç¼©æ”¾æ ¡å‡†ï¼Œæ˜¯æŒæ¡ GPTQã€AWQã€GGUF ç­‰é«˜çº§æ–¹æ¡ˆçš„å‰æã€‚",
  "content": [
    {
      "type": "section",
      "title": "ğŸ“Š å›¾è§£",
      "content": [
        {
          "type": "diagram-gallery",
          "images": [
            {
              "type": "svg-d3",
              "component": "GenericDiagram",
              "caption": "PTQ æµç¨‹",
              "width": 1000,
              "height": 800,
              "interactive": true,
              "props": {
                "type": "flow",
                "title": "PTQ æµç¨‹"
              }
            },
            {
              "type": "svg-d3",
              "component": "GenericDiagram",
              "caption": "é€é€šé“ç¼©æ”¾",
              "width": 1000,
              "height": 800,
              "interactive": true,
              "props": {
                "type": "architecture",
                "title": "é€é€šé“ç¼©æ”¾"
              }
            },
            {
              "type": "svg-d3",
              "component": "GenericDiagram",
              "caption": "æ¿€æ´»åˆ†å¸ƒä¸è£å‰ª",
              "width": 1000,
              "height": 800,
              "interactive": true,
              "props": {
                "type": "architecture",
                "title": "æ¿€æ´»åˆ†å¸ƒä¸è£å‰ª"
              }
            }
          ]
        }
      ]
    },
    {
      "type": "section",
      "title": "ğŸ“ æ•°å­¦åŸç†",
      "content": [
        {
          "type": "math-box",
          "title": "çº¿æ€§é‡åŒ–",
          "formulas": [
            {
              "text": "å¯¹ç§°é‡åŒ–å…¬å¼ï¼š"
            },
            {
              "display": "q = \\text{round}\\Big( \\frac{x}{s} \\Big), \\quad s = \\frac{\\max(|x|)}{2^{b-1}-1}"
            },
            {
              "text": "éå¯¹ç§°é‡åŒ–ï¼š"
            },
            {
              "display": "q = \\text{round}\\Big( \\frac{x}{s} + z \\Big), \\quad x \\approx s(q - z)"
            }
          ]
        },
        {
          "type": "math-box",
          "title": "è¯¯å·®ç•Œ",
          "formulas": [
            {
              "text": "é‡åŒ–è¯¯å·®æ»¡è¶³ï¼š"
            },
            {
              "display": "|x - \\hat{x}| \\le \\frac{s}{2}"
            },
            {
              "text": "é€é€šé“é‡åŒ–å¯æ˜¾è‘—å‡å° $s$ï¼Œä»è€Œé™ä½è¯¯å·®ã€‚",
              "inline": "s"
            }
          ]
        }
      ]
    },
    {
      "type": "section",
      "title": "ğŸ’» Python ä»£ç ç¤ºä¾‹",
      "content": [
        {
          "type": "code-box",
          "title": "ä½¿ç”¨ torch.int8 åŠ¨æ€é‡åŒ–çº¿æ€§å±‚",
          "language": "python",
          "code": "import torch\nfrom torch.ao.quantization import quantize_dynamic\nfrom transformers import AutoModelForSeq2SeqLM\n\nmodel = AutoModelForSeq2SeqLM.from_pretrained(\"google/flan-t5-base\")\nmodules_to_quantize = {torch.nn.Linear}\n\nquantized_model = quantize_dynamic(\n    model,\n    modules_to_quantize,\n    dtype=torch.qint8\n)\n\nsample = torch.randint(0, model.config.vocab_size, (1, 32))\nwith torch.inference_mode():\n    logits = quantized_model(input_ids=sample).logits"
        }
      ]
    }
  ]
}