{
  "title": "KV Cacheï¼šæ³¨æ„åŠ›ç¼“å­˜ä¸é•¿åºåˆ—æ¨ç†",
  "subtitle": "é€šè¿‡ç¼“å­˜å†å² Key/Value å¼ é‡ï¼Œè®©è‡ªå›å½’æ¨ç†ä» O(TÂ²) é™ä¸º O(T)ï¼Œæ˜¯æµå¼ç”Ÿæˆçš„å…³é”®ä¼˜åŒ–ã€‚",
  "content": [
    {
      "type": "section",
      "title": "ğŸ“Š å›¾è§£",
      "content": [
        {
          "type": "diagram-gallery",
          "images": [
            {
              "type": "svg-d3",
              "component": "GenericDiagram",
              "caption": "åŸºæœ¬æµç¨‹",
              "width": 1000,
              "height": 800,
              "interactive": true,
              "props": {
                "type": "architecture",
                "title": "åŸºæœ¬æµç¨‹"
              }
            },
            {
              "type": "svg-d3",
              "component": "GenericDiagram",
              "caption": "PagedAttention",
              "width": 1000,
              "height": 800,
              "interactive": true,
              "props": {
                "type": "architecture",
                "title": "PagedAttention"
              }
            },
            {
              "type": "svg-d3",
              "component": "GenericDiagram",
              "caption": "KV é‡åŒ–",
              "width": 1000,
              "height": 800,
              "interactive": true,
              "props": {
                "type": "architecture",
                "title": "KV é‡åŒ–"
              }
            }
          ]
        }
      ]
    },
    {
      "type": "section",
      "title": "ğŸ“ æ•°å­¦ä¸å¤æ‚åº¦",
      "content": [
        {
          "type": "math-box",
          "title": "è‡ªæ³¨æ„åŠ›å¤æ‚åº¦",
          "formulas": [
            {
              "text": "æ— ç¼“å­˜ï¼š$\\mathcal{O}(T^2 d)$ï¼›æœ‰ç¼“å­˜ï¼š$\\mathcal{O}(T d^2)$ã€‚",
              "inline": "\\mathcal{O}(T^2 d)"
            },
            {
              "text": "Prefill æˆæœ¬ä»ä¸º $T^2$ï¼Œä½† decode é˜¶æ®µå˜ä¸ºå¸¸æ•°ã€‚",
              "inline": "T^2"
            }
          ]
        },
        {
          "type": "math-box",
          "title": "ç¼“å­˜å†…å­˜",
          "formulas": [
            {
              "display": "\\text{Mem} = 2 \\times L \\times H \\times d_{head} \\times bytes"
            },
            {
              "text": "ä¸¤ä¸ªå› å­æ¥è‡ª Key/Valueï¼Œå¸¸è§ä¼˜åŒ–ï¼šFP8ã€å‹ç¼©ã€å…±äº«ã€‚"
            }
          ]
        }
      ]
    },
    {
      "type": "section",
      "title": "ğŸ’» Python ä»£ç ç¤ºä¾‹",
      "content": [
        {
          "type": "code-box",
          "title": "ä½¿ç”¨ vLLM API è‡ªåŠ¨ç®¡ç† KV Cache",
          "language": "python",
          "code": "from vllm import LLM, SamplingParams\n\nllm = LLM(model=\"meta-llama/Llama-3-8b-instruct\", gpu_memory_utilization=0.9)\nparams = SamplingParams(temperature=0.7, max_tokens=256)\n\nprompts = [\n    \"è¯´æ˜ KV Cache å¦‚ä½•æé«˜æ¨ç†æ•ˆç‡?\",\n    \"ç»™å‡ºä¸€ä¸ªå¸¦ KV Cache çš„æ¨ç†ä¼ªä»£ç \"\n]\n\noutputs = llm.generate(prompts, params)\nfor out in outputs:\n    print(out.outputs[0].text)"
        }
      ]
    }
  ]
}