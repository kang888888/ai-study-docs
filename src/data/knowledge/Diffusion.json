{
  "title": "Diffusion Model (æ‰©æ•£æ¨¡å‹)",
  "subtitle": "å½“å‰æœ€å…ˆè¿›çš„ç”Ÿæˆæ¨¡å‹",
  "content": [
    {
      "type": "section",
      "title": "ğŸ“– æ ¸å¿ƒæ¦‚å¿µ",
      "content": [
        {
          "type": "desc-box",
          "content": [
            "é€šè¿‡æ¨¡æ‹Ÿæ•°æ®é€æ¸æ·»åŠ å™ªå£°å˜æˆçº¯å™ªå£°çš„å‰å‘æ‰©æ•£è¿‡ç¨‹ï¼Œå¹¶è®­ç»ƒç¥ç»ç½‘ç»œå­¦ä¹ åå‘å»å™ªè¿‡ç¨‹ã€‚æ˜¯å½“å‰ç”Ÿæˆè´¨é‡æœ€é«˜ã€è®­ç»ƒæœ€ç¨³å®šçš„ç”Ÿæˆæ¨¡å‹ã€‚"
          ]
        }
      ]
    },
    {
      "type": "section",
      "title": "ğŸŒŸ æ ¸å¿ƒç‰¹ç‚¹",
      "content": [
        {
          "type": "features",
          "items": [
            "å‰å‘æ‰©æ•£ï¼šé€æ­¥å‘æ•°æ®æ·»åŠ é«˜æ–¯å™ªå£°ï¼ŒTæ­¥åå˜æˆçº¯å™ªå£°",
            "åå‘å»å™ªï¼šè®­ç»ƒU-Netç½‘ç»œé¢„æµ‹æ¯ä¸€æ­¥çš„å™ªå£°ï¼Œé€æ­¥æ¢å¤æ•°æ®",
            "ç”Ÿæˆè´¨é‡æé«˜ï¼šç»†èŠ‚ä¸°å¯Œï¼Œè¿œè¶…GANå’ŒVAE",
            "è®­ç»ƒç¨³å®šï¼šä¸åƒGANéœ€è¦å¹³è¡¡ç”Ÿæˆå™¨å’Œåˆ¤åˆ«å™¨",
            "æ½œåœ¨æ‰©æ•£ï¼ˆLDMï¼‰ï¼šåœ¨æ½œåœ¨ç©ºé—´è¿›è¡Œæ‰©æ•£ï¼Œå¤§å¹…é™ä½è®¡ç®—æˆæœ¬"
          ]
        }
      ]
    },
    {
      "type": "section",
      "title": "âš™ï¸ å…³é”®æŠ€æœ¯",
      "content": [
        {
          "type": "tech-box",
          "content": "DDPMã€DDIMåŠ é€Ÿé‡‡æ ·ã€Classifier-Free Guidanceã€U-Netå»å™ªç½‘ç»œã€å™ªå£°è°ƒåº¦ï¼ˆNoise Scheduleï¼‰"
        }
      ]
    },
    {
      "type": "section",
      "title": "ğŸš€ åº”ç”¨åœºæ™¯",
      "content": [
        {
          "type": "app-box",
          "content": "æ–‡ç”Ÿå›¾ï¼ˆStable Diffusionã€DALL-E 2ï¼‰ã€å›¾åƒç¼–è¾‘ã€è§†é¢‘ç”Ÿæˆï¼ˆSoraï¼‰ã€éŸ³é¢‘ç”Ÿæˆ"
        }
      ]
    },
    {
      "type": "section",
      "title": "ğŸ“Š æ¶æ„å›¾è§£",
      "content": [
        {
          "type": "diagram-gallery",
          "images": [
            {
              "type": "svg-d3",
              "component": "DiffusionDiagram",
              "caption": "æ‰©æ•£è¿‡ç¨‹",
              "width": 1000,
              "height": 800,
              "interactive": true,
              "props": {
                "type": "architecture",
                "title": "æ‰©æ•£è¿‡ç¨‹"
              }
            },
            {
              "type": "svg-d3",
              "component": "DiffusionDiagram",
              "caption": "é‡‡æ ·è¿‡ç¨‹",
              "width": 1000,
              "height": 800,
              "interactive": true,
              "props": {
                "type": "architecture",
                "title": "é‡‡æ ·è¿‡ç¨‹"
              }
            },
            {
              "type": "svg-d3",
              "component": "DiffusionDiagram",
              "caption": "å™ªå£°è°ƒåº¦",
              "width": 1000,
              "height": 800,
              "interactive": true,
              "props": {
                "type": "architecture",
                "title": "å™ªå£°è°ƒåº¦"
              }
            }
          ]
        }
      ]
    },
    {
      "type": "section",
      "title": "ğŸ“ æ•°å­¦åŸç†",
      "content": [
        {
          "type": "math-box",
          "title": "å‰å‘æ‰©æ•£è¿‡ç¨‹",
          "formulas": [
            {
              "text": "é€æ­¥å‘æ•°æ®æ·»åŠ é«˜æ–¯å™ªå£°ï¼š"
            },
            {
              "display": "q(x_t | x_{t-1}) = \\mathcal{N}(x_t; \\sqrt{1-\\beta_t} x_{t-1}, \\beta_t I)"
            },
            {
              "text": "å¯ä»¥ç®€åŒ–ä¸ºç›´æ¥ä» $x_0$ é‡‡æ ·ï¼š",
              "inline": "x_0"
            },
            {
              "display": "q(x_t | x_0) = \\mathcal{N}(x_t; \\sqrt{\\bar{\\alpha}_t} x_0, (1-\\bar{\\alpha}_t) I)"
            },
            {
              "text": "å…¶ä¸­ $\\bar{\\alpha}_t = \\prod_{s=1}^{t}(1-\\beta_s)$",
              "inline": "\\bar{\\alpha}_t = \\prod_{s=1}^{t}(1-\\beta_s)"
            }
          ]
        },
        {
          "type": "math-box",
          "title": "åå‘å»å™ªè¿‡ç¨‹",
          "formulas": [
            {
              "text": "å­¦ä¹ å»å™ªåˆ†å¸ƒï¼š"
            },
            {
              "display": "p_\\theta(x_{t-1} | x_t) = \\mathcal{N}(x_{t-1}; \\mu_\\theta(x_t, t), \\Sigma_\\theta(x_t, t))"
            },
            {
              "text": "è®­ç»ƒç›®æ ‡ï¼šé¢„æµ‹å™ªå£°"
            },
            {
              "display": "L = \\mathbb{E}_{t,x_0,\\epsilon} \\left[||\\epsilon - \\epsilon_\\theta(x_t, t)||^2\\right]"
            },
            {
              "text": "å…¶ä¸­ $x_t = \\sqrt{\\bar{\\alpha}_t} x_0 + \\sqrt{1-\\bar{\\alpha}_t} \\epsilon$",
              "inline": "x_t = \\sqrt{\\bar{\\alpha}_t} x_0 + \\sqrt{1-\\bar{\\alpha}_t} \\epsilon"
            }
          ]
        },
        {
          "type": "math-box",
          "title": "DDPM é‡‡æ ·",
          "formulas": [
            {
              "text": "ä»å™ªå£°é€æ­¥å»å™ªç”Ÿæˆï¼š"
            },
            {
              "display": "x_{t-1} = \\frac{1}{\\sqrt{\\alpha_t}}\\left(x_t - \\frac{\\beta_t}{\\sqrt{1-\\bar{\\alpha}_t}} \\epsilon_\\theta(x_t, t)\\right) + \\sigma_t z"
            },
            {
              "text": "å…¶ä¸­ $z \\sim \\mathcal{N}(0, I)$ï¼Œ$\\sigma_t$ æ˜¯å™ªå£°æ–¹å·®",
              "inline": "z \\sim \\mathcal{N}(0, I)"
            }
          ]
        }
      ]
    },
    {
      "type": "section",
      "title": "ğŸ’» Python ä»£ç ç¤ºä¾‹",
      "content": [
        {
          "type": "code-box",
          "title": "ä½¿ç”¨ PyTorch å®ç°ç®€å• Diffusion æ¨¡å‹",
          "language": "python",
          "code": "import torch\nimport torch.nn as nn\nimport torch.nn.functional as F\nimport numpy as np\n\nclass DiffusionModel(nn.Module):\n    \"\"\"ç®€å•çš„ Diffusion æ¨¡å‹\"\"\"\n    def __init__(self, timesteps=1000, beta_start=0.0001, beta_end=0.02):\n        super(DiffusionModel, self).__init__()\n        self.timesteps = timesteps\n        \n        # çº¿æ€§å™ªå£°è°ƒåº¦\n        self.betas = torch.linspace(beta_start, beta_end, timesteps)\n        self.alphas = 1.0 - self.betas\n        self.alphas_cumprod = torch.cumprod(self.alphas, dim=0)\n        self.alphas_cumprod_prev = F.pad(self.alphas_cumprod[:-1], (1, 0), value=1.0)\n        \n        # å»å™ªç½‘ç»œï¼ˆç®€åŒ–ç‰ˆï¼Œå®é™…ä½¿ç”¨U-Netï¼‰\n        self.denoise_net = nn.Sequential(\n            nn.Linear(784, 512),\n            nn.ReLU(),\n            nn.Linear(512, 512),\n            nn.ReLU(),\n            nn.Linear(512, 784)\n        )\n    \n    def q_sample(self, x_start, t, noise=None):\n        \"\"\"å‰å‘æ‰©æ•£ï¼šæ·»åŠ å™ªå£°\"\"\"\n        if noise is None:\n            noise = torch.randn_like(x_start)\n        \n        sqrt_alphas_cumprod_t = torch.sqrt(self.alphas_cumprod[t])\n        sqrt_one_minus_alphas_cumprod_t = torch.sqrt(1.0 - self.alphas_cumprod[t])\n        \n        return sqrt_alphas_cumprod_t * x_start + sqrt_one_minus_alphas_cumprod_t * noise\n    \n    def p_sample(self, x, t):\n        \"\"\"åå‘å»å™ªï¼šå•æ­¥é‡‡æ ·\"\"\"\n        # é¢„æµ‹å™ªå£°\n        predicted_noise = self.denoise_net(x)\n        \n        # è®¡ç®—å‡å€¼\n        alpha_t = self.alphas[t]\n        alpha_cumprod_t = self.alphas_cumprod[t]\n        beta_t = self.betas[t]\n        \n        pred_x_start = (x - torch.sqrt(1.0 - alpha_cumprod_t) * predicted_noise) / torch.sqrt(alpha_cumprod_t)\n        \n        # è®¡ç®— x_{t-1}\n        pred_x_prev = (1.0 / torch.sqrt(alpha_t)) * (x - (beta_t / torch.sqrt(1.0 - alpha_cumprod_t)) * predicted_noise)\n        \n        if t[0] > 0:\n            noise = torch.randn_like(x)\n            pred_x_prev += torch.sqrt(beta_t) * noise\n        \n        return pred_x_prev\n    \n    def p_sample_loop(self, shape):\n        \"\"\"å®Œæ•´é‡‡æ ·è¿‡ç¨‹\"\"\"\n        device = next(self.parameters()).device\n        b = shape[0]\n        \n        # ä»çº¯å™ªå£°å¼€å§‹\n        img = torch.randn(shape, device=device)\n        \n        for i in reversed(range(0, self.timesteps)):\n            t = torch.full((b,), i, device=device, dtype=torch.long)\n            img = self.p_sample(img, t)\n        \n        return img\n    \n    def forward(self, x_start, t):\n        \"\"\"è®­ç»ƒæ—¶çš„å‰å‘ä¼ æ’­\"\"\"\n        noise = torch.randn_like(x_start)\n        x_noisy = self.q_sample(x_start, t, noise)\n        predicted_noise = self.denoise_net(x_noisy)\n        return predicted_noise\n\n# ä½¿ç”¨ç¤ºä¾‹\nif __name__ == \"__main__\":\n    model = DiffusionModel(timesteps=1000)\n    \n    # æ¨¡æ‹Ÿè¾“å…¥ (batch_size=4, å±•å¹³çš„å›¾åƒ 28x28=784)\n    x_start = torch.randn(4, 784)\n    \n    # éšæœºæ—¶é—´æ­¥\n    t = torch.randint(0, 1000, (4,))\n    \n    # è®­ç»ƒï¼šé¢„æµ‹å™ªå£°\n    predicted_noise = model(x_start, t)\n    print(f\"é¢„æµ‹å™ªå£°å½¢çŠ¶: {predicted_noise.shape}\")  # [4, 784]\n    \n    # é‡‡æ ·ï¼šä»å™ªå£°ç”Ÿæˆ\n    generated = model.p_sample_loop((4, 784))\n    print(f\"ç”Ÿæˆå›¾åƒå½¢çŠ¶: {generated.shape}\")  # [4, 784]"
        }
      ]
    }
  ]
}