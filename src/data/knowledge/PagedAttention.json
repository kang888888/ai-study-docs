{
  "title": "PagedAttentionï¼šåˆ†é¡µå¼æ³¨æ„åŠ›ç¼“å­˜è°ƒåº¦",
  "subtitle": "é€šè¿‡è™šæ‹Ÿå†…å­˜æ€æƒ³ç®¡ç† KV Cacheï¼Œç”¨é¡µè¡¨æ˜ å°„æ›¿ä»£å¤åˆ¶ï¼Œè§£å†³å¤šä¼šè¯ã€é•¿ä¸Šä¸‹æ–‡å¸¦æ¥çš„å†…å­˜ç¢ç‰‡é—®é¢˜ã€‚",
  "content": [
    {
      "type": "section",
      "title": "ğŸ“– æ ¸å¿ƒæ¦‚å¿µ",
      "content": [
        {
          "type": "desc-box",
          "content": [
            "PagedAttentionæ˜¯vLLMæå‡ºçš„æ³¨æ„åŠ›æœºåˆ¶ä¼˜åŒ–æŠ€æœ¯ï¼Œé€šè¿‡åˆ†é¡µç®¡ç†KV Cacheï¼Œå®ç°é«˜æ•ˆçš„å†…å­˜ç®¡ç†å’Œå¹¶è¡Œé‡‡æ ·ã€‚"
          ]
        }
      ]
    },
    {
      "type": "section",
      "title": "ğŸŒŸ æ ¸å¿ƒç‰¹ç‚¹",
      "content": [
        {
          "type": "features",
          "items": [
            "å†…å­˜é«˜æ•ˆï¼šåˆ†é¡µç®¡ç†å‡å°‘å†…å­˜ç¢ç‰‡",
            "å¹¶è¡Œé‡‡æ ·ï¼šæ”¯æŒå¤šä¸ªåºåˆ—å¹¶è¡Œç”Ÿæˆ",
            "åŠ¨æ€åˆ†é…ï¼šæŒ‰éœ€åˆ†é…å†…å­˜é¡µé¢",
            "é›¶æ‹·è´ï¼šé¿å…ä¸å¿…è¦çš„æ•°æ®å¤åˆ¶",
            "é«˜ååé‡ï¼šæ˜¾è‘—æé«˜æœåŠ¡ååé‡"
          ]
        }
      ]
    },
    {
      "type": "section",
      "title": "âš™ï¸ å…³é”®æŠ€æœ¯",
      "content": [
        {
          "type": "tech-box",
          "content": "åˆ†é¡µç®¡ç†ã€å†…å­˜åˆ†é…ã€å¹¶è¡Œé‡‡æ ·ã€é›¶æ‹·è´ã€åŠ¨æ€æ‰¹å¤„ç†"
        }
      ]
    },
    {
      "type": "section",
      "title": "ğŸš€ åº”ç”¨åœºæ™¯",
      "content": [
        {
          "type": "app-box",
          "content": "LLMæ¨ç†æœåŠ¡ã€æ‰¹é‡ç”Ÿæˆã€å¹¶è¡Œé‡‡æ ·ã€é«˜ååæœåŠ¡ã€vLLMæ¡†æ¶"
        }
      ]
    },
    {
      "type": "section",
      "title": "ğŸ“Š å›¾è§£",
      "content": [
        {
          "type": "diagram-gallery",
          "images": [
            {
              "type": "svg-d3",
              "component": "GenericDiagram",
              "caption": "æ¦‚è§ˆ",
              "width": 1000,
              "height": 800,
              "interactive": true,
              "props": {
                "type": "architecture",
                "title": "æ¦‚è§ˆ"
              }
            },
            {
              "type": "svg-d3",
              "component": "GenericDiagram",
              "caption": "é¡µè¡¨ç»“æ„",
              "width": 1000,
              "height": 800,
              "interactive": true,
              "props": {
                "type": "architecture",
                "title": "é¡µè¡¨ç»“æ„"
              }
            },
            {
              "type": "svg-d3",
              "component": "GenericDiagram",
              "caption": "åˆ†é…å™¨",
              "width": 1000,
              "height": 800,
              "interactive": true,
              "props": {
                "type": "architecture",
                "title": "åˆ†é…å™¨"
              }
            }
          ]
        }
      ]
    },
    {
      "type": "section",
      "title": "ğŸ“ æ•°å­¦/å¤æ‚åº¦",
      "content": [
        {
          "type": "math-box",
          "title": "å†…å­˜åˆ©ç”¨ç‡",
          "formulas": [
            {
              "display": "U = 1 - \\frac{P_{free}}{P_{total}}"
            },
            {
              "text": "PagedAttention é€šè¿‡å¿«é€Ÿå›æ”¶ä½¿ $P_{free}$ æŒç»­ä¿æŒåœ¨ä½æ°´å¹³ã€‚",
              "inline": "P_{free}"
            }
          ]
        },
        {
          "type": "math-box",
          "title": "page fault å¼€é”€",
          "formulas": [
            {
              "display": "T = T_{hit} + p_{fault} (T_{alloc} + T_{init})"
            },
            {
              "text": "ç®—æ³•ç›®æ ‡æ˜¯é™ä½ $p_{fault}$ å¹¶ä¼˜åŒ– $T_{alloc}$ã€‚",
              "inline": "p_{fault}"
            }
          ]
        }
      ]
    },
    {
      "type": "section",
      "title": "ğŸ’» ä¼ªä»£ç ",
      "content": [
        {
          "type": "code-box",
          "title": "",
          "language": "python",
          "code": "def allocate_pages(request_id, needed_pages):\n    pages = []\n    for _ in range(needed_pages):\n        page = free_list.pop() if free_list else cuda_malloc(page_size)\n        pages.append(page)\n    page_table[request_id].extend(pages)\n    return pages\n\n# è§£ç é˜¶æ®µè®¿é—®\nfor token in batch:\n    pages = page_table[token.req]\n    kv_ptrs = gather_kv(pages, token.position)\n    attention_step(kv_ptrs, token)"
        }
      ]
    }
  ]
}