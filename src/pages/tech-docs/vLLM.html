<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>vLLMï¼šPagedAttention æ¨ç†å¼•æ“</title>
    <script>
        window.MathJax = { tex: { inlineMath: [['$', '$'], ['\\(', '\\)']], displayMath: [['$$', '$$'], ['\\[', '\\]']] }, options: { skipHtmlTags: ['script','noscript','style','textarea','pre','code'] } };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    
    <!-- å…¬å…±æ ·å¼ -->
    <link rel="stylesheet" href="../common/styles.css">
</head>
<body>
    <div class="container">
        <h1>vLLMï¼šåŸºäº PagedAttention çš„é«˜ååæ¨ç†å¼•æ“</h1>
        <p class="tagline">é€šè¿‡åˆ†é¡µ KV Cache + å¹¶è¡Œè°ƒåº¦å™¨ï¼Œåœ¨å•å¡ä¸Šå³å¯å®ç°æ•°åƒ token/s çš„ç”Ÿæˆèƒ½åŠ›ã€‚</p>

        <div class="meta-grid">
            <div class="meta-card"><h3>æ ¸å¿ƒç»„ä»¶</h3><p>PagedAttentionã€å¼‚æ­¥è°ƒåº¦å™¨ã€è¿ç»­æ‰¹å¤„ç†ã€Chunked Prefillã€‚</p></div>
            <div class="meta-card"><h3>ä¼˜åŠ¿</h3><p>é«˜ååã€ä½å»¶è¿Ÿã€æ˜“é›†æˆã€æ”¯æŒ OpenAI-API å…¼å®¹æ¥å£ã€‚</p></div>
            <div class="meta-card"><h3>æ”¯æŒç‰¹æ€§</h3><p>å¤šæ¨¡å‹å¹¶å‘ã€æµå¼è¾“å‡ºã€LoRA çƒ­åŠ è½½ã€KV Cache å…±äº«ã€‚</p></div>
            <div class="meta-card"><h3>éƒ¨ç½²</h3><p>Python SDKã€RESTful Serverã€K8s Operatorã€Ray Serveã€‚</p></div>
        </div>

        <div class="section">
            <h2>ğŸš€ æŠ€æœ¯è¦ç‚¹</h2>
            <ul>
                <li><strong>PagedAttentionï¼š</strong>å°† KV Cache åˆ†ä¸ºå›ºå®šå¤§å° pageï¼Œé€šè¿‡ page table å¿«é€Ÿæ˜ å°„ã€‚</li>
                <li><strong>Continuous batchingï¼š</strong>åŠ¨æ€åŠ å…¥/ç§»é™¤è¯·æ±‚ï¼Œå‡å°‘ç©ºé—²è®¡ç®—ã€‚</li>
                <li><strong>Chunked Prefillï¼š</strong>æŒ‰å—åŠ è½½é•¿ä¸Šä¸‹æ–‡ï¼Œæå‡åˆ©ç”¨ç‡ã€‚</li>
                <li><strong>Memory managerï¼š</strong>è‡ªåŠ¨å›æ”¶é—²ç½® pageï¼Œé¿å… OOMã€‚</li>
            </ul>
        </div>

        <div class="section">
            <h2>ğŸ“Š å›¾è§£</h2>
            <div class="diagram-gallery">
                <div class="diagram-item"><img src="./assets/vLLMæ¶æ„.png" alt="æ¶æ„" onclick="openImageModal(this)" onerror="this.parentElement.style.display='none'"><div class="caption">æ¶æ„</div></div>
                <div class="diagram-item"><img src="./assets/PagedAttentionæµç¨‹.png" alt="PagedAttention" onclick="openImageModal(this)" onerror="this.parentElement.style.display='none'"><div class="caption">PagedAttention</div></div>
                <div class="diagram-item"><img src="./assets/vLLMè°ƒåº¦.png" alt="è°ƒåº¦å™¨" onclick="openImageModal(this)" onerror="this.parentElement.style.display='none'"><div class="caption">è°ƒåº¦å™¨</div></div>
            </div>
        </div>

        <div class="section">
            <h2>ğŸ“ æ•°å­¦/æ€§èƒ½æ¨¡å‹</h2>
            <div class="math-box">
                <h3>ååä¸Šç•Œ</h3>
                <div class="math-formula">
                    <p>$$TPS \approx \frac{B_{eff} \times d_{model} \times H}{\text{latency}_{\text{step}}}$$</p>
                    <p>vLLM é€šè¿‡æå‡æœ‰æ•ˆæ‰¹æ¬¡ $B_{eff}$ ä¸é™ä½ step å»¶è¿Ÿæ¥é€¼è¿‘ä¸Šç•Œã€‚</p>
                </div>
            </div>
            <div class="math-box">
                <h3>åˆ†é¡µå‘½ä¸­ç‡</h3>
                <div class="math-formula">
                    <p>$$\text{HitRate} = 1 - \frac{\text{page\_faults}}{\text{total\_access}}$$</p>
                    <p>è¿ç»­æ‰¹å¤„ç†èƒ½æé«˜å‘½ä¸­ç‡ï¼Œä»è€Œç¨³å®šå»¶è¿Ÿã€‚</p>
                </div>
            </div>
        </div>

        <div class="section">
            <h2>ğŸ’» ä»£ç ç¤ºä¾‹</h2>
            <div class="code-box">
                <h3>å¯åŠ¨ REST Server</h3>
<pre><code class="language-bash">pip install vllm
python -m vllm.entrypoints.openai.api_server \
  --model meta-llama/Llama-3-8b-Instruct \
  --gpu-memory-utilization 0.9 \
  --port 8000
</code></pre>
                <h3>Python SDK</h3>
<pre><code class="language-python">from vllm import LLM, SamplingParams

llm = LLM("mistralai/Mixtral-8x7B-Instruct", tensor_parallel_size=2)
params = SamplingParams(max_tokens=128, temperature=0.6)

for output in llm.generate(["è§£é‡Š PagedAttention çš„ä¼˜åŠ¿"], params):
    print(output.outputs[0].text)
</code></pre>
            </div>
        </div>
    </div>

    <div id="imageModal" class="image-modal" onclick="closeImageModal()">
        <span class="image-modal-close" onclick="event.stopPropagation(); closeImageModal();">&times;</span>
        <img id="modalImage" class="image-modal-content" src="" alt="">
        <div id="modalCaption" class="image-modal-caption"></div>
    </div>

    <script>
        function openImageModal(img){const modal=document.getElementById('imageModal');modal.classList.add('active');document.getElementById('modalImage').src=img.src;document.getElementById('modalCaption').textContent=img.alt||'';}
        function closeImageModal(){document.getElementById('imageModal').classList.remove('active');}
        document.addEventListener('keydown',e=>{if(e.key==='Escape')closeImageModal();});
    </script>
    <!-- å…¬å…±è„šæœ¬ -->
    <script src="../common/tech-document.js"></script>
</body>
</html>
