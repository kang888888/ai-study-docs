<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DQN (Deep Q-Network) æ·±åº¦Qç½‘ç»œ - æ¶æ„è¯¦è§£</title>
    <!-- MathJax for mathematical formulas -->
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']],
                processEscapes: true,
                processEnvironments: true
            },
            options: {
                skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
            }
        };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <!-- Prism.js for code highlighting -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    
    <!-- å…¬å…±æ ·å¼ -->
    <link rel="stylesheet" href="../common/styles.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>DQN (Deep Q-Network) æ·±åº¦Qç½‘ç»œ</h1>
            <p>ç»“åˆæ·±åº¦å­¦ä¹ ä¸å¼ºåŒ–å­¦ä¹ çš„é©å‘½æ€§ç®—æ³•</p>
        </div>
        <div class="content">
            
            
            <div class="section">
                <h2>ğŸ“– æ ¸å¿ƒæ¦‚å¿µ</h2>
                <div class="desc-box">
                    <p>DeepMindæå‡ºçš„å°†æ·±åº¦å­¦ä¹ ä¸å¼ºåŒ–å­¦ä¹ ç»“åˆçš„ç®—æ³•ã€‚ä½¿ç”¨æ·±åº¦ç¥ç»ç½‘ç»œè¿‘ä¼¼Qå‡½æ•°ï¼ˆçŠ¶æ€-åŠ¨ä½œä»·å€¼å‡½æ•°ï¼‰ï¼Œé€šè¿‡ç»éªŒå›æ”¾å’Œç›®æ ‡ç½‘ç»œç¨³å®šè®­ç»ƒã€‚</p>
                </div>
            </div>

            <div class="section features">
                <h2>ğŸŒŸ æ ¸å¿ƒç‰¹ç‚¹</h2>
                <ul>
                    <li>Qå‡½æ•°è¿‘ä¼¼ï¼šç”¨ç¥ç»ç½‘ç»œæ‹ŸåˆQ(s, a)ï¼Œè§£å†³çŠ¶æ€ç©ºé—´è¿‡å¤§é—®é¢˜</li>
                    <li>ç»éªŒå›æ”¾ï¼šå­˜å‚¨å†å²ç»éªŒï¼Œæ‰“ç ´æ•°æ®ç›¸å…³æ€§</li>
                    <li>ç›®æ ‡ç½‘ç»œï¼šå›ºå®šç›®æ ‡Qå€¼ï¼Œç¨³å®šè®­ç»ƒè¿‡ç¨‹</li>
                    <li>Îµ-è´ªå©ªç­–ç•¥ï¼šå¹³è¡¡æ¢ç´¢ä¸åˆ©ç”¨</li>
                    <li>ç«¯åˆ°ç«¯å­¦ä¹ ï¼šç›´æ¥ä»åƒç´ è¾“å…¥å­¦ä¹ ç­–ç•¥</li>
                </ul>
            </div>

            <div class="section">
                <h2>âš™ï¸ å…³é”®æŠ€æœ¯</h2>
                <div class="tech-box">
                    <p><strong>Q-Learningã€ç»éªŒå›æ”¾ç¼“å†²åŒºï¼ˆReplay Bufferï¼‰ã€ç›®æ ‡ç½‘ç»œï¼ˆTarget Networkï¼‰ã€TDè¯¯å·®</strong></p>
                </div>
            </div>

            <div class="section">
                <h2>ğŸš€ åº”ç”¨åœºæ™¯</h2>
                <div class="app-box">
                    <p>æ¸¸æˆAIï¼ˆAtariæ¸¸æˆï¼‰ã€æœºå™¨äººæ§åˆ¶ã€èµ„æºè°ƒåº¦ã€è‡ªåŠ¨é©¾é©¶å†³ç­–</p>
                </div>
            </div>

            <div class="section">
                <h2>ğŸ“Š æ¶æ„å›¾è§£</h2>
                <div class="diagram-gallery">
                    <div class="diagram-item">
                        <img src="DQNæ¶æ„å›¾.png" alt="DQNæ¶æ„å›¾" onclick="openImageModal(this)" onerror="this.parentElement.style.display='none'">
                        <div class="caption">DQNæ¶æ„å›¾</div>
                    </div>
                    <div class="diagram-item">
                        <img src="DQNè®­ç»ƒè¿‡ç¨‹.png" alt="DQNè®­ç»ƒè¿‡ç¨‹" onclick="openImageModal(this)" onerror="this.parentElement.style.display='none'">
                        <div class="caption">DQNè®­ç»ƒè¿‡ç¨‹</div>
                    </div>
                    <div class="diagram-item">
                        <img src="Qå€¼å­¦ä¹ è¿‡ç¨‹.png" alt="Qå€¼å­¦ä¹ è¿‡ç¨‹" onclick="openImageModal(this)" onerror="this.parentElement.style.display='none'">
                        <div class="caption">Qå€¼å­¦ä¹ è¿‡ç¨‹</div>
                    </div>
                    <div class="diagram-item">
                        <img src="DQNå˜ä½“å¯¹æ¯”.png" alt="DQNå˜ä½“å¯¹æ¯”" onclick="openImageModal(this)" onerror="this.parentElement.style.display='none'">
                        <div class="caption">DQNå˜ä½“å¯¹æ¯”</div>
                    </div>
=0                    <div class="diagram-item">
                        <img src="DQNæ¨¡å‹ç»“æ„.svg" alt="DQNæ¨¡å‹ç»“æ„" onclick="openImageModal(this)" onerror="this.parentElement.style.display='none'">
                        <div class="caption">ä¸¤ç§è¾“å…¥è¾“å‡ºç»“æ„çš„DQNæ¨¡å‹</div>
                    </div>
                    <div class="diagram-item">
                        <img src="DQNåº”ç”¨ç¤ºä¾‹.svg" alt="DQNåº”ç”¨ç¤ºä¾‹" onclick="openImageModal(this)" onerror="this.parentElement.style.display='none'">
                        <div class="caption">DQNçš„å®é™…åº”ç”¨ç¤ºä¾‹</div>
                    </div>
                    <div class="diagram-item">
                        <img src="DQNé«˜ä¼°é—®é¢˜.svg" alt="DQNé«˜ä¼°é—®é¢˜" onclick="openImageModal(this)" onerror="this.parentElement.style.display='none'">
                        <div class="caption">DQNçš„"é«˜ä¼°"é—®é¢˜</div>
                    </div>
                    <div class="diagram-item">
                        <img src="ä»·å€¼å‡½æ•°å…³ç³».svg" alt="ä»·å€¼å‡½æ•°å…³ç³»" onclick="openImageModal(this)" onerror="this.parentElement.style.display='none'">
                        <div class="caption">ä»·å€¼å‡½æ•°QÏ€ä¸VÏ€çš„å…³ç³»</div>
                    </div>
                    <div class="diagram-item">
                        <img src="Æ-è´ªå©ªç­–ç•¥.svg" alt="Æ-è´ªå©ªç­–ç•¥" onclick="openImageModal(this)" onerror="this.parentElement.style.display='none'">
                        <div class="caption">Æ-è´ªå©ªç­–ç•¥ä¸‹ä½¿ç”¨åŠ¨æ€çš„Æå€¼</div>
                    </div>
                    <div class="diagram-item">
                        <img src="TDç›®æ ‡ä¸è¯¯å·®.svg" alt="TDç›®æ ‡ä¸è¯¯å·®" onclick="openImageModal(this)" onerror="this.parentElement.style.display='none'">
                        <div class="caption">TDç›®æ ‡ä¸TDè¯¯å·®çš„å…³ç³»</div>
                    </div>
                    <div class="diagram-item">
                        <img src="TDæ–¹æ³•å¯¹æ¯”.svg" alt="TDæ–¹æ³•å¯¹æ¯”" onclick="openImageModal(this)" onerror="this.parentElement.style.display='none'">
                        <div class="caption">TD(0)ã€å¤šæ­¥TDä¸è’™ç‰¹å¡æ´›ï¼ˆMCï¼‰çš„å…³ç³»</div>
                    </div>
                    <div class="diagram-item">
                        <img src="è’™ç‰¹å¡æ´›ä¸TDå¯¹æ¯”.svg" alt="è’™ç‰¹å¡æ´›ä¸TDå¯¹æ¯”" onclick="openImageModal(this)" onerror="this.parentElement.style.display='none'">
                        <div class="caption">è’™ç‰¹å¡æ´›æ–¹æ³•ä¸TDæ–¹æ³•çš„ç‰¹æ€§</div>
                    </div>
                    <div class="diagram-item">
                        <img src="å›æŠ¥ç´¯è®¡å¥–åŠ±.svg" alt="å›æŠ¥ç´¯è®¡å¥–åŠ±" onclick="openImageModal(this)" onerror="this.parentElement.style.display='none'">
                        <div class="caption">å›æŠ¥ï¼ˆç´¯è®¡å¥–åŠ±ï¼‰</div>
                    </div>
                    <div class="diagram-item">
                        <img src="åå‘è¿­ä»£è®¡ç®—å›æŠ¥.svg" alt="åå‘è¿­ä»£è®¡ç®—å›æŠ¥" onclick="openImageModal(this)" onerror="this.parentElement.style.display='none'">
                        <div class="caption">åå‘è¿­ä»£å¹¶è®¡ç®—å›æŠ¥G</div>
                    </div>
                </div>
            </div>

            <div class="section">
                <h2>ğŸ“ æ•°å­¦åŸç†</h2>
                <div class="math-box">
                    <h3>Q-Learning æ›´æ–°è§„åˆ™</h3>
                    <div class="math-formula">
                        <p>Qå€¼çš„æ›´æ–°å…¬å¼ï¼š</p>
                        <p>$$Q(s_t, a_t) \leftarrow Q(s_t, a_t) + \alpha[r_{t+1} + \gamma \max_{a} Q(s_{t+1}, a) - Q(s_t, a_t)]$$</p>
                        <p>å…¶ä¸­ï¼š</p>
                        <ul style="list-style: none; padding-left: 20px;">
                            <li>$\alpha$ æ˜¯å­¦ä¹ ç‡</li>
                            <li>$\gamma$ æ˜¯æŠ˜æ‰£å› å­</li>
                            <li>$r_{t+1}$ æ˜¯å³æ—¶å¥–åŠ±</li>
                            <li>$s_t, a_t$ æ˜¯å½“å‰çŠ¶æ€å’ŒåŠ¨ä½œ</li>
                        </ul>
                    </div>
                </div>
                <div class="math-box">
                    <h3>DQN æŸå¤±å‡½æ•°</h3>
                    <div class="math-formula">
                        <p>ä½¿ç”¨ç¥ç»ç½‘ç»œè¿‘ä¼¼Qå‡½æ•°ï¼ŒæŸå¤±å‡½æ•°ä¸ºï¼š</p>
                        <p>$$L(\theta) = \mathbb{E}[(r + \gamma \max_{a'} Q(s', a'; \theta^-) - Q(s, a; \theta))^2]$$</p>
                        <p>å…¶ä¸­ $\theta$ æ˜¯ä¸»ç½‘ç»œå‚æ•°ï¼Œ$\theta^-$ æ˜¯ç›®æ ‡ç½‘ç»œå‚æ•°</p>
                    </div>
                </div>
                <div class="math-box">
                    <h3>Îµ-è´ªå©ªç­–ç•¥</h3>
                    <div class="math-formula">
                        <p>å¹³è¡¡æ¢ç´¢ä¸åˆ©ç”¨ï¼š</p>
                        <p>$$a_t = \begin{cases}
                        \text{éšæœºåŠ¨ä½œ} & \text{ä»¥æ¦‚ç‡ } \epsilon \\
                        \arg\max_a Q(s_t, a) & \text{ä»¥æ¦‚ç‡ } 1-\epsilon
                        \end{cases}$$</p>
                    </div>
                </div>
            </div>

            <div class="section">
                <h2>ğŸ’» Python ä»£ç ç¤ºä¾‹</h2>
                <div class="code-box">
                    <h3>ä½¿ç”¨ PyTorch å®ç° DQN</h3>
                    <pre><code class="language-python">import torch
import torch.nn as nn
import torch.optim as optim
import torch.nn.functional as F
import numpy as np
from collections import deque
import random

class DQN(nn.Module):
    """Deep Q-Network æ¨¡å‹"""
    def __init__(self, state_size, action_size, hidden_size=128):
        super(DQN, self).__init__()
        
        self.fc1 = nn.Linear(state_size, hidden_size)
        self.fc2 = nn.Linear(hidden_size, hidden_size)
        self.fc3 = nn.Linear(hidden_size, action_size)
    
    def forward(self, x):
        x = F.relu(self.fc1(x))
        x = F.relu(self.fc2(x))
        return self.fc3(x)

class ReplayBuffer:
    """ç»éªŒå›æ”¾ç¼“å†²åŒº"""
    def __init__(self, capacity=10000):
        self.buffer = deque(maxlen=capacity)
    
    def push(self, state, action, reward, next_state, done):
        self.buffer.append((state, action, reward, next_state, done))
    
    def sample(self, batch_size):
        batch = random.sample(self.buffer, batch_size)
        states, actions, rewards, next_states, dones = zip(*batch)
        
        return (np.array(states), np.array(actions), np.array(rewards),
                np.array(next_states), np.array(dones))
    
    def __len__(self):
        return len(self.buffer)

class DQNAgent:
    """DQN æ™ºèƒ½ä½“"""
    def __init__(self, state_size, action_size, lr=0.001, gamma=0.99,
                 epsilon=1.0, epsilon_min=0.01, epsilon_decay=0.995,
                 memory_size=10000, batch_size=64, target_update=100):
        self.state_size = state_size
        self.action_size = action_size
        self.gamma = gamma
        self.epsilon = epsilon
        self.epsilon_min = epsilon_min
        self.epsilon_decay = epsilon_decay
        self.batch_size = batch_size
        self.target_update = target_update
        self.update_counter = 0
        
        # ä¸»ç½‘ç»œå’Œç›®æ ‡ç½‘ç»œ
        self.q_network = DQN(state_size, action_size)
        self.target_network = DQN(state_size, action_size)
        self.target_network.load_state_dict(self.q_network.state_dict())
        
        self.optimizer = optim.Adam(self.q_network.parameters(), lr=lr)
        self.memory = ReplayBuffer(memory_size)
    
    def remember(self, state, action, reward, next_state, done):
        """å­˜å‚¨ç»éªŒ"""
        self.memory.push(state, action, reward, next_state, done)
    
    def act(self, state, training=True):
        """é€‰æ‹©åŠ¨ä½œï¼ˆÎµ-è´ªå©ªç­–ç•¥ï¼‰"""
        if training and np.random.random() <= self.epsilon:
            return random.randrange(self.action_size)
        
        state = torch.FloatTensor(state).unsqueeze(0)
        q_values = self.q_network(state)
        return q_values.argmax().item()
    
    def replay(self):
        """ç»éªŒå›æ”¾è®­ç»ƒ"""
        if len(self.memory) < self.batch_size:
            return
        
        # ä»ç¼“å†²åŒºé‡‡æ ·
        states, actions, rewards, next_states, dones = self.memory.sample(self.batch_size)
        
        states = torch.FloatTensor(states)
        actions = torch.LongTensor(actions)
        rewards = torch.FloatTensor(rewards)
        next_states = torch.FloatTensor(next_states)
        dones = torch.BoolTensor(dones)
        
        # å½“å‰Qå€¼
        current_q_values = self.q_network(states).gather(1, actions.unsqueeze(1))
        
        # ç›®æ ‡Qå€¼
        with torch.no_grad():
            next_q_values = self.target_network(next_states).max(1)[0]
            target_q_values = rewards + (self.gamma * next_q_values * ~dones)
        
        # è®¡ç®—æŸå¤±
        loss = F.mse_loss(current_q_values.squeeze(), target_q_values)
        
        # ä¼˜åŒ–
        self.optimizer.zero_grad()
        loss.backward()
        self.optimizer.step()
        
        # æ›´æ–°epsilon
        if self.epsilon > self.epsilon_min:
            self.epsilon *= self.epsilon_decay
        
        # æ›´æ–°ç›®æ ‡ç½‘ç»œ
        self.update_counter += 1
        if self.update_counter % self.target_update == 0:
            self.target_network.load_state_dict(self.q_network.state_dict())
        
        return loss.item()

# ä½¿ç”¨ç¤ºä¾‹
if __name__ == "__main__":
    # åˆ›å»ºæ™ºèƒ½ä½“
    agent = DQNAgent(state_size=4, action_size=2)
    
    # æ¨¡æ‹Ÿè®­ç»ƒè¿‡ç¨‹
    for episode in range(100):
        state = np.random.randn(4)  # åˆå§‹çŠ¶æ€
        
        for step in range(200):
            # é€‰æ‹©åŠ¨ä½œ
            action = agent.act(state)
            
            # æ‰§è¡ŒåŠ¨ä½œï¼Œè·å¾—å¥–åŠ±å’Œä¸‹ä¸€çŠ¶æ€ï¼ˆè¿™é‡Œç”¨éšæœºå€¼æ¨¡æ‹Ÿï¼‰
            next_state = np.random.randn(4)
            reward = np.random.randn()
            done = step == 199
            
            # å­˜å‚¨ç»éªŒ
            agent.remember(state, action, reward, next_state, done)
            
            # è®­ç»ƒ
            if len(agent.memory) > agent.batch_size:
                loss = agent.replay()
                if step % 10 == 0:
                    print(f"Episode {episode}, Step {step}, Loss: {loss:.4f}")
            
            state = next_state
            
            if done:
                break</code></pre>
                </div>
            </div>
        </div>
    </div>

    <!-- å›¾ç‰‡æ”¾å¤§å¼¹çª— -->
    <div id="imageModal" class="image-modal" onclick="closeImageModal()">
        <span class="image-modal-close" onclick="event.stopPropagation(); closeImageModal()">&times;</span>
        <img id="modalImage" class="image-modal-content" src="" alt="">
        <div id="modalCaption" class="image-modal-caption"></div>
    </div>

    <script>
        function openImageModal(img) {
            const modal = document.getElementById('imageModal');
            const modalImg = document.getElementById('modalImage');
            const modalCaption = document.getElementById('modalCaption');
            
            modal.classList.add('active');
            modalImg.src = img.src;
            modalCaption.textContent = img.alt || '';
            
            // é˜»æ­¢äº‹ä»¶å†’æ³¡ï¼Œé¿å…ç‚¹å‡»å›¾ç‰‡æ—¶å…³é—­å¼¹çª—
            modalImg.onclick = function(e) {
                e.stopPropagation();
            };
        }

        function closeImageModal() {
            const modal = document.getElementById('imageModal');
            modal.classList.remove('active');
        }

        // æŒ‰ESCé”®å…³é—­å¼¹çª—
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeImageModal();
            }
        });
    </script>
    <!-- å…¬å…±è„šæœ¬ -->
    <script src="../common/tech-document.js"></script>
</body>
</html>

