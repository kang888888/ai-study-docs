<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AWQï¼ˆActivation-aware Weight Quantizationï¼‰è¯¦è§£</title>
    <script>
        window.MathJax = { tex: { inlineMath: [['$', '$'], ['\\(', '\\)']], displayMath: [['$$', '$$'], ['\\[', '\\]']] }, options: { skipHtmlTags: ['script','noscript','style','textarea','pre','code'] } };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    
    <!-- å…¬å…±æ ·å¼ -->
    <link rel="stylesheet" href="../common/styles.css">
</head>
<body>
    <div class="container">
        <h1>AWQï¼šActivation-aware Weight Quantization</h1>
        <p class="tagline">é€šè¿‡æ¿€æ´»æ„ŸçŸ¥çš„ç¼©æ”¾å› å­ä¸ outlier å¤„ç†ï¼Œä½¿ 4bit é‡åŒ–åœ¨ä¿æŒé«˜ç²¾åº¦çš„åŒæ—¶æ— éœ€å¤æ‚çš„å†è®­ç»ƒã€‚</p>

        <div class="meta-grid">
            <div class="meta-card"><h3>äº®ç‚¹</h3><p>ä¸“æ³¨æƒé‡é‡åŒ–ä½†å‚è€ƒæ¿€æ´»åˆ†å¸ƒï¼Œæ”¯æŒé«˜è¾¾ 8K åºåˆ—é•¿åº¦ã€‚</p></div>
            <div class="meta-card"><h3>æ ¸å¿ƒæŠ€æœ¯</h3><p>æ¿€æ´»æ ¡å‡†ã€é€šé“é‡è¦æ€§è¯„åˆ†ã€é‡ç¼©æ”¾çŸ©é˜µã€æƒé‡å‰ªæã€‚</p></div>
            <div class="meta-card"><h3>å…¼å®¹æ€§</h3><p>æ”¯æŒ LLaMA/Mistral/Qwen/RWKV ç­‰å¤šç§æ¶æ„ï¼Œå¯ä¸ TensorRT-LLM é›†æˆã€‚</p></div>
            <div class="meta-card"><h3>åº”ç”¨</h3><p>æ¯” GPTQ æ›´å¿«çš„ç”Ÿæˆã€å›¾åƒå¤šæ¨¡æ€æ¨¡å‹ã€è¾¹ç¼˜è®¾å¤‡éƒ¨ç½²ã€‚</p></div>
        </div>

        <div class="section">
            <h2>ğŸŒ¸ æŠ€æœ¯è¦ç‚¹</h2>
            <ul>
                <li><strong>æ¿€æ´»é‡‡æ ·ï¼š</strong>åˆ©ç”¨æ ¡å‡†é›†ç»Ÿè®¡æ¿€æ´»çš„æœ€å¤§å“åº”ï¼Œç¡®å®šæœ€éœ€è¦é«˜ç²¾åº¦çš„é€šé“ã€‚</li>
                <li><strong>æ˜¾è‘—æ€§è¯„åˆ†ï¼š</strong>æ ¹æ® $||W_i A_i||$ æ’åºï¼Œå†³å®šå“ªäº›é€šé“ä½¿ç”¨æ›´å¤§çš„ç¼©æ”¾ã€‚</li>
                <li><strong>é‡ç¼©æ”¾å› å­ï¼š</strong>å¼•å…¥å¯¹è§’çŸ©é˜µ $D$ï¼Œåœ¨é‡åŒ–å‰è¿›è¡Œ $W' = D W$ï¼Œé‡åŒ–åå†ä¹˜ $D^{-1}$ è¿˜åŸã€‚</li>
                <li><strong>æ¨ç†å‹å¥½ï¼š</strong>å¯å¯¼å‡ºåˆ° TensorRT/ONNXï¼Œé€Ÿåº¦ä¼˜äºä¼ ç»Ÿ GPTQã€‚</li>
            </ul>
        </div>

        <div class="section">
            <h2>ğŸ“Š å›¾è§£</h2>
            <div class="diagram-gallery">
                <div class="diagram-item"><img src="./assets/AWQæµç¨‹.png" alt="AWQ æµç¨‹" onclick="openImageModal(this)" onerror="this.parentElement.style.display='none'"><div class="caption">æµç¨‹</div></div>
                <div class="diagram-item"><img src="./assets/AWQç¼©æ”¾.png" alt="ç¼©æ”¾å› å­" onclick="openImageModal(this)" onerror="this.parentElement.style.display='none'"><div class="caption">ç¼©æ”¾å› å­</div></div>
                <div class="diagram-item"><img src="./assets/AWQå¯¹æ¯”.png" alt="ä¸ GPTQ å¯¹æ¯”" onclick="openImageModal(this)" onerror="this.parentElement.style.display='none'"><div class="caption">ç²¾åº¦/é€Ÿåº¦å¯¹æ¯”</div></div>
            </div>
        </div>

        <div class="section">
            <h2>ğŸ“ æ•°å­¦åŸç†</h2>
            <div class="math-box">
                <h3>æ˜¾è‘—æ€§æŒ‡æ ‡</h3>
                <div class="math-formula">
                    <p>é€šé“é‡è¦æ€§ï¼š$$s_i = \| W_i A_i \|_2$$</p>
                    <p>å…¶ä¸­ $A_i$ ä¸ºæ¿€æ´»æ ·æœ¬ï¼Œ$W_i$ ä¸ºå¯¹åº”åˆ—ã€‚</p>
                </div>
            </div>
            <div class="math-box">
                <h3>é‡ç¼©æ”¾é‡åŒ–</h3>
                <div class="math-formula">
                    <p>é‡åŒ–å‰ï¼š$W' = D W$ï¼Œé‡åŒ–åï¼š$\hat{W} = D^{-1} \text{Quant}(W')$</p>
                    <p>é€‰æ‹© $D$ ä½¿å¾—è¢«æ”¾å¤§çš„é€šé“åœ¨ 4bit ä¸‹ä»ä¿æŒç»†èŠ‚ã€‚</p>
                </div>
            </div>
        </div>

        <div class="section">
            <h2>ğŸ’» Python ä»£ç ç¤ºä¾‹</h2>
            <div class="code-box">
                <h3>ä½¿ç”¨ awq åº“é‡åŒ– LLaMA</h3>
                <pre><code class="language-python">from awq import AutoAWQForCausalLM
from transformers import AutoTokenizer

model_path = "meta-llama/Llama-2-7b-hf"
quant_path = "./llama2-awq"

model = AutoAWQForCausalLM.from_pretrained(
    model_path,
    low_bit="w4a16",
    fuse_layers=True
)

tokenizer = AutoTokenizer.from_pretrained(model_path, use_fast=False)
model.quantize(tokenizer=tokenizer, calib_data="./calib.jsonl")
model.save_quantized(quant_path)
</code></pre>
            </div>
        </div>
    </div>

    <div id="imageModal" class="image-modal" onclick="closeImageModal()">
        <span class="image-modal-close" onclick="event.stopPropagation(); closeImageModal();">&times;</span>
        <img id="modalImage" class="image-modal-content" src="" alt="">
        <div id="modalCaption" class="image-modal-caption"></div>
    </div>

    <script>
        function openImageModal(img){const modal=document.getElementById('imageModal');modal.classList.add('active');document.getElementById('modalImage').src=img.src;document.getElementById('modalCaption').textContent=img.alt||'';}
        function closeImageModal(){document.getElementById('imageModal').classList.remove('active');}
        document.addEventListener('keydown',e=>{if(e.key==='Escape')closeImageModal();});
    </script>
    <!-- å…¬å…±è„šæœ¬ -->
    <script src="../common/tech-document.js"></script>
</body>
</html>
