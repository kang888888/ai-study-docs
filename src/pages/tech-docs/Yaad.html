<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Yaad - åŸºäºMirasæ¡†æ¶çš„ä¼˜åŒ–æ³¨æ„åŠ›åå·®æ¨¡å‹</title>
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']],
                processEscapes: true,
                processEnvironments: true
            },
            options: {
                skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
            }
        };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    
    <!-- å…¬å…±æ ·å¼ -->
    <link rel="stylesheet" href="../common/styles.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Yaad</h1>
            <p>åŸºäºMirasæ¡†æ¶çš„ä¼˜åŒ–æ³¨æ„åŠ›åå·®æ¨¡å‹</p>
        </div>
        <div class="content">
            <div class="section">
                <h2>ğŸ“– æ ¸å¿ƒæ¦‚å¿µ</h2>
                <div class="desc-box">
                    <p><strong>Yaad</strong> æ˜¯åŸºäº Miras æ¡†æ¶æå‡ºçš„ä¼˜åŒ–æ³¨æ„åŠ›åå·®æ¨¡å‹ï¼Œä¸“æ³¨äºæ›´å¥½çš„ä¿¡æ¯é€‰æ‹©å’Œç²¾ç¡®æ£€ç´¢ã€‚Yaad é€šè¿‡å­¦ä¹ æœ€ä¼˜çš„æ³¨æ„åŠ›åå·®æ¨¡å¼ï¼Œèƒ½å¤Ÿç²¾ç¡®è¿‡æ»¤å™ªå£°ï¼Œæé«˜æ£€ç´¢ç²¾åº¦ï¼Œé€‚ç”¨äºéœ€è¦ç²¾ç¡®æ£€ç´¢çš„ä»»åŠ¡ã€‚</p>
                </div>
            </div>
            <div class="section features">
                <h2>ğŸŒŸ æ ¸å¿ƒç‰¹ç‚¹</h2>
                <ul>
                    <li><strong>ä¼˜åŒ–çš„æ³¨æ„åŠ›åå·®</strong>ï¼šå­¦ä¹ æœ€ä¼˜çš„åå·®æ¨¡å¼ï¼Œç²¾ç¡®æ§åˆ¶ä¿¡æ¯å…³æ³¨</li>
                    <li><strong>æ›´å¥½çš„ä¿¡æ¯é€‰æ‹©</strong>ï¼šæ™ºèƒ½è¿‡æ»¤ä¸ç›¸å…³ä¿¡æ¯ï¼Œæé«˜æ£€ç´¢è´¨é‡</li>
                    <li><strong>ç²¾ç¡®æ£€ç´¢</strong>ï¼šé€šè¿‡ä¼˜åŒ–çš„åå·®å®ç°é«˜ç²¾åº¦ä¿¡æ¯æ£€ç´¢</li>
                    <li><strong>å‡å°‘å™ªå£°å¹²æ‰°</strong>ï¼šæœ‰æ•ˆé™ä½ä¸ç›¸å…³è®°å¿†çš„æƒé‡ï¼Œæé«˜æ£€ç´¢ç²¾åº¦</li>
                </ul>
            </div>
            <div class="section">
                <h2>âš™ï¸ æŠ€æœ¯æ¶æ„</h2>
                <div class="tech-box">
                    <p><strong>æ³¨æ„åŠ›åå·®å­¦ä¹ </strong>ï¼šé€šè¿‡è®­ç»ƒå­¦ä¹ æœ€ä¼˜çš„æ³¨æ„åŠ›åå·®æ¨¡å¼ï¼Œæœ€å¤§åŒ–ç›¸å…³æ€§ï¼Œæœ€å°åŒ–å†—ä½™</p>
                </div>
                <div class="tech-box">
                    <p><strong>è‡ªé€‚åº”åå·®è°ƒæ•´</strong>ï¼šæ ¹æ®ä»»åŠ¡å’Œè¾“å…¥å†…å®¹åŠ¨æ€è°ƒæ•´æ³¨æ„åŠ›åå·®ï¼Œå®ç°ç²¾ç¡®æ£€ç´¢</p>
                </div>
                <div class="tech-box">
                    <p><strong>å™ªå£°è¿‡æ»¤æœºåˆ¶</strong>ï¼šé€šè¿‡ä¼˜åŒ–çš„åå·®é™ä½ä¸ç›¸å…³è®°å¿†çš„æƒé‡ï¼Œå‡å°‘å™ªå£°å¹²æ‰°</p>
                </div>
            </div>
            <div class="section">
                <h2>ğŸ“ æ•°å­¦åŸç†</h2>
                <div class="math-box">
                    <h3>ä¼˜åŒ–çš„æ³¨æ„åŠ›åå·®</h3>
                    <div class="math-formula">
                        <p>Yaad çš„æ³¨æ„åŠ›æƒé‡è®¡ç®—ï¼š</p>
                        <p>$$\alpha_i = \text{softmax}(\text{score}(q, k_i) + \text{bias}_i(\theta))$$</p>
                        <p>å…¶ä¸­ $\text{bias}_i(\theta)$ æ˜¯å¯å­¦ä¹ çš„åå·®å‡½æ•°ï¼Œé€šè¿‡è®­ç»ƒä¼˜åŒ–ï¼š</p>
                        <p>$$\theta^* = \arg\min_\theta \mathcal{L}(\text{retrieval}, \text{ground\_truth})$$</p>
                        <p>ä¼˜åŒ–çš„ç›®æ ‡æ˜¯ï¼š</p>
                        <ul style="list-style: none; padding-left: 0;">
                            <li>â€¢ <strong>æœ€å¤§åŒ–ç›¸å…³æ€§</strong>ï¼šæé«˜ç›¸å…³è®°å¿†çš„æƒé‡</li>
                            <li>â€¢ <strong>æœ€å°åŒ–å†—ä½™</strong>ï¼šå‡å°‘é‡å¤å…³æ³¨</li>
                            <li>â€¢ <strong>è¿‡æ»¤å™ªå£°</strong>ï¼šé™ä½ä¸ç›¸å…³è®°å¿†çš„æƒé‡</li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="section">
                <h2>ğŸš€ åº”ç”¨åœºæ™¯</h2>
                <div class="app-box">
                    <p><strong>ç²¾ç¡®æ£€ç´¢ä»»åŠ¡</strong>ï¼šéœ€è¦é«˜ç²¾åº¦ä¿¡æ¯æ£€ç´¢çš„åœºæ™¯</p>
                    <p><strong>ä¿¡æ¯æ£€ç´¢ç³»ç»Ÿ</strong>ï¼šæœç´¢å¼•æ“ã€æ¨èç³»ç»Ÿç­‰éœ€è¦ç²¾ç¡®åŒ¹é…çš„åº”ç”¨</p>
                    <p><strong>çŸ¥è¯†é—®ç­”</strong>ï¼šéœ€è¦ä»å¤§é‡çŸ¥è¯†ä¸­ç²¾ç¡®æ£€ç´¢ç­”æ¡ˆçš„ä»»åŠ¡</p>
                    <p><strong>é«˜å¬å›ç‡ä»»åŠ¡</strong>ï¼šéœ€è¦ç²¾ç¡®æ£€ç´¢ä¸”å‡å°‘è¯¯æ£€çš„ä»»åŠ¡</p>
                </div>
            </div>
            <div class="section">
                <h2>ğŸ’» Python ä»£ç ç¤ºä¾‹</h2>
                <div class="code-box">
                    <h3>Yaad ä¼˜åŒ–æ³¨æ„åŠ›åå·®æ¨¡å—</h3>
                    <pre><code class="language-python">import torch
import torch.nn as nn
import torch.nn.functional as F

class YaadAttentionBias(nn.Module):
    """Yaad ä¼˜åŒ–çš„æ³¨æ„åŠ›åå·®æ¨¡å—"""
    def __init__(self, d_model, memory_size):
        super(YaadAttentionBias, self).__init__()
        self.d_model = d_model
        self.memory_size = memory_size
        
        # è®°å¿†å­˜å‚¨
        self.memory = nn.Parameter(torch.randn(memory_size, d_model))
        
        # å¯å­¦ä¹ çš„åå·®ç½‘ç»œ
        self.bias_network = nn.Sequential(
            nn.Linear(d_model, d_model // 2),
            nn.ReLU(),
            nn.Linear(d_model // 2, memory_size)
        )
        
        # æŸ¥è¯¢å’Œé”®å€¼æŠ•å½±
        self.query_proj = nn.Linear(d_model, d_model)
        self.key_proj = nn.Linear(d_model, d_model)
        self.value_proj = nn.Linear(d_model, d_model)
    
    def forward(self, query):
        """
        ä½¿ç”¨ä¼˜åŒ–çš„æ³¨æ„åŠ›åå·®è¿›è¡Œæ£€ç´¢
        å‚æ•°:
            query: [batch_size, d_model] æŸ¥è¯¢å‘é‡
        è¿”å›:
            output: [batch_size, d_model] æ£€ç´¢ç»“æœ
            attention: [batch_size, memory_size] æ³¨æ„åŠ›æƒé‡
        """
        batch_size = query.shape[0]
        
        # è®¡ç®—æŸ¥è¯¢ã€é”®ã€å€¼
        q = self.query_proj(query)
        k = self.key_proj(self.memory)
        v = self.value_proj(self.memory)
        
        # è®¡ç®—åŸºç¡€ç›¸ä¼¼åº¦
        scores = torch.matmul(q, k.t()) / (self.d_model ** 0.5)
        
        # å­¦ä¹ æœ€ä¼˜çš„æ³¨æ„åŠ›åå·®
        learned_bias = self.bias_network(query)  # [batch_size, memory_size]
        
        # åº”ç”¨ä¼˜åŒ–çš„åå·®
        scores = scores + learned_bias
        
        # è®¡ç®—æ³¨æ„åŠ›æƒé‡
        attention = F.softmax(scores, dim=-1)
        
        # åŠ æƒæ±‚å’Œ
        output = torch.matmul(attention, v)
        
        return output, attention

# ä½¿ç”¨ç¤ºä¾‹
if __name__ == "__main__":
    yaad = YaadAttentionBias(d_model=512, memory_size=1000)
    query = torch.randn(2, 512)
    
    output, attention = yaad(query)
    print(f"è¾“å‡ºå½¢çŠ¶: {output.shape}")  # [2, 512]
    print(f"æ³¨æ„åŠ›æƒé‡å½¢çŠ¶: {attention.shape}")  # [2, 1000]
    print(f"æ³¨æ„åŠ›æƒé‡å’Œ: {attention.sum(dim=-1)}")  # åº”è¯¥æ¥è¿‘1.0</code></pre>
                </div>
            </div>
        </div>
    </div>
    <!-- å…¬å…±è„šæœ¬ -->
    <script src="../common/tech-document.js"></script>
</body>
</html>

