<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ZeRO优化器</title>
    <script>
        window.MathJax = { tex: { inlineMath: [['$', '$'], ['\\(', '\\)']], displayMath: [['$$', '$$'], ['\\[', '\\]']] }, options: { skipHtmlTags: ['script','noscript','style','textarea','pre','code'] } };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    
    <!-- 公共样式 -->
    <link rel="stylesheet" href="../common/styles.css">
</head>
<body>
    <div class="container">
        <h1>ZeRO优化器（ZeRO Optimizer）</h1>
        <p class="tagline">优化器状态、梯度、参数分片，最大程度节省内存。</p>

        <div class="meta-grid">
            <div class="meta-card"><h3>ZeRO-1</h3><p>优化器状态分片，节省约4倍内存。</p></div>
            <div class="meta-card"><h3>ZeRO-2</h3><p>优化器状态+梯度分片，节省约8倍内存。</p></div>
            <div class="meta-card"><h3>ZeRO-3</h3><p>优化器状态+梯度+参数分片，最大内存节省。</p></div>
            <div class="meta-card"><h3>应用场景</h3><p>训练超大模型，突破内存限制。</p></div>
        </div>

        <div class="section">
            <h2>⚙️ ZeRO级别</h2>
            
            <h3 style="color:#fbbf24; margin-top:20px;">1. ZeRO-1：优化器状态分片</h3>
            <ul>
                <li><strong>分片内容</strong>：优化器状态（如Adam的momentum和variance）</li>
                <li><strong>内存节省</strong>：约4倍（对于Adam优化器）</li>
                <li><strong>通信开销</strong>：无额外通信</li>
            </ul>

            <h3 style="color:#fbbf24; margin-top:20px;">2. ZeRO-2：优化器状态+梯度分片</h3>
            <ul>
                <li><strong>分片内容</strong>：优化器状态 + 梯度</li>
                <li><strong>内存节省</strong>：约8倍</li>
                <li><strong>通信开销</strong>：梯度AllGather（可优化）</li>
            </ul>

            <h3 style="color:#fbbf24; margin-top:20px;">3. ZeRO-3：完整分片</h3>
            <ul>
                <li><strong>分片内容</strong>：优化器状态 + 梯度 + 模型参数</li>
                <li><strong>内存节省</strong>：最大，与设备数量成正比</li>
                <li><strong>通信开销</strong>：参数和梯度AllGather</li>
            </ul>
        </div>

        <div class="section">
            <h2>💻 代码示例</h2>
            <div class="code-box">
                <h3>DeepSpeed ZeRO配置</h3>
                <pre><code class="language-json">{
  "zero_optimization": {
    "stage": 3,
    "offload_optimizer": {
      "device": "cpu",
      "pin_memory": true
    },
    "offload_param": {
      "device": "cpu",
      "pin_memory": true
    }
  }
}</code></pre>
            </div>
        </div>

        <div class="section">
            <h2>📊 内存对比</h2>
            <ul>
                <li><strong>标准训练</strong>：模型参数 + 梯度 + 优化器状态 = 约16倍参数量内存</li>
                <li><strong>ZeRO-1</strong>：节省优化器状态，约12倍参数量内存</li>
                <li><strong>ZeRO-2</strong>：节省优化器状态+梯度，约8倍参数量内存</li>
                <li><strong>ZeRO-3</strong>：最大节省，约4倍参数量内存（8设备）</li>
            </ul>
        </div>
    </div>
    <!-- 公共脚本 -->
    <script src="../common/tech-document.js"></script>
</body>
</html>

