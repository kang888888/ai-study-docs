<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Memora - åŸºäºMirasæ¡†æ¶çš„é•¿æœŸè®°å¿†ç®¡ç†æ¨¡å‹</title>
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']],
                processEscapes: true,
                processEnvironments: true
            },
            options: {
                skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
            }
        };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    
    <!-- å…¬å…±æ ·å¼ -->
    <link rel="stylesheet" href="../common/styles.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Memora</h1>
            <p>åŸºäºMirasæ¡†æ¶çš„é•¿æœŸè®°å¿†ç®¡ç†æ¨¡å‹</p>
        </div>
        <div class="content">
            <div class="section">
                <h2>ğŸ“– æ ¸å¿ƒæ¦‚å¿µ</h2>
                <div class="desc-box">
                    <p><strong>Memora</strong> æ˜¯åŸºäº Miras æ¡†æ¶æå‡ºçš„é•¿æœŸè®°å¿†ç®¡ç†æ¨¡å‹ï¼Œä¸“æ³¨äºé«˜æ•ˆå­˜å‚¨å’Œæ£€ç´¢å†å²ä¿¡æ¯ã€‚Memora é€šè¿‡å±‚æ¬¡åŒ–çš„è®°å¿†æ¶æ„å’Œæ™ºèƒ½çš„è®°å¿†ç®¡ç†æœºåˆ¶ï¼Œèƒ½å¤Ÿå¤„ç†é•¿åºåˆ—å»ºæ¨¡ä»»åŠ¡ï¼Œæ”¯æŒé•¿æœŸä¾èµ–å…³ç³»çš„å­¦ä¹ ã€‚</p>
                </div>
            </div>
            <div class="section features">
                <h2>ğŸŒŸ æ ¸å¿ƒç‰¹ç‚¹</h2>
                <ul>
                    <li><strong>é•¿æœŸè®°å¿†ç®¡ç†</strong>ï¼šå±‚æ¬¡åŒ–çš„è®°å¿†æ¶æ„ï¼Œæ”¯æŒå¤§è§„æ¨¡å†å²ä¿¡æ¯å­˜å‚¨</li>
                    <li><strong>é«˜æ•ˆå­˜å‚¨å’Œæ£€ç´¢</strong>ï¼šå‹ç¼©è¡¨ç¤ºå’Œé€‰æ‹©æ€§æ£€ç´¢ï¼Œæé«˜å­˜å‚¨å’Œæ£€ç´¢æ•ˆç‡</li>
                    <li><strong>é•¿æœŸä¾èµ–å»ºæ¨¡</strong>ï¼šèƒ½å¤Ÿæ•è·é•¿è·ç¦»ä¾èµ–å…³ç³»ï¼Œæ”¯æŒé•¿åºåˆ—å»ºæ¨¡</li>
                    <li><strong>è®°å¿†å®¹é‡å¤§</strong>ï¼šæ”¯æŒå¤§è§„æ¨¡è®°å¿†å­˜å‚¨ï¼Œé€‚åº”é•¿åºåˆ—ä»»åŠ¡éœ€æ±‚</li>
                </ul>
            </div>
            <div class="section">
                <h2>âš™ï¸ æŠ€æœ¯æ¶æ„</h2>
                <div class="tech-box">
                    <p><strong>å±‚æ¬¡è®°å¿†æ¶æ„</strong>ï¼šé‡‡ç”¨å±‚æ¬¡åŒ–çš„è®°å¿†ç»„ç»‡æ–¹å¼ï¼Œæ”¯æŒå¤šå°ºåº¦è®°å¿†ç®¡ç†</p>
                </div>
                <div class="tech-box">
                    <p><strong>å‹ç¼©è¡¨ç¤º</strong>ï¼šé«˜æ•ˆå­˜å‚¨å¤§é‡å†å²æ•°æ®ï¼Œé€šè¿‡å‹ç¼©å‡å°‘å­˜å‚¨å¼€é”€</p>
                </div>
                <div class="tech-box">
                    <p><strong>é€‰æ‹©æ€§æ£€ç´¢</strong>ï¼šæ ¹æ®å½“å‰ä»»åŠ¡æ£€ç´¢ç›¸å…³ä¿¡æ¯ï¼Œæé«˜æ£€ç´¢æ•ˆç‡</p>
                </div>
                <div class="tech-box">
                    <p><strong>è®°å¿†æ›´æ–°æœºåˆ¶</strong>ï¼šå¢é‡å­¦ä¹ ç®—æ³•ï¼Œæ”¯æŒåŠ¨æ€æ›´æ–°é•¿æœŸè®°å¿†</p>
                </div>
            </div>
            <div class="section">
                <h2>ğŸš€ åº”ç”¨åœºæ™¯</h2>
                <div class="app-box">
                    <p><strong>é•¿åºåˆ—å»ºæ¨¡ä»»åŠ¡</strong>ï¼šéœ€è¦å¤„ç†è¶…é•¿åºåˆ—çš„ä»»åŠ¡ï¼Œå¦‚é•¿æ–‡æœ¬ç†è§£ã€ä»£ç åˆ†æ</p>
                    <p><strong>å¤šè½®å¯¹è¯ç³»ç»Ÿ</strong>ï¼šéœ€è¦é•¿æœŸè®°å¿†å†å²å¯¹è¯çš„æ™ºèƒ½åŠ©æ‰‹ã€å®¢æœç³»ç»Ÿ</p>
                    <p><strong>å†å²ä¿¡æ¯æ£€ç´¢</strong>ï¼šéœ€è¦ä»å¤§é‡å†å²ä¿¡æ¯ä¸­æ£€ç´¢ç›¸å…³å†…å®¹çš„åœºæ™¯</p>
                    <p><strong>æ—¶é—´åºåˆ—é¢„æµ‹</strong>ï¼šéœ€è¦åˆ©ç”¨é•¿æœŸå†å²æ¨¡å¼è¿›è¡Œé¢„æµ‹çš„ä»»åŠ¡</p>
                </div>
            </div>
            <div class="section">
                <h2>ğŸ’» Python ä»£ç ç¤ºä¾‹</h2>
                <div class="code-box">
                    <h3>Memora é•¿æœŸè®°å¿†ç®¡ç†æ¨¡å—</h3>
                    <pre><code class="language-python">import torch
import torch.nn as nn
import torch.nn.functional as F

class MemoraLongTermMemory(nn.Module):
    """Memora é•¿æœŸè®°å¿†ç®¡ç†æ¨¡å—"""
    def __init__(self, d_model, memory_size, num_levels=3):
        super(MemoraLongTermMemory, self).__init__()
        self.d_model = d_model
        self.memory_size = memory_size
        self.num_levels = num_levels
        
        # å±‚æ¬¡è®°å¿†ï¼šä¸åŒå±‚æ¬¡å­˜å‚¨ä¸åŒæ—¶é—´å°ºåº¦çš„ä¿¡æ¯
        self.memory_levels = nn.ModuleList([
            nn.Parameter(torch.randn(memory_size // (2 ** i), d_model))
            for i in range(num_levels)
        ])
        
        # è®°å¿†ç¼–ç å™¨ï¼ˆå‹ç¼©è¡¨ç¤ºï¼‰
        self.encoder = nn.Sequential(
            nn.Linear(d_model, d_model // 2),
            nn.ReLU(),
            nn.Linear(d_model // 2, d_model)
        )
        
        # è®°å¿†æ£€ç´¢å™¨
        self.query_proj = nn.Linear(d_model, d_model)
        self.key_proj = nn.Linear(d_model, d_model)
        self.value_proj = nn.Linear(d_model, d_model)
        
        # è®°å¿†æ›´æ–°å™¨ï¼ˆé€‰æ‹©æ€§æ›´æ–°ï¼‰
        self.update_gate = nn.Linear(d_model * 2, d_model)
        self.importance_score = nn.Linear(d_model, 1)
    
    def encode(self, x):
        """å‹ç¼©ç¼–ç è¾“å…¥"""
        return self.encoder(x)
    
    def retrieve(self, query):
        """ä»å±‚æ¬¡è®°å¿†ä¸­æ£€ç´¢ç›¸å…³ä¿¡æ¯"""
        batch_size = query.shape[0]
        q = self.query_proj(query)
        
        all_retrieved = []
        all_attention = []
        
        # ä»æ¯ä¸ªå±‚æ¬¡æ£€ç´¢
        for level_memory in self.memory_levels:
            k = self.key_proj(level_memory)
            v = self.value_proj(level_memory)
            
            scores = torch.matmul(q, k.t()) / (self.d_model ** 0.5)
            attention = F.softmax(scores, dim=-1)
            retrieved = torch.matmul(attention, v)
            
            all_retrieved.append(retrieved)
            all_attention.append(attention)
        
        # èåˆä¸åŒå±‚æ¬¡çš„æ£€ç´¢ç»“æœ
        combined = torch.stack(all_retrieved, dim=1)  # [batch_size, num_levels, d_model]
        # ç®€å•çš„å¹³å‡èåˆï¼ˆå¯ä»¥æ”¹ä¸ºåŠ æƒèåˆï¼‰
        final_retrieved = combined.mean(dim=1)  # [batch_size, d_model]
        
        return final_retrieved, all_attention
    
    def update(self, new_info, retrieved_memory):
        """é€‰æ‹©æ€§æ›´æ–°é•¿æœŸè®°å¿†"""
        # è®¡ç®—é‡è¦æ€§åˆ†æ•°
        importance = torch.sigmoid(self.importance_score(new_info))  # [batch_size, 1]
        
        # é—¨æ§æ›´æ–°
        combined = torch.cat([new_info, retrieved_memory], dim=-1)
        gate = torch.sigmoid(self.update_gate(combined))
        updated = gate * new_info + (1 - gate) * retrieved_memory
        
        # æ ¹æ®é‡è¦æ€§é€‰æ‹©æ€§åœ°æ›´æ–°è®°å¿†
        # è¿™é‡Œç®€åŒ–å¤„ç†ï¼Œå®é™…åº”è¯¥æ›´æ–°æœ€ç›¸å…³çš„è®°å¿†ä½ç½®
        return updated, importance

# ä½¿ç”¨ç¤ºä¾‹
if __name__ == "__main__":
    memora = MemoraLongTermMemory(d_model=512, memory_size=1000, num_levels=3)
    query = torch.randn(2, 512)
    new_info = torch.randn(2, 512)
    
    # æ£€ç´¢é•¿æœŸè®°å¿†
    retrieved, attention = memora.retrieve(query)
    print(f"æ£€ç´¢ç»“æœå½¢çŠ¶: {retrieved.shape}")  # [2, 512]
    
    # æ›´æ–°è®°å¿†
    updated, importance = memora.update(new_info, retrieved)
    print(f"æ›´æ–°åå½¢çŠ¶: {updated.shape}")  # [2, 512]
    print(f"é‡è¦æ€§åˆ†æ•°: {importance.squeeze()}")</code></pre>
                </div>
            </div>
        </div>
    </div>
    <!-- å…¬å…±è„šæœ¬ -->
    <script src="../common/tech-document.js"></script>
</body>
</html>

