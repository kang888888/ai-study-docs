<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mamba (State Space Models) çŠ¶æ€ç©ºé—´æ¨¡å‹ - æ¶æ„è¯¦è§£</title>
    <!-- MathJax for mathematical formulas -->
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']],
                processEscapes: true,
                processEnvironments: true
            },
            options: {
                skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
            }
        };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <!-- Prism.js for code highlighting -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    
    <!-- å…¬å…±æ ·å¼ -->
    <link rel="stylesheet" href="../common/styles.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Mamba (State Space Models) çŠ¶æ€ç©ºé—´æ¨¡å‹</h1>
            <p>çº¿æ€§å¤æ‚åº¦çš„é•¿åºåˆ—å»ºæ¨¡æ¶æ„</p>
        </div>
        <div class="content">
            
            <div class="section">
                <h2>ğŸ“– æ ¸å¿ƒæ¦‚å¿µ</h2>
                <div class="desc-box">
                    <p>åŸºäºç»“æ„åŒ–çŠ¶æ€ç©ºé—´æ¨¡å‹ï¼ˆSSMï¼‰çš„æ–°å‹æ¶æ„ï¼Œæ—¨åœ¨è§£å†³Transformeråœ¨é•¿åºåˆ—ä¸Šçš„O(LÂ²)å¤æ‚åº¦å’ŒKV Cacheæ˜¾å­˜å ç”¨é—®é¢˜ã€‚é€šè¿‡é€‰æ‹©æ€§æ‰«ææœºåˆ¶å®ç°çº¿æ€§å¤æ‚åº¦ã€‚</p>
                </div>
            </div>
            <div class="section features">
                <h2>ğŸŒŸ æ ¸å¿ƒç‰¹ç‚¹</h2>
                <ul>
                    <li>çº¿æ€§å¤æ‚åº¦ï¼šæ—¶é—´å’Œç©ºé—´å¤æ‚åº¦å‡ä¸ºO(L)ï¼Œè¿œä¼˜äºTransformerçš„O(LÂ²)</li>
                    <li>æ— KV Cacheï¼šæ¨ç†æ—¶æ˜¾å­˜å ç”¨æ’å®šï¼Œä¸éšåºåˆ—é•¿åº¦å¢é•¿</li>
                    <li>é€‰æ‹©æ€§æœºåˆ¶ï¼šå‚æ•°æ ¹æ®è¾“å…¥åŠ¨æ€å˜åŒ–ï¼Œç±»ä¼¼Attentionçš„å†…å®¹é€‰æ‹©èƒ½åŠ›</li>
                    <li>å¹¶è¡Œè®­ç»ƒï¼šé€šè¿‡å¹¶è¡Œæ‰«æç®—æ³•æ”¯æŒé«˜æ•ˆå¹¶è¡Œè®­ç»ƒ</li>
                    <li>RNNæ¨ç†ï¼šæ¨ç†æ—¶å¯ä»¥é€’å½’è®¡ç®—ï¼Œé€Ÿåº¦æå¿«</li>
                </ul>
            </div>
            <div class="section">
                <h2>âš™ï¸ å…³é”®æŠ€æœ¯</h2>
                <div class="tech-box"><p><strong>é€‰æ‹©æ€§çŠ¶æ€ç©ºé—´æ¨¡å‹ï¼ˆSelective SSMï¼‰ã€å¹¶è¡Œæ‰«æç®—æ³•ã€ç¡¬ä»¶æ„ŸçŸ¥ä¼˜åŒ–</strong></p></div>
            </div>
            <div class="section">
                <h2>ğŸš€ åº”ç”¨åœºæ™¯</h2>
                <div class="app-box"><p>é•¿æ–‡æœ¬ç”Ÿæˆã€åŸºå› ç»„åºåˆ—åˆ†æã€æ—¶é—´åºåˆ—å»ºæ¨¡ã€ä»£ç ç”Ÿæˆï¼ˆCodestral Mambaï¼‰</p></div>
            </div>
            <div class="section">
                <h2>ğŸ“Š æ¶æ„å›¾è§£</h2>
                <div class="diagram-gallery">
                    <div class="diagram-item"><img src="Mamba_vs_Transformer.png" alt="Mamba vs Transformer" onclick="openImageModal(this)" onerror="this.parentElement.style.display='none'"><div class="caption">Mamba vs Transformer</div></div>
                </div>
            </div>

            <div class="section">
                <h2>ğŸ“ æ•°å­¦åŸç†</h2>
                <div class="math-box">
                    <h3>çŠ¶æ€ç©ºé—´æ¨¡å‹ï¼ˆSSMï¼‰</h3>
                    <div class="math-formula">
                        <p>è¿ç»­æ—¶é—´SSMï¼š</p>
                        <p>$$h'(t) = Ah(t) + Bx(t)$$</p>
                        <p>$$y(t) = Ch(t)$$</p>
                        <p>ç¦»æ•£åŒ–åï¼š</p>
                        <p>$$h_k = \bar{A}h_{k-1} + \bar{B}x_k$$</p>
                        <p>$$y_k = Ch_k$$</p>
                        <p>å…¶ä¸­ $\bar{A} = e^{\Delta A}$ï¼Œ$\bar{B} = (\Delta A)^{-1}(e^{\Delta A} - I)\Delta B$</p>
                    </div>
                </div>
                <div class="math-box">
                    <h3>é€‰æ‹©æ€§æœºåˆ¶</h3>
                    <div class="math-formula">
                        <p>Mambaçš„å…³é”®åˆ›æ–°æ˜¯è®©å‚æ•°ä¾èµ–äºè¾“å…¥ï¼š</p>
                        <p>$$B_k = s_B(x_k), \quad C_k = s_C(x_k), \quad \Delta_k = \tau_\Delta(x_k)$$</p>
                        <p>è¿™ä½¿å¾—æ¨¡å‹èƒ½å¤Ÿæ ¹æ®è¾“å…¥å†…å®¹åŠ¨æ€è°ƒæ•´çŠ¶æ€è½¬ç§»ï¼Œå®ç°ç±»ä¼¼Attentionçš„é€‰æ‹©èƒ½åŠ›</p>
                    </div>
                </div>
            </div>

            <div class="section">
                <h2>ğŸ’» Python ä»£ç ç¤ºä¾‹</h2>
                <div class="code-box">
                    <h3>ä½¿ç”¨ mamba-ssm åº“å®ç° Mamba</h3>
                    <pre><code class="language-python">import torch
from mamba_ssm import Mamba

# åˆ›å»º Mamba æ¨¡å‹
model = Mamba(
    d_model=512,        # æ¨¡å‹ç»´åº¦
    d_state=16,         # çŠ¶æ€ç»´åº¦
    d_conv=4,           # å·ç§¯æ ¸å¤§å°
    expand=2,           # æ‰©å±•å› å­
)

# è¾“å…¥ (batch_size, seq_length, d_model)
x = torch.randn(2, 1024, 512)

# å‰å‘ä¼ æ’­
output = model(x)
print(f"è¾“å‡ºå½¢çŠ¶: {output.shape}")  # [2, 1024, 512]

# ä¸ Transformer å¯¹æ¯”
# Transformer: O(LÂ²) å¤æ‚åº¦ï¼Œéœ€è¦ KV Cache
# Mamba: O(L) å¤æ‚åº¦ï¼Œæ— éœ€ KV Cache</code></pre>
                </div>
                <div class="code-box">
                    <h3>æ‰‹åŠ¨å®ç°ç®€åŒ–ç‰ˆ SSM</h3>
                    <pre><code class="language-python">import torch
import torch.nn as nn

class SimpleSSM(nn.Module):
    """ç®€åŒ–çš„çŠ¶æ€ç©ºé—´æ¨¡å‹"""
    def __init__(self, d_model, d_state):
        super(SimpleSSM, self).__init__()
        self.d_model = d_model
        self.d_state = d_state
        
        # çŠ¶æ€è½¬ç§»çŸ©é˜µ
        self.A = nn.Parameter(torch.randn(d_state, d_state))
        # è¾“å…¥çŸ©é˜µ
        self.B = nn.Linear(d_model, d_state)
        # è¾“å‡ºçŸ©é˜µ
        self.C = nn.Linear(d_state, d_model)
    
    def forward(self, x):
        """
        å‚æ•°:
            x: [batch_size, seq_length, d_model]
        è¿”å›:
            output: [batch_size, seq_length, d_model]
        """
        batch_size, seq_length, _ = x.shape
        h = torch.zeros(batch_size, self.d_state, device=x.device)
        outputs = []
        
        # é€’å½’è®¡ç®—ï¼ˆç±»ä¼¼RNNï¼‰
        for t in range(seq_length):
            # çŠ¶æ€æ›´æ–°
            h = torch.matmul(h, self.A) + self.B(x[:, t, :])
            # è¾“å‡º
            y_t = self.C(h)
            outputs.append(y_t)
        
        output = torch.stack(outputs, dim=1)
        return output

# ä½¿ç”¨ç¤ºä¾‹
if __name__ == "__main__":
    model = SimpleSSM(d_model=512, d_state=16)
    x = torch.randn(2, 100, 512)
    output = model(x)
    print(f"è¾“å‡ºå½¢çŠ¶: {output.shape}")  # [2, 100, 512]</code></pre>
                </div>
            </div>
        </div>
    </div>
    <!-- å›¾ç‰‡æ”¾å¤§å¼¹çª— -->
    <div id="imageModal" class="image-modal" onclick="closeImageModal()">
        <span class="image-modal-close" onclick="event.stopPropagation(); closeImageModal()">&times;</span>
        <img id="modalImage" class="image-modal-content" src="" alt="">
        <div id="modalCaption" class="image-modal-caption"></div>
    </div>
    <script>
        function openImageModal(img) {
            const modal = document.getElementById('imageModal');
            const modalImg = document.getElementById('modalImage');
            const modalCaption = document.getElementById('modalCaption');
            modal.classList.add('active');
            modalImg.src = img.src;
            modalCaption.textContent = img.alt || '';
            modalImg.onclick = function(e) { e.stopPropagation(); };
        }
        function closeImageModal() {
            document.getElementById('imageModal').classList.remove('active');
        }
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') closeImageModal();
        });
    </script>
    <!-- å…¬å…±è„šæœ¬ -->
    <script src="../common/tech-document.js"></script>
</body>
</html>

