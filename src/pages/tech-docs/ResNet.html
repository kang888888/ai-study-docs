<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ResNet (Residual Network) æ®‹å·®ç½‘ç»œ - æ¶æ„è¯¦è§£</title>
    <!-- MathJax for mathematical formulas -->
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']],
                processEscapes: true,
                processEnvironments: true
            },
            options: {
                skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
            }
        };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <!-- Prism.js for code highlighting -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    
    <!-- å…¬å…±æ ·å¼ -->
    <link rel="stylesheet" href="../common/styles.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ResNet (Residual Network) æ®‹å·®ç½‘ç»œ</h1>
            <p>è§£å†³æ¢¯åº¦æ¶ˆå¤±é—®é¢˜çš„æ·±åº¦ç½‘ç»œæ¶æ„</p>
        </div>
        <div class="content">
            
            <div class="section">
                <h2>ğŸ“– æ ¸å¿ƒæ¦‚å¿µ</h2>
                <div class="desc-box">
                    <p>é€šè¿‡å¼•å…¥æ®‹å·®è¿æ¥ï¼ˆSkip Connection / Shortcutï¼‰ï¼Œå…è®¸æ¢¯åº¦ç›´æ¥æµå‘æµ…å±‚ï¼Œè§£å†³äº†æ·±å±‚ç½‘ç»œï¼ˆ100+å±‚ï¼‰éš¾ä»¥è®­ç»ƒçš„æ¢¯åº¦æ¶ˆå¤±/çˆ†ç‚¸é—®é¢˜ã€‚</p>
                </div>
            </div>
            <div class="section features">
                <h2>ğŸŒŸ æ ¸å¿ƒç‰¹ç‚¹</h2>
                <ul>
                    <li>æ®‹å·®å­¦ä¹ ï¼šå­¦ä¹  F(x) = H(x) - xï¼Œè€Œéç›´æ¥å­¦ä¹  H(x)</li>
                    <li>æ’ç­‰æ˜ å°„ï¼šé€šè¿‡è·³è·ƒè¿æ¥å®ç°æ¢¯åº¦çš„æ— æŸä¼ æ’­</li>
                    <li>ææ·±ç½‘ç»œï¼šå¯ä»¥è®­ç»ƒ152å±‚ç”šè‡³æ›´æ·±çš„ç½‘ç»œ</li>
                    <li>ç“¶é¢ˆç»“æ„ï¼šä½¿ç”¨1Ã—1å·ç§¯é™ç»´ï¼Œå‡å°‘è®¡ç®—é‡</li>
                    <li>å¹¿æ³›åº”ç”¨ï¼šæˆä¸ºç°ä»£è§†è§‰æ¨¡å‹çš„æ ‡å‡†Backbone</li>
                </ul>
            </div>
            <div class="section">
                <h2>âš™ï¸ å…³é”®æŠ€æœ¯</h2>
                <div class="tech-box"><p><strong>æ®‹å·®å—ï¼ˆResidual Blockï¼‰ã€æ‰¹é‡å½’ä¸€åŒ–ã€æ’ç­‰æ˜ å°„ã€ç“¶é¢ˆè®¾è®¡</strong></p></div>
            </div>
            <div class="section">
                <h2>ğŸš€ åº”ç”¨åœºæ™¯</h2>
                <div class="app-box"><p>å›¾åƒåˆ†ç±»ã€ç›®æ ‡æ£€æµ‹çš„Backboneã€ç‰¹å¾æå–ã€è¿ç§»å­¦ä¹ </p></div>
            </div>
            <div class="section">
                <h2>ğŸ“Š æ¶æ„å›¾è§£</h2>
                <div class="diagram-gallery">
                    <div class="diagram-item"><img src="ResNetæ®‹å·®å—.png" alt="ResNetæ®‹å·®å—" onclick="openImageModal(this)" onerror="this.parentElement.style.display='none'"><div class="caption">ResNetæ®‹å·®å—</div></div>
                    <div class="diagram-item"><img src="ResNetæ¶æ„å›¾.png" alt="ResNetæ¶æ„å›¾" onclick="openImageModal(this)" onerror="this.parentElement.style.display='none'"><div class="caption">ResNetæ¶æ„å›¾</div></div>
                    <div class="diagram-item"><img src="ResNetæ¢¯åº¦æµåŠ¨.png" alt="ResNetæ¢¯åº¦æµåŠ¨" onclick="openImageModal(this)" onerror="this.parentElement.style.display='none'"><div class="caption">ResNetæ¢¯åº¦æµåŠ¨</div></div>
                </div>
            </div>

            <div class="section">
                <h2>ğŸ“ æ•°å­¦åŸç†</h2>
                <div class="math-box">
                    <h3>æ®‹å·®å­¦ä¹ </h3>
                    <div class="math-formula">
                        <p>ResNetçš„æ ¸å¿ƒæ€æƒ³æ˜¯å­¦ä¹ æ®‹å·®è€Œéç›´æ¥æ˜ å°„ï¼š</p>
                        <p>$$H(x) = F(x) + x$$</p>
                        <p>å…¶ä¸­ï¼š</p>
                        <ul style="list-style: none; padding-left: 20px;">
                            <li>$H(x)$ æ˜¯æœŸæœ›çš„æ˜ å°„</li>
                            <li>$F(x) = H(x) - x$ æ˜¯æ®‹å·®å‡½æ•°</li>
                            <li>$x$ æ˜¯æ’ç­‰æ˜ å°„ï¼ˆè·³è·ƒè¿æ¥ï¼‰</li>
                        </ul>
                        <p>å¦‚æœæœ€ä¼˜æ˜ å°„æ¥è¿‘æ’ç­‰æ˜ å°„ï¼Œå­¦ä¹ æ®‹å·® $F(x) \approx 0$ æ¯”å­¦ä¹  $H(x) \approx x$ æ›´å®¹æ˜“</p>
                    </div>
                </div>
                <div class="math-box">
                    <h3>æ¢¯åº¦æµåŠ¨</h3>
                    <div class="math-formula">
                        <p>æ®‹å·®è¿æ¥ä½¿å¾—æ¢¯åº¦å¯ä»¥ç›´æ¥ä¼ æ’­ï¼š</p>
                        <p>$$\frac{\partial L}{\partial x} = \frac{\partial L}{\partial H(x)} \cdot \left(1 + \frac{\partial F(x)}{\partial x}\right)$$</p>
                        <p>å³ä½¿ $\frac{\partial F(x)}{\partial x} \approx 0$ï¼Œæ¢¯åº¦ä»å¯ä»¥é€šè¿‡æ’ç­‰é¡¹ $1$ ä¼ æ’­ï¼Œé¿å…äº†æ¢¯åº¦æ¶ˆå¤±</p>
                    </div>
                </div>
            </div>

            <div class="section">
                <h2>ğŸ’» Python ä»£ç ç¤ºä¾‹</h2>
                <div class="code-box">
                    <h3>ä½¿ç”¨ PyTorch å®ç° ResNet æ®‹å·®å—</h3>
                    <pre><code class="language-python">import torch
import torch.nn as nn
import torch.nn.functional as F

class ResidualBlock(nn.Module):
    """ResNet æ®‹å·®å—"""
    def __init__(self, in_channels, out_channels, stride=1, downsample=None):
        super(ResidualBlock, self).__init__()
        self.conv1 = nn.Conv2d(in_channels, out_channels, kernel_size=3, 
                              stride=stride, padding=1, bias=False)
        self.bn1 = nn.BatchNorm2d(out_channels)
        self.conv2 = nn.Conv2d(out_channels, out_channels, kernel_size=3,
                              stride=1, padding=1, bias=False)
        self.bn2 = nn.BatchNorm2d(out_channels)
        self.downsample = downsample
    
    def forward(self, x):
        identity = x
        
        out = self.conv1(x)
        out = self.bn1(out)
        out = F.relu(out)
        
        out = self.conv2(out)
        out = self.bn2(out)
        
        if self.downsample is not None:
            identity = self.downsample(x)
        
        out += identity  # æ®‹å·®è¿æ¥
        out = F.relu(out)
        
        return out

class BottleneckBlock(nn.Module):
    """ResNet ç“¶é¢ˆå—ï¼ˆç”¨äºæ›´æ·±çš„ç½‘ç»œï¼‰"""
    def __init__(self, in_channels, out_channels, stride=1, downsample=None):
        super(BottleneckBlock, self).__init__()
        expansion = 4
        self.conv1 = nn.Conv2d(in_channels, out_channels, kernel_size=1, bias=False)
        self.bn1 = nn.BatchNorm2d(out_channels)
        self.conv2 = nn.Conv2d(out_channels, out_channels, kernel_size=3,
                              stride=stride, padding=1, bias=False)
        self.bn2 = nn.BatchNorm2d(out_channels)
        self.conv3 = nn.Conv2d(out_channels, out_channels * expansion,
                              kernel_size=1, bias=False)
        self.bn3 = nn.BatchNorm2d(out_channels * expansion)
        self.downsample = downsample
    
    def forward(self, x):
        identity = x
        
        out = self.conv1(x)
        out = self.bn1(out)
        out = F.relu(out)
        
        out = self.conv2(out)
        out = self.bn2(out)
        out = F.relu(out)
        
        out = self.conv3(out)
        out = self.bn3(out)
        
        if self.downsample is not None:
            identity = self.downsample(x)
        
        out += identity
        out = F.relu(out)
        
        return out

class ResNet(nn.Module):
    """ç®€å•çš„ ResNet å®ç°"""
    def __init__(self, block, layers, num_classes=1000):
        super(ResNet, self).__init__()
        self.in_channels = 64
        
        self.conv1 = nn.Conv2d(3, 64, kernel_size=7, stride=2, padding=3, bias=False)
        self.bn1 = nn.BatchNorm2d(64)
        self.maxpool = nn.MaxPool2d(kernel_size=3, stride=2, padding=1)
        
        self.layer1 = self._make_layer(block, 64, layers[0])
        self.layer2 = self._make_layer(block, 128, layers[1], stride=2)
        self.layer3 = self._make_layer(block, 256, layers[2], stride=2)
        self.layer4 = self._make_layer(block, 512, layers[3], stride=2)
        
        self.avgpool = nn.AdaptiveAvgPool2d((1, 1))
        self.fc = nn.Linear(512, num_classes)
    
    def _make_layer(self, block, out_channels, blocks, stride=1):
        downsample = None
        if stride != 1 or self.in_channels != out_channels:
            downsample = nn.Sequential(
                nn.Conv2d(self.in_channels, out_channels, kernel_size=1,
                         stride=stride, bias=False),
                nn.BatchNorm2d(out_channels)
            )
        
        layers = []
        layers.append(block(self.in_channels, out_channels, stride, downsample))
        self.in_channels = out_channels
        
        for _ in range(1, blocks):
            layers.append(block(self.in_channels, out_channels))
        
        return nn.Sequential(*layers)
    
    def forward(self, x):
        x = self.conv1(x)
        x = self.bn1(x)
        x = F.relu(x)
        x = self.maxpool(x)
        
        x = self.layer1(x)
        x = self.layer2(x)
        x = self.layer3(x)
        x = self.layer4(x)
        
        x = self.avgpool(x)
        x = torch.flatten(x, 1)
        x = self.fc(x)
        
        return x

# ä½¿ç”¨ç¤ºä¾‹
if __name__ == "__main__":
    # ResNet-18: [2, 2, 2, 2] è¡¨ç¤ºæ¯ä¸ªlayeræœ‰2ä¸ªæ®‹å·®å—
    model = ResNet(ResidualBlock, [2, 2, 2, 2], num_classes=1000)
    
    # æ¨¡æ‹Ÿè¾“å…¥
    x = torch.randn(4, 3, 224, 224)
    output = model(x)
    print(f"è¾“å‡ºå½¢çŠ¶: {output.shape}")  # [4, 1000]</code></pre>
                </div>
            </div>
        </div>
    </div>
    <!-- å›¾ç‰‡æ”¾å¤§å¼¹çª— -->
    <div id="imageModal" class="image-modal" onclick="closeImageModal()">
        <span class="image-modal-close" onclick="event.stopPropagation(); closeImageModal()">&times;</span>
        <img id="modalImage" class="image-modal-content" src="" alt="">
        <div id="modalCaption" class="image-modal-caption"></div>
    </div>
    <script>
        function openImageModal(img) {
            const modal = document.getElementById('imageModal');
            const modalImg = document.getElementById('modalImage');
            const modalCaption = document.getElementById('modalCaption');
            modal.classList.add('active');
            modalImg.src = img.src;
            modalCaption.textContent = img.alt || '';
            modalImg.onclick = function(e) { e.stopPropagation(); };
        }
        function closeImageModal() {
            document.getElementById('imageModal').classList.remove('active');
        }
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') closeImageModal();
        });
    </script>
    <!-- å…¬å…±è„šæœ¬ -->
    <script src="../common/tech-document.js"></script>
</body>
</html>

