<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Moneta - åŸºäºMirasæ¡†æ¶çš„é«˜æ•ˆå…³è”è®°å¿†æ¶æ„</title>
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']],
                processEscapes: true,
                processEnvironments: true
            },
            options: {
                skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
            }
        };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    
    <!-- å…¬å…±æ ·å¼ -->
    <link rel="stylesheet" href="../common/styles.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Moneta</h1>
            <p>åŸºäºMirasæ¡†æ¶çš„é«˜æ•ˆå…³è”è®°å¿†æ¶æ„</p>
        </div>
        <div class="content">
            <div class="section">
                <h2>ğŸ“– æ ¸å¿ƒæ¦‚å¿µ</h2>
                <div class="desc-box">
                    <p><strong>Moneta</strong> æ˜¯åŸºäº Miras æ¡†æ¶æå‡ºçš„é«˜æ•ˆå…³è”è®°å¿†æ¶æ„ï¼Œä¸“æ³¨äºå¿«é€Ÿæ£€ç´¢å’Œæ›´æ–°ï¼Œé€‚ç”¨äºå®æ—¶æ¨ç†ä»»åŠ¡ã€‚Moneta é€šè¿‡ä¼˜åŒ–çš„è®°å¿†ç»„ç»‡æ–¹å¼å’Œæ£€ç´¢æœºåˆ¶ï¼Œå®ç°äº†ä½è®¡ç®—å¼€é”€å’Œé«˜å“åº”é€Ÿåº¦ã€‚</p>
                </div>
            </div>
            <div class="section features">
                <h2>ğŸŒŸ æ ¸å¿ƒç‰¹ç‚¹</h2>
                <ul>
                    <li><strong>å¿«é€Ÿæ£€ç´¢å’Œæ›´æ–°</strong>ï¼šä¼˜åŒ–çš„è®°å¿†è®¿é—®æ¨¡å¼ï¼Œå®ç°æ¯«ç§’çº§å“åº”</li>
                    <li><strong>ä½è®¡ç®—å¼€é”€</strong>ï¼šé«˜æ•ˆçš„å…³è”è®°å¿†æ¶æ„ï¼Œå‡å°‘è®¡ç®—å¤æ‚åº¦</li>
                    <li><strong>å®æ—¶å“åº”</strong>ï¼šä¸“ä¸ºå®æ—¶æ¨ç†ä»»åŠ¡è®¾è®¡ï¼Œæ”¯æŒåœ¨çº¿å­¦ä¹ </li>
                    <li><strong>é«˜æ•ˆè®°å¿†ç®¡ç†</strong>ï¼šæ™ºèƒ½çš„è®°å¿†ç»„ç»‡æ–¹å¼ï¼Œæé«˜æ£€ç´¢æ•ˆç‡</li>
                </ul>
            </div>
            <div class="section">
                <h2>âš™ï¸ æŠ€æœ¯æ¶æ„</h2>
                <div class="tech-box">
                    <p><strong>å…³è”è®°å¿†æ¶æ„</strong>ï¼šé‡‡ç”¨æ‰å¹³è®°å¿†ç»“æ„ï¼Œæ‰€æœ‰è®°å¿†å¹³ç­‰ï¼Œæ”¯æŒå¿«é€Ÿå…¨å±€æ£€ç´¢</p>
                </div>
                <div class="tech-box">
                    <p><strong>æ³¨æ„åŠ›åå·®</strong>ï¼šä¼˜åŒ–çš„æ³¨æ„åŠ›åå·®ç›®æ ‡ï¼Œæœ€å¤§åŒ–ç›¸å…³æ€§ï¼Œæœ€å°åŒ–å†—ä½™</p>
                </div>
                <div class="tech-box">
                    <p><strong>è®°å¿†æ›´æ–°æœºåˆ¶</strong>ï¼šåœ¨çº¿å­¦ä¹ ç®—æ³•ï¼Œå®æ—¶æ›´æ–°è®°å¿†ï¼Œæ”¯æŒå¢é‡å¼å­¦ä¹ </p>
                </div>
            </div>
            <div class="section">
                <h2>ğŸš€ åº”ç”¨åœºæ™¯</h2>
                <div class="app-box">
                    <p><strong>å®æ—¶æ¨ç†ä»»åŠ¡</strong>ï¼šéœ€è¦å¿«é€Ÿå“åº”çš„åœ¨çº¿æ¨ç†åœºæ™¯</p>
                    <p><strong>åœ¨çº¿å­¦ä¹ ä»»åŠ¡</strong>ï¼šéœ€è¦å®æ—¶æ›´æ–°æ¨¡å‹çš„åŠ¨æ€å­¦ä¹ åœºæ™¯</p>
                    <p><strong>ä½å»¶è¿Ÿåº”ç”¨</strong>ï¼šå¯¹å“åº”æ—¶é—´è¦æ±‚æé«˜çš„åº”ç”¨åœºæ™¯</p>
                </div>
            </div>
            <div class="section">
                <h2>ğŸ’» Python ä»£ç ç¤ºä¾‹</h2>
                <div class="code-box">
                    <h3>Moneta å…³è”è®°å¿†æ¨¡å—</h3>
                    <pre><code class="language-python">import torch
import torch.nn as nn
import torch.nn.functional as F

class MonetaMemory(nn.Module):
    """Moneta é«˜æ•ˆå…³è”è®°å¿†æ¨¡å—"""
    def __init__(self, d_model, memory_size):
        super(MonetaMemory, self).__init__()
        self.d_model = d_model
        self.memory_size = memory_size
        
        # æ‰å¹³è®°å¿†ç»“æ„
        self.memory = nn.Parameter(torch.randn(memory_size, d_model))
        
        # å¿«é€Ÿæ£€ç´¢æŠ•å½±
        self.query_proj = nn.Linear(d_model, d_model)
        self.key_proj = nn.Linear(d_model, d_model)
        self.value_proj = nn.Linear(d_model, d_model)
        
        # åœ¨çº¿æ›´æ–°é—¨æ§
        self.update_gate = nn.Linear(d_model, d_model)
    
    def forward(self, query, new_info=None):
        """
        å¿«é€Ÿæ£€ç´¢å’Œæ›´æ–°
        å‚æ•°:
            query: [batch_size, d_model] æŸ¥è¯¢å‘é‡
            new_info: [batch_size, d_model] æ–°ä¿¡æ¯ï¼ˆå¯é€‰ï¼‰
        è¿”å›:
            retrieved: [batch_size, d_model] æ£€ç´¢ç»“æœ
        """
        # å¿«é€Ÿæ£€ç´¢
        q = self.query_proj(query)
        k = self.key_proj(self.memory)
        v = self.value_proj(self.memory)
        
        # è®¡ç®—æ³¨æ„åŠ›ï¼ˆä¼˜åŒ–åçš„è®¡ç®—ï¼‰
        scores = torch.matmul(q, k.t()) / (self.d_model ** 0.5)
        attention = F.softmax(scores, dim=-1)
        retrieved = torch.matmul(attention, v)
        
        # åœ¨çº¿æ›´æ–°ï¼ˆå¦‚æœæä¾›äº†æ–°ä¿¡æ¯ï¼‰
        if new_info is not None:
            gate = torch.sigmoid(self.update_gate(new_info))
            # æ›´æ–°æœ€ç›¸å…³çš„è®°å¿†ä½ç½®
            top_k_indices = torch.topk(attention, k=min(10, self.memory_size), dim=-1)[1]
            for i, idx in enumerate(top_k_indices):
                self.memory.data[idx] = gate[i] * new_info[i] + (1 - gate[i]) * self.memory.data[idx]
        
        return retrieved

# ä½¿ç”¨ç¤ºä¾‹
if __name__ == "__main__":
    memory = MonetaMemory(d_model=512, memory_size=1000)
    query = torch.randn(2, 512)
    new_info = torch.randn(2, 512)
    
    # æ£€ç´¢
    result = memory(query, new_info)
    print(f"æ£€ç´¢ç»“æœå½¢çŠ¶: {result.shape}")  # [2, 512]</code></pre>
                </div>
            </div>
        </div>
    </div>
    <!-- å…¬å…±è„šæœ¬ -->
    <script src="../common/tech-document.js"></script>
</body>
</html>

