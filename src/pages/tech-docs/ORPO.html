<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ORPOï¼ˆOdds Ratio Preference Optimizationï¼‰- æŠ€æœ¯è¯¦è§£</title>
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']],
                processEscapes: true,
                processEnvironments: true
            },
            options: {
                skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
            }
        };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    
    <!-- å…¬å…±æ ·å¼ -->
    <link rel="stylesheet" href="../common/styles.css">
</head>
<body>
    <div class="container">
        <h1>ORPOï¼šå•é˜¶æ®µå¥‡å¶æ¯”åå¥½ä¼˜åŒ–</h1>
        <p class="tagline">å°†ç›‘ç£å¾®è°ƒä¸åå¥½å¯¹é½åˆå¹¶ä¸ºä¸€æ¬¡è®­ç»ƒï¼Œé€šè¿‡ odds ratio æŸå¤±åœ¨å•æ¨¡å‹ä¸ŠåŒæ—¶å­¦ä¹ ä»»åŠ¡èƒ½åŠ›ä¸äººç±»åå¥½ã€‚</p>

        <div class="meta-grid">
            <div class="meta-card">
                <h3>æ ¸å¿ƒæ€è·¯</h3>
                <p>ä»¥ SFT æ ·æœ¬å’Œåå¥½æ ·æœ¬æ··åˆè®­ç»ƒï¼Œæœ€å°åŒ–äº¤å‰ç†µ + å¥‡å¶æ¯”æŸå¤±ã€‚</p>
            </div>
            <div class="meta-card">
                <h3>ä¼˜åŠ¿</h3>
                <p>çœå»å¥–åŠ±æ¨¡å‹ä¸ PPO å¾ªç¯ï¼Œè®­ç»ƒæˆæœ¬ä¸‹é™ 40~60%ï¼Œæµç¨‹æ›´ç®€æ´ã€‚</p>
            </div>
            <div class="meta-card">
                <h3>æ•°æ®å½¢æ€</h3>
                <p>æŒ‡ä»¤/å›ç­”å•æ ·æœ¬ + åå¥½æˆå¯¹æ ·æœ¬ï¼Œå¯æŒ‰æ¯”ä¾‹äº¤æ›¿é‡‡æ ·ã€‚</p>
            </div>
            <div class="meta-card">
                <h3>å…¸å‹å®ç°</h3>
                <p>Axolotl ORPOã€trl==0.8+ ORPOTrainerã€LLaMA-Factory ORPO presetã€‚</p>
            </div>
        </div>

        <div class="section">
            <h2>ğŸ§  æŠ€æœ¯è¦ç‚¹</h2>
            <ul>
                <li><strong>è”åˆæŸå¤±ï¼š</strong>åœ¨åŒä¸€ batch å†…è®¡ç®—ç›‘ç£äº¤å‰ç†µå’Œåå¥½ odds ratio æŸå¤±ã€‚</li>
                <li><strong>Logit Matchingï¼š</strong>å¥‡å¶æ¯”è¿«ä½¿æ¨¡å‹æ‹‰å¤§ä¼˜åŠ£å›ç­”çš„å¯¹æ•°æ¦‚ç‡å·®ã€‚</li>
                <li><strong>å•æ¨¡å‹éƒ¨ç½²ï¼š</strong>è®­ç»ƒå®Œæˆå³å¾—å¯¹é½æ¨¡å‹ï¼Œæ— éœ€é¢å¤– reference policyã€‚</li>
                <li><strong>ç¨³å®šæ€§é«˜ï¼š</strong>ä¸ä¾èµ– KL æƒ©ç½šä¸ä»·å€¼å¤´ï¼Œæ¢¯åº¦æ›´å¹³æ»‘ã€‚</li>
            </ul>
        </div>

        <div class="section">
            <h2>ğŸ“Š å›¾è§£</h2>
            <div class="diagram-gallery">
                <div class="diagram-item">
                    <img src="./assets/ORPOæµç¨‹.png" alt="ORPO å•é˜¶æ®µæµç¨‹" onclick="openImageModal(this)" onerror="this.parentElement.style.display='none'">
                    <div class="caption">å•é˜¶æ®µæµç¨‹</div>
                </div>
                <div class="diagram-item">
                    <img src="./assets/ORPOæŸå¤±.png" alt="è”åˆæŸå¤±æ›²çº¿" onclick="openImageModal(this)" onerror="this.parentElement.style.display='none'">
                    <div class="caption">è”åˆæŸå¤±æ›²çº¿</div>
                </div>
                <div class="diagram-item">
                    <img src="./assets/ORPOå¯¹æ¯”.png" alt="ä¸ DPO / PPO å¯¹æ¯”" onclick="openImageModal(this)" onerror="this.parentElement.style.display='none'">
                    <div class="caption">ä¸ DPO / PPO å¯¹æ¯”</div>
                </div>
            </div>
        </div>

        <div class="section">
            <h2>ğŸ“ æ•°å­¦åŸç†</h2>
            <div class="math-box">
                <h3>å¥‡å¶æ¯”æŸå¤±</h3>
                <div class="math-formula">
                    <p>åå¥½æŸå¤±å®šä¹‰ä¸ºï¼š</p>
                    <p>$$\mathcal{L}_{\text{ORPO}} = -\log \sigma\Big( \eta + \log \frac{\pi_\theta(y^{+}|x)}{\pi_\theta(y^{-}|x)} \Big)$$</p>
                    <p>å…¶ä¸­ $\eta$ æ§åˆ¶ marginï¼Œä¿ƒä½¿æ¨¡å‹æé«˜ä¼˜è´¨å›ç­”æ¦‚ç‡ã€‚</p>
                </div>
            </div>
            <div class="math-box">
                <h3>è”åˆç›®æ ‡</h3>
                <div class="math-formula">
                    <p>æ€»æŸå¤±ï¼š</p>
                    <p>$$\mathcal{L} = \mathcal{L}_{\text{SFT}} + \lambda \cdot \mathcal{L}_{\text{ORPO}}$$</p>
                    <p>$\lambda$ æ§åˆ¶ç›‘ç£ä¸åå¥½ä¹‹é—´çš„æƒè¡¡ï¼Œä¸€èˆ¬å– 0.1~0.3ã€‚</p>
                </div>
            </div>
        </div>

        <div class="section">
            <h2>ğŸ’» Python ä»£ç ç¤ºä¾‹</h2>
            <div class="code-box">
                <h3>Axolotl ORPO ç‰‡æ®µ</h3>
                <pre><code class="language-yaml">base_model: meta-llama/Llama-3-8b-Instruct
adapter: lora
lora_r: 64
lora_alpha: 128
qlora: true
optim: adamw_torch
lr: 1e-5
orpo:
  enabled: true
  lambda: 0.2
  margin: 2.0
  mixing_ratio: 0.5   # SFT : Preference
</code></pre>
                <pre><code class="language-python">from orpo import ORPOTrainer
trainer = ORPOTrainer(model, tokenizer, orpo_config)
trainer.train()</code></pre>
            </div>
        </div>
    </div>

    <div id="imageModal" class="image-modal" onclick="closeImageModal()">
        <span class="image-modal-close" onclick="event.stopPropagation(); closeImageModal();">&times;</span>
        <img id="modalImage" class="image-modal-content" src="" alt="">
        <div id="modalCaption" class="image-modal-caption"></div>
    </div>

    <script>
        function openImageModal(img) {
            const modal = document.getElementById('imageModal');
            const modalImg = document.getElementById('modalImage');
            const modalCaption = document.getElementById('modalCaption');
            modal.classList.add('active');
            modalImg.src = img.src;
            modalCaption.textContent = img.alt || '';
        }
        function closeImageModal() {
            document.getElementById('imageModal').classList.remove('active');
        }
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') closeImageModal();
        });
    </script>
    <!-- å…¬å…±è„šæœ¬ -->
    <script src="../common/tech-document.js"></script>
</body>
</html>
