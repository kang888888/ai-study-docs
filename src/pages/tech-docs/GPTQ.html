<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GPTQï¼ˆGradient Post-Training Quantizationï¼‰è¯¦è§£</title>
    <script>
        window.MathJax = { tex: { inlineMath: [['$', '$'], ['\\(', '\\)']], displayMath: [['$$', '$$'], ['\\[', '\\]']] }, options: { skipHtmlTags: ['script','noscript','style','textarea','pre','code'] } };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    
    <!-- å…¬å…±æ ·å¼ -->
    <link rel="stylesheet" href="../common/styles.css">
</head>
<body>
    <div class="container">
        <h1>GPTQï¼šæ¢¯åº¦é©±åŠ¨çš„åè®­ç»ƒ 4bit é‡åŒ–</h1>
        <p class="tagline">é€šè¿‡æœ€å°äºŒä¹˜ + æ¢¯åº¦æ ¡æ­£çš„æ–¹å¼åœ¨ä¸é‡æ–°è®­ç»ƒçš„æƒ…å†µä¸‹å®ç°é«˜ç²¾åº¦ 4bit æƒé‡é‡åŒ–ï¼Œè¢«å¹¿æ³›ç”¨äº LLaMA/OPT å®¶æ—ã€‚</p>

        <div class="meta-grid">
            <div class="meta-card"><h3>æ ¸å¿ƒæ€æƒ³</h3><p>ä»¥å—ä¸ºå•ä½å¯¹æƒé‡è¿›è¡Œè´ªå¿ƒé‡åŒ–ï¼Œå¹¶ç”¨ Hessian/æ¢¯åº¦ä¿¡æ¯è¡¥å¿è¯¯å·®ã€‚</p></div>
            <div class="meta-card"><h3>ä¼˜ç‚¹</h3><p>æ— éœ€è®­ç»ƒã€ç²¾åº¦é«˜ã€é€‚åˆå¤§æ¨¡å‹ã€æ¨ç†å‹å¥½ã€‚</p></div>
            <div class="meta-card"><h3>ä¾èµ–</h3><p>æ ¡å‡†æ•°æ®ã€Hessian è¿‘ä¼¼ï¼ˆå¯ç”±æ¢¯åº¦æˆ–è¿‘ä¼¼çŸ©é˜µè¡¨ç¤ºï¼‰ï¼Œbitsandbytes å®ç°ã€‚</p></div>
            <div class="meta-card"><h3>å…¸å‹åº”ç”¨</h3><p>LLaMAã€Mistralã€Qwenã€CodeLlama 4bit/3bit æ¨ç†ã€‚</p></div>
        </div>

        <div class="section">
            <h2>âš™ï¸ æµç¨‹</h2>
            <ul>
                <li>å°†æƒé‡çŸ©é˜µæŒ‰åˆ—orè¡Œæ‹†æˆå°å—ï¼ˆå¦‚ 128 åˆ—ï¼‰ã€‚</li>
                <li>è®¡ç®—è¯¥å—çš„ Hessian è¿‘ä¼¼ $H$ï¼Œè®°å½•çµæ•åº¦ã€‚</li>
                <li>å¯¹æ¯åˆ—æ‰§è¡Œæœ€å°åŒ– $(w - \hat{w})^T H (w - \hat{w})$ çš„é‡åŒ–ã€‚</li>
                <li>ä½¿ç”¨å‰©ä½™è¯¯å·®æ›´æ–°å°šæœªé‡åŒ–çš„åˆ—ï¼Œé¿å…è¯¯å·®æ‰©æ•£ã€‚</li>
            </ul>
        </div>

        <div class="section">
            <h2>ğŸ“Š å›¾è§£</h2>
            <div class="diagram-gallery">
                <div class="diagram-item"><img src="./assets/GPTQæµç¨‹.png" alt="GPTQ é‡åŒ–æµç¨‹" onclick="openImageModal(this)" onerror="this.parentElement.style.display='none'"><div class="caption">æµç¨‹</div></div>
                <div class="diagram-item"><img src="./assets/GPTQè¯¯å·®.png" alt="è¯¯å·®è¡¥å¿" onclick="openImageModal(this)" onerror="this.parentElement.style.display='none'"><div class="caption">è¯¯å·®è¡¥å¿</div></div>
                <div class="diagram-item"><img src="./assets/GPTQæ€§èƒ½.png" alt="æ€§èƒ½å¯¹æ¯”" onclick="openImageModal(this)" onerror="this.parentElement.style.display='none'"><div class="caption">ç²¾åº¦ vs æ¨ç†é€Ÿåº¦</div></div>
            </div>
        </div>

        <div class="section">
            <h2>ğŸ“ æ•°å­¦åŸç†</h2>
            <div class="math-box">
                <h3>æœ€å°äºŒä¹˜é‡åŒ–</h3>
                <div class="math-formula">
                    <p>ç›®æ ‡ï¼š$$\hat{w} = \arg\min_{q} (w - q)^T H (w - q)$$</p>
                    <p>å…¶ä¸­ $H$ æ˜¯ Hessian è¿‘ä¼¼ï¼Œé€šè¿‡æ¢¯åº¦ç§¯ç´¯æˆ–è¿‘ä¼¼ Fisher ä¿¡æ¯è·å¾—ã€‚</p>
                </div>
            </div>
            <div class="math-box">
                <h3>è¯¯å·®å›ä¼ </h3>
                <div class="math-formula">
                    <p>é‡åŒ–ç¬¬ i åˆ—åæ›´æ–°å‰©ä½™åˆ—ï¼š</p>
                    <p>$$W_{j} \leftarrow W_{j} - \frac{H_{ji}}{H_{ii}} (w_i - \hat{w}_i)$$</p>
                    <p>é¿å…è¯¯å·®é›†ä¸­ï¼Œæå‡æ•´ä½“ç²¾åº¦ã€‚</p>
                </div>
            </div>
        </div>

        <div class="section">
            <h2>ğŸ’» ä»£ç ç¤ºä¾‹</h2>
            <div class="code-box">
                <h3>ä½¿ç”¨ AutoGPTQ å¯¼å‡º 4bit æ¨¡å‹</h3>
                <pre><code class="language-python">from auto_gptq import AutoGPTQForCausalLM, BaseQuantizeConfig
from transformers import AutoTokenizer

model_name = "meta-llama/Llama-2-13b-hf"
quant_config = BaseQuantizeConfig(
    bits=4,
    group_size=128,
    damp_percent=0.01,
    desc_act=False
)

model = AutoGPTQForCausalLM.from_pretrained(
    model_name,
    quantize_config=quant_config
)

tokenizer = AutoTokenizer.from_pretrained(model_name, use_fast=False)
model.quantize(dataset="c4", batch_size=16, cache_examples_on_gpu=False)
model.save_quantized("./llama2-13b-gptq", use_safetensors=True)
</code></pre>
            </div>
        </div>
    </div>

    <div id="imageModal" class="image-modal" onclick="closeImageModal()">
        <span class="image-modal-close" onclick="event.stopPropagation(); closeImageModal();">&times;</span>
        <img id="modalImage" class="image-modal-content" src="" alt="">
        <div id="modalCaption" class="image-modal-caption"></div>
    </div>

    <script>
        function openImageModal(img){const modal=document.getElementById('imageModal');modal.classList.add('active');document.getElementById('modalImage').src=img.src;document.getElementById('modalCaption').textContent=img.alt||'';}
        function closeImageModal(){document.getElementById('imageModal').classList.remove('active');}
        document.addEventListener('keydown',e=>{if(e.key==='Escape')closeImageModal();});
    </script>
    <!-- å…¬å…±è„šæœ¬ -->
    <script src="../common/tech-document.js"></script>
</body>
</html>
