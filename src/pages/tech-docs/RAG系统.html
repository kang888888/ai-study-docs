<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>RAG系统</title>
    <script>
        window.MathJax = { tex: { inlineMath: [["$", "$"], ["\\(", "\\)"]], displayMath: [["$$", "$$"], ["\\[", "\\]"]] } };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    
    <!-- 公共样式 -->
    <link rel="stylesheet" href="../common/styles.css">
</head>
<body>
<div class="container">
    <h1>RAG系统</h1>
    <p class="tagline">检索增强生成（Retrieval-Augmented Generation）的架构、优化技术、高级玩法与实践案例。</p>

    <div class="meta-grid">
        <div class="meta-card"><h3>核心流程</h3><p>文档处理 → 向量化 → 检索 → 上下文增强 → LLM 生成</p></div>
        <div class="meta-card"><h3>关键能力</h3><p>高质量检索、上下文控制、Prompt 工程、可解释输出</p></div>
        <div class="meta-card"><h3>优化方向</h3><p>查询/索引优化、生成优化、评估闭环</p></div>
        <div class="meta-card"><h3>高级玩法</h3><p>查询构造、工具集成、后处理、DSPy 自动调优</p></div>
    </div>

    <div class="section">
        <h2>🏗️ 基础架构</h2>
        <div class="flow">文档处理 → 向量化 → 向量存储 → 查询向量化 → 相似度检索 → 上下文增强 → LLM 生成</div>
        <h3>1. 文档处理</h3>
        <ul>
            <li>TextLoader / PDFLoader / WebLoader</li>
            <li>RecursiveCharacterTextSplitter 控制 chunk size / overlap</li>
            <li>清理、去重、添加元数据</li>
        </ul>
        <h3>2. 向量化与存储</h3>
        <ul>
            <li>嵌入模型：OpenAIEmbeddings、bge、大模型 embedding</li>
            <li>向量数据库：Chroma、FAISS、Milvus、Qdrant</li>
            <li>保存来源、标题、时间等元数据，支持过滤</li>
        </ul>
        <h3>3. 检索与生成</h3>
        <div class="code-box"><pre><code class="language-python">from langchain.document_loaders import TextLoader
from langchain.text_splitter import RecursiveCharacterTextSplitter
from langchain.vectorstores import Chroma
from langchain.chains import RetrievalQA

loader = TextLoader("docs.txt")
chunks = RecursiveCharacterTextSplitter(chunk_size=800, chunk_overlap=200).split_documents(loader.load())
vectorstore = Chroma.from_documents(chunks, embeddings)
qa_chain = RetrievalQA.from_chain_type(
    llm=llm,
    chain_type="stuff",
    retriever=vectorstore.as_retriever()
)
answer = qa_chain.run("文档里提到的关键结论是什么？")</code></pre></div>
    </div>

    <div class="section">
        <h2>⚙️ RAG 优化技术</h2>
        <h3>检索优化</h3>
        <ul>
            <li>查询扩展 / 重写 / 分解</li>
            <li>索引选择：HNSW（大规模）、IVF（高维）、LSH（近似）</li>
            <li>重排序：Cross-Encoder、Reranker、MMR</li>
        </ul>
        <h3>生成优化</h3>
        <div class="code-box"><pre><code class="language-text">基于以下上下文回答问题，若无法回答请说"未知"。
{context}

问题：{question}
回答：</code></pre></div>
        <ul>
            <li>控制上下文长度：排序 + 去重 + 重要度裁剪</li>
            <li>生成参数调优：temperature / top_p / max_tokens</li>
        </ul>
        <h3>评估优化</h3>
        <ul>
            <li>检索指标：Recall、Precision、MRR</li>
            <li>生成指标：BLEU、ROUGE、BERTScore</li>
            <li>A/B 测试不同 Prompt、索引与参数</li>
        </ul>
    </div>

    <div class="section">
        <h2>🔬 高级 RAG 技术</h2>
        <h3>1. 查询构造</h3>
        <p>Text-to-SQL、Cypher、混合查询，将自然语言转换为结构化查询以访问数据库或知识图谱。</p>
        <h3>2. 工具集成</h3>
        <p>LLM 自动选择使用搜索、计算、API、数据库等工具，扩展能力范围。</p>
        <h3>3. 后处理</h3>
        <ul>
            <li>重排序（Cross-Encoder）</li>
            <li>RAG-Fusion（多查询融合）</li>
            <li>分类/路由：根据问题类型进入不同处理流</li>
        </ul>
        <h3>4. 程序化 LLM / DSPy</h3>
        <p>通过签名、模块、优化器自动调优 Prompt 和参数，减少人工试错，提高可复现性。</p>
    </div>

    <div class="section">
        <h2>🧪 实践案例</h2>
        <h3>1. 文档问答系统</h3>
        <p>企业文档库问答，Doc Loader → Text Splitter → Chroma → RetrievalQA。</p>
        <h3>2. 知识库助手</h3>
        <p>面向企业知识库/FAQ/SOP，结合权限过滤与多索引。</p>
        <h3>3. 代码文档助手</h3>
        <p>加载代码注释与 API 文档，给开发者提供即时帮助。</p>
    </div>

    <div class="section">
        <h2>✅ 最佳实践</h2>
        <ul>
            <li>数据治理：高质量文档、元数据管理</li>
            <li>Chunk 策略：按语义/标题切分，合理 overlap</li>
            <li>检索调优：Top-k、过滤、混合检索</li>
            <li>上下文控制：排序、去重、加来源引用</li>
            <li>提示设计：明确输出格式与引用要求</li>
            <li>监控评估：线上指标 + 抽检 + 用户反馈闭环</li>
        </ul>
    </div>

    <div class="section">
        <h2>🔗 相关资源</h2>
        <ul>
            <li><a href="./RAG系统.md">RAG系统（Markdown）</a></li>
            <li><a href="../向量数据库/向量数据库.md">向量数据库</a></li>
            <li><a href="../LangChain框架/LangChain框架.md">LangChain框架</a></li>
            <li><a href="../AI智能体/AI智能体.md">AI智能体</a></li>
            <li><a href="https://dspy.ai/" target="_blank">DSPy 官方站点</a></li>
        </ul>
    </div>
</div>
    <!-- 公共脚本 -->
    <script src="../common/tech-document.js"></script>
</body>
</html>