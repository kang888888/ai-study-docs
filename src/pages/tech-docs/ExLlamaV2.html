<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ExLlamaV2ï¼šæé€Ÿ 4bit æ¨ç†å¼•æ“</title>
    <script>
        window.MathJax = { tex: { inlineMath: [['$', '$'], ['\\(', '\\)']], displayMath: [['$$', '$$'], ['\\[', '\\]']] }, options: { skipHtmlTags: ['script','noscript','style','textarea','pre','code'] } };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    
    <!-- å…¬å…±æ ·å¼ -->
    <link rel="stylesheet" href="../common/styles.css">
</head>
<body>
    <div class="container">
        <h1>ExLlamaV2ï¼šé¢å‘ 4bit LLaMA çš„æè‡´æ¨ç†æ¡†æ¶</h1>
        <p class="tagline">ä¸“ä¸º GPTQ/AWQ æ¨¡å‹æ‰“é€ çš„é«˜æ€§èƒ½åç«¯ï¼Œä½¿ç”¨è‡ªç ” CUDA kernelã€KV cache ä¼˜åŒ–ä¸æµæ°´çº¿å¹¶è¡Œï¼Œæ¨ç†é€Ÿåº¦é¢†å…ˆ vLLM/vCUDAã€‚</p>

        <div class="meta-grid">
            <div class="meta-card"><h3>å…³é”®ç‰¹æ€§</h3><p>å—çŠ¶ Tensor Core kernelã€åŠ¨æ€æ‰¹å¤„ç†ã€åˆ†å±‚ç¼“å­˜ã€è‡ªåŠ¨åˆ†ç‰‡ã€‚</p></div>
            <div class="meta-card"><h3>ä¼˜åŒ–ç‚¹</h3><p>Warp ç²’åº¦è®¡ç®—ã€Fuse MatMul+Actã€Paged KV Cacheã€å¿«é€Ÿé‡‡æ ·ã€‚</p></div>
            <div class="meta-card"><h3>å…¼å®¹æ ¼å¼</h3><p>GPTQ (.safetensors)ã€AWQã€AutoAWQã€ExLlama è‡ªå®šä¹‰æƒé‡ã€‚</p></div>
            <div class="meta-card"><h3>é€‚é…åœºæ™¯</h3><p>ç›´æ’­èŠå¤©ã€Agentã€Stream æ¨ç†ã€ä½å»¶è¿ŸæœåŠ¡ã€‚</p></div>
        </div>

        <div class="section">
            <h2>âš¡ æŠ€æœ¯è¦ç‚¹</h2>
            <ul>
                <li><strong>Tensor Core ä¸“ç”¨ kernelï¼š</strong>é¿å…ä¸­é—´è§£é‡åŒ–ï¼Œç›´æ¥åœ¨ 4bit è¡¨ç¤ºä¸ŠåšçŸ©é˜µä¹˜ã€‚</li>
                <li><strong>KV Cache é‡æ’ï¼š</strong>ä½¿ç”¨ paged buffer è§£å†³é•¿å¯¹è¯çš„æ‰©å®¹é—®é¢˜ã€‚</li>
                <li><strong>æ¨ç†æµæ°´çº¿ï¼š</strong>åˆ†ç¦» Prefill ä¸ Decode é˜¶æ®µï¼Œæ”¯æŒå¤šä¼šè¯å¹¶è¡Œã€‚</li>
                <li><strong>PEFT æ”¯æŒï¼š</strong>å¯åŠ è½½ LoRA/QLoRA é€‚é…å™¨å¹¶åœ¨ 4bit åŸºåº•ä¸Šè¿è¡Œã€‚</li>
            </ul>
        </div>

        <div class="section">
            <h2>ğŸ“Š å›¾è§£</h2>
            <div class="diagram-gallery">
                <div class="diagram-item"><img src="./assets/ExLlamaV2æ¶æ„.png" alt="æ¶æ„" onclick="openImageModal(this)" onerror="this.parentElement.style.display='none'"><div class="caption">æ¶æ„</div></div>
                <div class="diagram-item"><img src="./assets/ExLlamaV2æ€§èƒ½.png" alt="æ€§èƒ½å¯¹æ¯”" onclick="openImageModal(this)" onerror="this.parentElement.style.display='none'"><div class="caption">æ€§èƒ½å¯¹æ¯”</div></div>
                <div class="diagram-item"><img src="./assets/ExLlamaV2ç¼“å­˜.png" alt="ç¼“å­˜ç­–ç•¥" onclick="openImageModal(this)" onerror="this.parentElement.style.display='none'"><div class="caption">ç¼“å­˜ç­–ç•¥</div></div>
            </div>
        </div>

        <div class="section">
            <h2>ğŸ“ æ•°å­¦/æ€§èƒ½æ¨¡å‹</h2>
            <div class="math-box">
                <h3>ååä¼°ç®—</h3>
                <div class="math-formula">
                    <p>$$TPS \approx \frac{B \times H \times d_{model}}{t_{kernel} + t_{io}}$$</p>
                    <p>ExLlamaV2 é€šè¿‡å‡å°‘ $t_{io}$ï¼ˆå°‘è§£é‡åŒ–ï¼‰å’Œä¼˜åŒ– $t_{kernel}$ è·å¾—æ›´é«˜ TPSã€‚</p>
                </div>
            </div>
            <div class="math-box">
                <h3>KV Cache å†…å­˜</h3>
                <div class="math-formula">
                    <p>$$\text{Mem} = 2 \times L \times H \times d_{head} \times bytes_{dtype}$$</p>
                    <p>Paged Cache å°† $L$ åˆ‡å—ï¼Œå¹¶å¤ç”¨é‡Šæ”¾çš„å—å‡å° MEM å³°å€¼ã€‚</p>
                </div>
            </div>
        </div>

        <div class="section">
            <h2>ğŸ’» ä»£ç ç¤ºä¾‹</h2>
            <div class="code-box">
                <h3>Python å¿«é€Ÿæ¨ç†</h3>
<pre><code class="language-python">from exllamav2 import ExLlamaV2, ExLlamaV2Config, ExLlamaV2Tokenizer

config = ExLlamaV2Config("./llama-2-13b-gptq")
model = ExLlamaV2(config)
model.load_autosplit()

tokenizer = ExLlamaV2Tokenizer(config)
prompt = "### ç”¨æˆ·: è§£é‡Š ExLlamaV2 çš„ä¼˜åŠ¿\n### åŠ©æ‰‹:"
output = model.generate(
    tokenizer.encode(prompt),
    max_new_tokens=256,
    temperature=0.7,
    top_p=0.9
)
print(tokenizer.decode(output))
</code></pre>
            </div>
        </div>
    </div>

    <div id="imageModal" class="image-modal" onclick="closeImageModal()">
        <span class="image-modal-close" onclick="event.stopPropagation(); closeImageModal();">&times;</span>
        <img id="modalImage" class="image-modal-content" src="" alt="">
        <div id="modalCaption" class="image-modal-caption"></div>
    </div>

    <script>
        function openImageModal(img){const modal=document.getElementById('imageModal');modal.classList.add('active');document.getElementById('modalImage').src=img.src;document.getElementById('modalCaption').textContent=img.alt||'';}
        function closeImageModal(){document.getElementById('imageModal').classList.remove('active');}
        document.addEventListener('keydown',e=>{if(e.key==='Escape')closeImageModal();});
    </script>
    <!-- å…¬å…±è„šæœ¬ -->
    <script src="../common/tech-document.js"></script>
</body>
</html>
