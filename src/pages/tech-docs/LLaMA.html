<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LLaMA (Large Language Model Meta AI) - æ¶æ„è¯¦è§£</title>
    <!-- MathJax for mathematical formulas -->
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']],
                processEscapes: true,
                processEnvironments: true
            },
            options: {
                skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
            }
        };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <!-- Prism.js for code highlighting -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    
    <!-- å…¬å…±æ ·å¼ -->
    <link rel="stylesheet" href="../common/styles.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>LLaMA (Large Language Model Meta AI)</h1>
            <p>Metaå¼€æºçš„å¤§è¯­è¨€æ¨¡å‹ç³»åˆ—</p>
        </div>
        <div class="content">
            
            <div class="section">
                <h2>ğŸ“– æ ¸å¿ƒæ¦‚å¿µ</h2>
                <div class="desc-box">
                    <p>Metaå¼€æºçš„å¤§è¯­è¨€æ¨¡å‹ç³»åˆ—ï¼ŒåŒ…å«7Båˆ°70Bå¤šä¸ªè§„æ¨¡ã€‚é‡‡ç”¨RMSNormã€SwiGLUã€RoPEç­‰ç°ä»£ä¼˜åŒ–æŠ€æœ¯ï¼Œæ€§èƒ½ä¼˜å¼‚ä¸”å®Œå…¨å¼€æºå¯å•†ç”¨ï¼Œæˆä¸ºå¼€æºç¤¾åŒºçš„åŸºåº§æ¨¡å‹ã€‚</p>
                </div>
            </div>
            <div class="section features">
                <h2>ğŸŒŸ æ ¸å¿ƒç‰¹ç‚¹</h2>
                <ul>
                    <li>å®Œå…¨å¼€æºï¼šå¯å•†ç”¨ï¼Œè¡ç”Ÿå‡ºå¤§é‡å¾®è°ƒç‰ˆæœ¬ï¼ˆAlpacaã€Vicunaç­‰ï¼‰</li>
                    <li>RMSNormï¼šæ›¿ä»£LayerNormï¼Œè®¡ç®—æ›´é«˜æ•ˆ</li>
                    <li>SwiGLUæ¿€æ´»ï¼šæ›¿ä»£ReLUï¼Œæ€§èƒ½æ›´å¥½</li>
                    <li>RoPEä½ç½®ç¼–ç ï¼šæ—‹è½¬ä½ç½®ç¼–ç ï¼Œæ”¯æŒé•¿ä¸Šä¸‹æ–‡æ‰©å±•</li>
                    <li>GQAä¼˜åŒ–ï¼šLLaMA-2/3ä½¿ç”¨åˆ†ç»„æŸ¥è¯¢æ³¨æ„åŠ›ï¼Œé™ä½KV Cache</li>
                </ul>
            </div>
            <div class="section">
                <h2>âš™ï¸ å…³é”®æŠ€æœ¯</h2>
                <div class="tech-box"><p><strong>RMSNormã€SwiGLUã€RoPEã€Grouped-Query Attentionï¼ˆGQAï¼‰</strong></p></div>
            </div>
            <div class="section">
                <h2>ğŸš€ åº”ç”¨åœºæ™¯</h2>
                <div class="app-box"><p>é€šç”¨å¯¹è¯ã€ä»£ç ç”Ÿæˆã€æŒ‡ä»¤éµå¾ªã€ä½œä¸ºåŸºåº§æ¨¡å‹å¾®è°ƒ</p></div>
            </div>

            <div class="section">
                <h2>ğŸ“ æ•°å­¦åŸç†</h2>
                <div class="math-box">
                    <h3>RMSNormï¼ˆRoot Mean Square Layer Normalizationï¼‰</h3>
                    <div class="math-formula">
                        <p>RMSNorm å…¬å¼ï¼š</p>
                        <p>$$\text{RMSNorm}(x) = \frac{x}{\text{RMS}(x)} \odot g$$</p>
                        <p>$$\text{RMS}(x) = \sqrt{\frac{1}{n}\sum_{i=1}^{n} x_i^2}$$</p>
                        <p>ç›¸æ¯” LayerNormï¼ŒRMSNorm ä¸éœ€è¦è®¡ç®—å‡å€¼ï¼Œè®¡ç®—æ›´é«˜æ•ˆ</p>
                    </div>
                </div>
                <div class="math-box">
                    <h3>SwiGLU æ¿€æ´»å‡½æ•°</h3>
                    <div class="math-formula">
                        <p>SwiGLU å…¬å¼ï¼š</p>
                        <p>$$\text{SwiGLU}(x) = \text{Swish}(xW + b) \odot (xV + c)$$</p>
                        <p>$$\text{Swish}(x) = x \cdot \sigma(x)$$</p>
                        <p>å…¶ä¸­ $\sigma$ æ˜¯ sigmoid å‡½æ•°ï¼Œ$\odot$ æ˜¯é€å…ƒç´ ç›¸ä¹˜</p>
                    </div>
                </div>
                <div class="math-box">
                    <h3>RoPEï¼ˆæ—‹è½¬ä½ç½®ç¼–ç ï¼‰</h3>
                    <div class="math-formula">
                        <p>æ—‹è½¬ä½ç½®ç¼–ç ï¼š</p>
                        <p>$$R_{\Theta, m}^d = \begin{pmatrix}
                        \cos m\theta_1 & -\sin m\theta_1 & 0 & 0 & \cdots \\
                        \sin m\theta_1 & \cos m\theta_1 & 0 & 0 & \cdots \\
                        0 & 0 & \cos m\theta_2 & -\sin m\theta_2 & \cdots \\
                        0 & 0 & \sin m\theta_2 & \cos m\theta_2 & \cdots \\
                        \vdots & \vdots & \vdots & \vdots & \ddots
                        \end{pmatrix}$$</p>
                        <p>å…¶ä¸­ $\theta_i = 10000^{-2(i-1)/d}$ï¼Œ$m$ æ˜¯ä½ç½®ç´¢å¼•</p>
                    </div>
                </div>
            </div>

            <div class="section">
                <h2>ğŸ’» Python ä»£ç ç¤ºä¾‹</h2>
                <div class="code-box">
                    <h3>ä½¿ç”¨ Transformers åº“åŠ è½½ LLaMA</h3>
                    <pre><code class="language-python">from transformers import LlamaForCausalLM, LlamaTokenizer
import torch

# åŠ è½½æ¨¡å‹å’Œåˆ†è¯å™¨
model_name = "meta-llama/Llama-2-7b-hf"  # éœ€è¦HuggingFaceè®¿é—®æƒé™
tokenizer = LlamaTokenizer.from_pretrained(model_name)
model = LlamaForCausalLM.from_pretrained(model_name)

# è¾“å…¥æ–‡æœ¬
text = "The future of AI is"

# åˆ†è¯
inputs = tokenizer(text, return_tensors="pt")

# ç”Ÿæˆ
with torch.no_grad():
    outputs = model.generate(
        **inputs,
        max_length=100,
        temperature=0.7,
        do_sample=True
    )

# è§£ç 
generated_text = tokenizer.decode(outputs[0], skip_special_tokens=True)
print(generated_text)</code></pre>
                </div>
                <div class="code-box">
                    <h3>æ‰‹åŠ¨å®ç° RMSNorm å’Œ SwiGLU</h3>
                    <pre><code class="language-python">import torch
import torch.nn as nn
import torch.nn.functional as F

class RMSNorm(nn.Module):
    """RMSNorm å®ç°"""
    def __init__(self, dim, eps=1e-8):
        super(RMSNorm, self).__init__()
        self.eps = eps
        self.weight = nn.Parameter(torch.ones(dim))
    
    def forward(self, x):
        # è®¡ç®— RMS
        rms = torch.sqrt(torch.mean(x ** 2, dim=-1, keepdim=True) + self.eps)
        # å½’ä¸€åŒ–å¹¶ç¼©æ”¾
        return x / rms * self.weight

class SwiGLU(nn.Module):
    """SwiGLU æ¿€æ´»å‡½æ•°"""
    def __init__(self, dim):
        super(SwiGLU, self).__init__()
        self.gate_proj = nn.Linear(dim, dim)
        self.up_proj = nn.Linear(dim, dim)
    
    def forward(self, x):
        gate = F.silu(self.gate_proj(x))  # Swish = SiLU
        up = self.up_proj(x)
        return gate * up

class RoPE(nn.Module):
    """æ—‹è½¬ä½ç½®ç¼–ç ï¼ˆç®€åŒ–ç‰ˆï¼‰"""
    def __init__(self, dim, max_seq_len=2048, base=10000):
        super(RoPE, self).__init__()
        inv_freq = 1.0 / (base ** (torch.arange(0, dim, 2).float() / dim))
        self.register_buffer('inv_freq', inv_freq)
        self.max_seq_len = max_seq_len
    
    def forward(self, x, seq_len=None):
        if seq_len is None:
            seq_len = x.shape[-2]
        
        t = torch.arange(seq_len, device=x.device).type_as(self.inv_freq)
        freqs = torch.einsum('i,j->ij', t, self.inv_freq)
        emb = torch.cat((freqs, freqs), dim=-1)
        
        return emb

# ä½¿ç”¨ç¤ºä¾‹
if __name__ == "__main__":
    # RMSNorm
    rms_norm = RMSNorm(dim=768)
    x = torch.randn(2, 10, 768)
    out = rms_norm(x)
    print(f"RMSNorm è¾“å‡ºå½¢çŠ¶: {out.shape}")
    
    # SwiGLU
    swiglu = SwiGLU(dim=768)
    x = torch.randn(2, 10, 768)
    out = swiglu(x)
    print(f"SwiGLU è¾“å‡ºå½¢çŠ¶: {out.shape}")
    
    # RoPE
    rope = RoPE(dim=768)
    pos_emb = rope(x)
    print(f"RoPE ä½ç½®ç¼–ç å½¢çŠ¶: {pos_emb.shape}")</code></pre>
                </div>
            </div>
        </div>
    </div>
    <!-- å…¬å…±è„šæœ¬ -->
    <script src="../common/tech-document.js"></script>
</body>
</html>

