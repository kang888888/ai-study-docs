<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CNN (Convolutional Neural Network) å·ç§¯ç¥ç»ç½‘ç»œ - æ¶æ„è¯¦è§£</title>
    <!-- MathJax for mathematical formulas -->
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']],
                processEscapes: true,
                processEnvironments: true
            },
            options: {
                skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
            }
        };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <!-- Prism.js for code highlighting -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    
    <!-- å…¬å…±æ ·å¼ -->
    <link rel="stylesheet" href="../common/styles.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>CNN (Convolutional Neural Network) å·ç§¯ç¥ç»ç½‘ç»œ</h1>
            <p>ä¸“é—¨ç”¨äºå¤„ç†å›¾åƒæ•°æ®çš„ç¥ç»ç½‘ç»œ</p>
        </div>
        <div class="content">
            
            <div class="section">
                <h2>ğŸ“– æ ¸å¿ƒæ¦‚å¿µ</h2>
                <div class="desc-box">
                    <p>ä¸“é—¨ç”¨äºå¤„ç†å…·æœ‰ç½‘æ ¼ç»“æ„çš„æ•°æ®ï¼ˆå¦‚å›¾åƒã€è§†é¢‘ï¼‰ã€‚é€šè¿‡å·ç§¯å±‚æå–å±€éƒ¨ç‰¹å¾ï¼Œæ± åŒ–å±‚é™ä½ç»´åº¦ï¼Œæ˜¯è®¡ç®—æœºè§†è§‰é¢†åŸŸçš„åŸºçŸ³ã€‚</p>
                </div>
            </div>
            <div class="section features">
                <h2>ğŸŒŸ æ ¸å¿ƒç‰¹ç‚¹</h2>
                <ul>
                    <li>å±€éƒ¨è¿æ¥ï¼šæ¯ä¸ªç¥ç»å…ƒåªä¸å±€éƒ¨åŒºåŸŸè¿æ¥ï¼Œå¤§å¹…å‡å°‘å‚æ•°</li>
                    <li>æƒå€¼å…±äº«ï¼šåŒä¸€å·ç§¯æ ¸åœ¨æ•´ä¸ªè¾“å…¥ä¸Šå…±äº«å‚æ•°</li>
                    <li>å¹³ç§»ä¸å˜æ€§ï¼šå¯¹å›¾åƒçš„å¹³ç§»å…·æœ‰é²æ£’æ€§</li>
                    <li>å±‚æ¬¡åŒ–ç‰¹å¾æå–ï¼šæµ…å±‚æå–è¾¹ç¼˜ï¼Œæ·±å±‚æå–è¯­ä¹‰ç‰¹å¾</li>
                    <li>æ± åŒ–é™ç»´ï¼šé€šè¿‡Max Poolingæˆ–Average Poolingé™ä½ç‰¹å¾å›¾å°ºå¯¸</li>
                </ul>
            </div>
            <div class="section">
                <h2>âš™ï¸ å…³é”®æŠ€æœ¯</h2>
                <div class="tech-box"><p><strong>å·ç§¯æ“ä½œã€æ± åŒ–æ“ä½œã€æ‰¹é‡å½’ä¸€åŒ–ï¼ˆBatch Normalizationï¼‰ã€Dropoutæ­£åˆ™åŒ–</strong></p></div>
            </div>
            <div class="section">
                <h2>ğŸš€ åº”ç”¨åœºæ™¯</h2>
                <div class="app-box"><p>å›¾åƒåˆ†ç±»ï¼ˆImageNetï¼‰ã€ç›®æ ‡æ£€æµ‹ã€å›¾åƒåˆ†å‰²ã€äººè„¸è¯†åˆ«ã€åŒ»å­¦å½±åƒåˆ†æ</p></div>
            </div>
            <div class="section">
                <h2>ğŸ“Š æ¶æ„å›¾è§£</h2>
                <div class="diagram-gallery">
                    <div class="diagram-item"><img src="CNNæ¶æ„å›¾.png" alt="CNNæ¶æ„å›¾" onclick="openImageModal(this)" onerror="this.parentElement.style.display='none'"><div class="caption">CNNæ¶æ„å›¾</div></div>
                    <div class="diagram-item"><img src="å·ç§¯æ“ä½œ.png" alt="å·ç§¯æ“ä½œ" onclick="openImageModal(this)" onerror="this.parentElement.style.display='none'"><div class="caption">å·ç§¯æ“ä½œ</div></div>
                </div>
            </div>

            <div class="section">
                <h2>ğŸ“ æ•°å­¦åŸç†</h2>
                <div class="math-box">
                    <h3>å·ç§¯æ“ä½œ</h3>
                    <div class="math-formula">
                        <p>äºŒç»´ç¦»æ•£å·ç§¯å…¬å¼ï¼š</p>
                        <p>$$(I * K)(i, j) = \sum_{m} \sum_{n} I(i-m, j-n) \cdot K(m, n)$$</p>
                        <p>å…¶ä¸­ $I$ æ˜¯è¾“å…¥ç‰¹å¾å›¾ï¼Œ$K$ æ˜¯å·ç§¯æ ¸ï¼ˆæ»¤æ³¢å™¨ï¼‰</p>
                    </div>
                </div>
                <div class="math-box">
                    <h3>è¾“å‡ºå°ºå¯¸è®¡ç®—</h3>
                    <div class="math-formula">
                        <p>å·ç§¯åè¾“å‡ºå°ºå¯¸ï¼š</p>
                        <p>$$H_{out} = \frac{H_{in} + 2P - K}{S} + 1$$</p>
                        <p>$$W_{out} = \frac{W_{in} + 2P - K}{S} + 1$$</p>
                        <p>å…¶ä¸­ï¼š</p>
                        <ul style="list-style: none; padding-left: 20px;">
                            <li>$H_{in}, W_{in}$ æ˜¯è¾“å…¥çš„é«˜åº¦å’Œå®½åº¦</li>
                            <li>$K$ æ˜¯å·ç§¯æ ¸å¤§å°</li>
                            <li>$P$ æ˜¯å¡«å……ï¼ˆpaddingï¼‰</li>
                            <li>$S$ æ˜¯æ­¥é•¿ï¼ˆstrideï¼‰</li>
                        </ul>
                    </div>
                </div>
                <div class="math-box">
                    <h3>æ± åŒ–æ“ä½œ</h3>
                    <div class="math-formula">
                        <p><strong>æœ€å¤§æ± åŒ–ï¼ˆMax Poolingï¼‰ï¼š</strong></p>
                        <p>$$y_{i,j} = \max_{(m,n) \in R_{i,j}} x_{m,n}$$</p>
                        <p><strong>å¹³å‡æ± åŒ–ï¼ˆAverage Poolingï¼‰ï¼š</strong></p>
                        <p>$$y_{i,j} = \frac{1}{|R_{i,j}|} \sum_{(m,n) \in R_{i,j}} x_{m,n}$$</p>
                        <p>å…¶ä¸­ $R_{i,j}$ æ˜¯æ± åŒ–çª—å£åŒºåŸŸ</p>
                    </div>
                </div>
            </div>

            <div class="section">
                <h2>ğŸ’» Python ä»£ç ç¤ºä¾‹</h2>
                <div class="code-box">
                    <h3>ä½¿ç”¨ PyTorch å®ç° CNN</h3>
                    <pre><code class="language-python">import torch
import torch.nn as nn
import torch.nn.functional as F

class SimpleCNN(nn.Module):
    """ç®€å•çš„CNNå®ç°ï¼ˆç”¨äºå›¾åƒåˆ†ç±»ï¼‰"""
    def __init__(self, num_classes=10):
        super(SimpleCNN, self).__init__()
        
        # ç¬¬ä¸€ä¸ªå·ç§¯å—
        self.conv1 = nn.Conv2d(in_channels=3, out_channels=32, kernel_size=3, padding=1)
        self.bn1 = nn.BatchNorm2d(32)
        self.pool1 = nn.MaxPool2d(kernel_size=2, stride=2)
        
        # ç¬¬äºŒä¸ªå·ç§¯å—
        self.conv2 = nn.Conv2d(in_channels=32, out_channels=64, kernel_size=3, padding=1)
        self.bn2 = nn.BatchNorm2d(64)
        self.pool2 = nn.MaxPool2d(kernel_size=2, stride=2)
        
        # ç¬¬ä¸‰ä¸ªå·ç§¯å—
        self.conv3 = nn.Conv2d(in_channels=64, out_channels=128, kernel_size=3, padding=1)
        self.bn3 = nn.BatchNorm2d(128)
        self.pool3 = nn.MaxPool2d(kernel_size=2, stride=2)
        
        # å…¨è¿æ¥å±‚
        self.fc1 = nn.Linear(128 * 4 * 4, 512)
        self.dropout = nn.Dropout(0.5)
        self.fc2 = nn.Linear(512, num_classes)
    
    def forward(self, x):
        # å·ç§¯å—1: 32x32 -> 16x16
        x = F.relu(self.bn1(self.conv1(x)))
        x = self.pool1(x)
        
        # å·ç§¯å—2: 16x16 -> 8x8
        x = F.relu(self.bn2(self.conv2(x)))
        x = self.pool2(x)
        
        # å·ç§¯å—3: 8x8 -> 4x4
        x = F.relu(self.bn3(self.conv3(x)))
        x = self.pool3(x)
        
        # å±•å¹³
        x = x.view(x.size(0), -1)
        
        # å…¨è¿æ¥å±‚
        x = F.relu(self.fc1(x))
        x = self.dropout(x)
        x = self.fc2(x)
        
        return x

# ä½¿ç”¨ç¤ºä¾‹
if __name__ == "__main__":
    # åˆ›å»ºæ¨¡å‹
    model = SimpleCNN(num_classes=10)
    
    # æ¨¡æ‹Ÿè¾“å…¥ (batch_size=4, channels=3, height=32, width=32)
    x = torch.randn(4, 3, 32, 32)
    
    # å‰å‘ä¼ æ’­
    output = model(x)
    print(f"è¾“å‡ºå½¢çŠ¶: {output.shape}")  # [4, 10]
    
    # è®¡ç®—å‚æ•°é‡
    total_params = sum(p.numel() for p in model.parameters())
    print(f"æ€»å‚æ•°é‡: {total_params:,}")</code></pre>
                </div>
                <div class="code-box">
                    <h3>ä½¿ç”¨ NumPy æ‰‹åŠ¨å®ç°å·ç§¯æ“ä½œ</h3>
                    <pre><code class="language-python">import numpy as np

def conv2d(input_img, kernel, stride=1, padding=0):
    """
    æ‰‹åŠ¨å®ç°2Då·ç§¯æ“ä½œ
    
    å‚æ•°:
        input_img: è¾“å…¥å›¾åƒ (H, W) æˆ– (C, H, W)
        kernel: å·ç§¯æ ¸ (K, K) æˆ– (C, K, K)
        stride: æ­¥é•¿
        padding: å¡«å……
    """
    # å¤„ç†è¾“å…¥ç»´åº¦
    if input_img.ndim == 2:
        input_img = input_img[np.newaxis, :, :]
    
    if kernel.ndim == 2:
        kernel = kernel[np.newaxis, :, :]
    
    C, H, W = input_img.shape
    K = kernel.shape[-1]
    
    # æ·»åŠ padding
    if padding > 0:
        input_img = np.pad(input_img, ((0, 0), (padding, padding), (padding, padding)), mode='constant')
    
    # è®¡ç®—è¾“å‡ºå°ºå¯¸
    out_h = (H + 2 * padding - K) // stride + 1
    out_w = (W + 2 * padding - K) // stride + 1
    
    # åˆå§‹åŒ–è¾“å‡º
    output = np.zeros((C, out_h, out_w))
    
    # æ‰§è¡Œå·ç§¯
    for c in range(C):
        for i in range(0, out_h):
            for j in range(0, out_w):
                h_start = i * stride
                h_end = h_start + K
                w_start = j * stride
                w_end = w_start + K
                
                output[c, i, j] = np.sum(
                    input_img[c, h_start:h_end, w_start:w_end] * kernel[c]
                )
    
    return output.squeeze() if output.shape[0] == 1 else output

def max_pooling(input_img, pool_size=2, stride=2):
    """æœ€å¤§æ± åŒ–æ“ä½œ"""
    if input_img.ndim == 2:
        input_img = input_img[np.newaxis, :, :]
    
    C, H, W = input_img.shape
    out_h = (H - pool_size) // stride + 1
    out_w = (W - pool_size) // stride + 1
    
    output = np.zeros((C, out_h, out_w))
    
    for c in range(C):
        for i in range(out_h):
            for j in range(out_w):
                h_start = i * stride
                h_end = h_start + pool_size
                w_start = j * stride
                w_end = w_start + pool_size
                
                output[c, i, j] = np.max(
                    input_img[c, h_start:h_end, w_start:w_end]
                )
    
    return output.squeeze() if output.shape[0] == 1 else output

# ä½¿ç”¨ç¤ºä¾‹
if __name__ == "__main__":
    # åˆ›å»ºæµ‹è¯•å›¾åƒ (3é€šé“, 8x8)
    img = np.random.randn(3, 8, 8)
    
    # åˆ›å»ºå·ç§¯æ ¸ (3x3)
    kernel = np.ones((3, 3, 3)) * 0.1
    
    # æ‰§è¡Œå·ç§¯
    conv_output = conv2d(img, kernel, stride=1, padding=1)
    print(f"å·ç§¯è¾“å‡ºå½¢çŠ¶: {conv_output.shape}")
    
    # æ‰§è¡Œæ± åŒ–
    pooled_output = max_pooling(conv_output, pool_size=2, stride=2)
    print(f"æ± åŒ–è¾“å‡ºå½¢çŠ¶: {pooled_output.shape}")</code></pre>
                </div>
            </div>
        </div>
    </div>
    <!-- å›¾ç‰‡æ”¾å¤§å¼¹çª— -->
    <div id="imageModal" class="image-modal" onclick="closeImageModal()">
        <span class="image-modal-close" onclick="event.stopPropagation(); closeImageModal()">&times;</span>
        <img id="modalImage" class="image-modal-content" src="" alt="">
        <div id="modalCaption" class="image-modal-caption"></div>
    </div>
    <script>
        function openImageModal(img) {
            const modal = document.getElementById('imageModal');
            const modalImg = document.getElementById('modalImage');
            const modalCaption = document.getElementById('modalCaption');
            modal.classList.add('active');
            modalImg.src = img.src;
            modalCaption.textContent = img.alt || '';
            modalImg.onclick = function(e) { e.stopPropagation(); };
        }
        function closeImageModal() {
            document.getElementById('imageModal').classList.remove('active');
        }
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') closeImageModal();
        });
    </script>
    <!-- å…¬å…±è„šæœ¬ -->
    <script src="../common/tech-document.js"></script>
</body>
</html>

