<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YOLO (You Only Look Once) å•é˜¶æ®µç›®æ ‡æ£€æµ‹ - æ¶æ„è¯¦è§£</title>
    <!-- MathJax for mathematical formulas -->
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']],
                processEscapes: true,
                processEnvironments: true
            },
            options: {
                skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
            }
        };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <!-- Prism.js for code highlighting -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    
    <!-- å…¬å…±æ ·å¼ -->
    <link rel="stylesheet" href="../common/styles.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>YOLO (You Only Look Once) å•é˜¶æ®µç›®æ ‡æ£€æµ‹</h1>
            <p>å®æ—¶ç›®æ ‡æ£€æµ‹ç®—æ³•</p>
        </div>
        <div class="content">
            
            <div class="section">
                <h2>ğŸ“– æ ¸å¿ƒæ¦‚å¿µ</h2>
                <div class="desc-box">
                    <p>å°†ç›®æ ‡æ£€æµ‹è§†ä¸ºå›å½’é—®é¢˜ï¼Œåªéœ€ä¸€æ¬¡å‰å‘ä¼ æ’­å³å¯åŒæ—¶é¢„æµ‹æ‰€æœ‰è¾¹ç•Œæ¡†çš„ä½ç½®å’Œç±»åˆ«ã€‚ç›¸æ¯”ä¸¤é˜¶æ®µæ£€æµ‹å™¨ï¼ˆå¦‚Faster R-CNNï¼‰ï¼Œé€Ÿåº¦æå¿«ï¼Œé€‚åˆå®æ—¶åº”ç”¨ã€‚</p>
                </div>
            </div>
            <div class="section features">
                <h2>ğŸŒŸ æ ¸å¿ƒç‰¹ç‚¹</h2>
                <ul>
                    <li>å•é˜¶æ®µæ£€æµ‹ï¼šä¸€æ¬¡å‰å‘ä¼ æ’­å®Œæˆæ£€æµ‹ï¼Œæ— éœ€Region Proposal</li>
                    <li>é€Ÿåº¦æå¿«ï¼šYOLOv5å¯è¾¾140+ FPSï¼Œé€‚åˆå®æ—¶åœºæ™¯</li>
                    <li>ç«¯åˆ°ç«¯è®­ç»ƒï¼šç›´æ¥ä¼˜åŒ–æ£€æµ‹æŸå¤±ï¼Œæ— éœ€å¤šé˜¶æ®µè®­ç»ƒ</li>
                    <li>å…¨å±€ä¿¡æ¯ï¼šçœ‹åˆ°æ•´å¼ å›¾åƒï¼ŒèƒŒæ™¯è¯¯æ£€ç‡ä½</li>
                    <li>ç‰ˆæœ¬è¿­ä»£ï¼šä»v1åˆ°v8/v9ï¼ŒæŒç»­ä¼˜åŒ–ç²¾åº¦å’Œé€Ÿåº¦</li>
                </ul>
            </div>
            <div class="section">
                <h2>âš™ï¸ å…³é”®æŠ€æœ¯</h2>
                <div class="tech-box"><p><strong>Anchor Boxã€éæå¤§å€¼æŠ‘åˆ¶ï¼ˆNMSï¼‰ã€å¤šå°ºåº¦é¢„æµ‹ã€æŸå¤±å‡½æ•°ï¼ˆIoU Lossï¼‰</strong></p></div>
            </div>
            <div class="section">
                <h2>ğŸš€ åº”ç”¨åœºæ™¯</h2>
                <div class="app-box"><p>å®æ—¶ç›®æ ‡æ£€æµ‹ã€è‡ªåŠ¨é©¾é©¶ã€æ™ºèƒ½ç›‘æ§ã€æ— äººæœºè§†è§‰ã€å·¥ä¸šè´¨æ£€</p></div>
            </div>
            <div class="section">
                <h2>ğŸ“Š æ¶æ„å›¾è§£</h2>
                <div class="diagram-gallery">
                    <div class="diagram-item"><img src="YOLOæ¶æ„å›¾.png" alt="YOLOæ¶æ„å›¾" onclick="openImageModal(this)" onerror="this.parentElement.style.display='none'"><div class="caption">YOLOæ¶æ„å›¾</div></div>
                    <div class="diagram-item"><img src="YOLOæ£€æµ‹æµç¨‹.png" alt="YOLOæ£€æµ‹æµç¨‹" onclick="openImageModal(this)" onerror="this.parentElement.style.display='none'"><div class="caption">YOLOæ£€æµ‹æµç¨‹</div></div>
                    <div class="diagram-item"><img src="YOLOç‰ˆæœ¬æ¼”è¿›.png" alt="YOLOç‰ˆæœ¬æ¼”è¿›" onclick="openImageModal(this)" onerror="this.parentElement.style.display='none'"><div class="caption">YOLOç‰ˆæœ¬æ¼”è¿›</div></div>
                    <div class="diagram-item"><img src="IoUè®¡ç®—.png" alt="IoUè®¡ç®—" onclick="openImageModal(this)" onerror="this.parentElement.style.display='none'"><div class="caption">IoUè®¡ç®—</div></div>
                </div>
            </div>

            <div class="section">
                <h2>ğŸ“ æ•°å­¦åŸç†</h2>
                <div class="math-box">
                    <h3>IoU (Intersection over Union)</h3>
                    <div class="math-formula">
                        <p>IoUç”¨äºè¡¡é‡é¢„æµ‹æ¡†å’ŒçœŸå®æ¡†çš„é‡å ç¨‹åº¦ï¼š</p>
                        <p>$$\text{IoU} = \frac{\text{Area of Intersection}}{\text{Area of Union}} = \frac{A \cap B}{A \cup B}$$</p>
                        <p>IoUå€¼èŒƒå›´åœ¨ $[0, 1]$ï¼Œå€¼è¶Šå¤§è¡¨ç¤ºé‡å åº¦è¶Šé«˜</p>
                    </div>
                </div>
                <div class="math-box">
                    <h3>YOLO æŸå¤±å‡½æ•°</h3>
                    <div class="math-formula">
                        <p>YOLOçš„æŸå¤±å‡½æ•°åŒ…å«å¤šä¸ªéƒ¨åˆ†ï¼š</p>
                        <p>$$L = \lambda_{coord} \sum_{i=0}^{S^2} \sum_{j=0}^{B} \mathbb{1}_{ij}^{obj} [(x_i - \hat{x}_i)^2 + (y_i - \hat{y}_i)^2]$$</p>
                        <p>$$+ \lambda_{coord} \sum_{i=0}^{S^2} \sum_{j=0}^{B} \mathbb{1}_{ij}^{obj} [(\sqrt{w_i} - \sqrt{\hat{w}_i})^2 + (\sqrt{h_i} - \sqrt{\hat{h}_i})^2]$$</p>
                        <p>$$+ \sum_{i=0}^{S^2} \sum_{j=0}^{B} \mathbb{1}_{ij}^{obj} (C_i - \hat{C}_i)^2 + \lambda_{noobj} \sum_{i=0}^{S^2} \sum_{j=0}^{B} \mathbb{1}_{ij}^{noobj} (C_i - \hat{C}_i)^2$$</p>
                        <p>$$+ \sum_{i=0}^{S^2} \mathbb{1}_{i}^{obj} \sum_{c \in classes} (p_i(c) - \hat{p}_i(c))^2$$</p>
                        <p>å…¶ä¸­ $S$ æ˜¯ç½‘æ ¼å¤§å°ï¼Œ$B$ æ˜¯æ¯ä¸ªç½‘æ ¼çš„è¾¹ç•Œæ¡†æ•°é‡</p>
                    </div>
                </div>
                <div class="math-box">
                    <h3>è¾¹ç•Œæ¡†åæ ‡è½¬æ¢</h3>
                    <div class="math-formula">
                        <p>ä»ç›¸å¯¹åæ ‡è½¬æ¢ä¸ºç»å¯¹åæ ‡ï¼š</p>
                        <p>$$b_x = \sigma(t_x) + c_x$$</p>
                        <p>$$b_y = \sigma(t_y) + c_y$$</p>
                        <p>$$b_w = p_w e^{t_w}$$</p>
                        <p>$$b_h = p_h e^{t_h}$$</p>
                        <p>å…¶ä¸­ $(c_x, c_y)$ æ˜¯ç½‘æ ¼å·¦ä¸Šè§’åæ ‡ï¼Œ$(p_w, p_h)$ æ˜¯anchorå°ºå¯¸</p>
                    </div>
                </div>
            </div>

            <div class="section">
                <h2>ğŸ’» Python ä»£ç ç¤ºä¾‹</h2>
                <div class="code-box">
                    <h3>ä½¿ç”¨ PyTorch å®ç° YOLO æ ¸å¿ƒç»„ä»¶</h3>
                    <pre><code class="language-python">import torch
import torch.nn as nn
import torch.nn.functional as F
import numpy as np

def calculate_iou(box1, box2):
    """è®¡ç®—ä¸¤ä¸ªè¾¹ç•Œæ¡†çš„IoU"""
    # boxæ ¼å¼: [x1, y1, x2, y2]
    x1 = max(box1[0], box2[0])
    y1 = max(box1[1], box2[1])
    x2 = min(box1[2], box2[2])
    y2 = min(box1[3], box2[3])
    
    if x2 < x1 or y2 < y1:
        return 0.0
    
    intersection = (x2 - x1) * (y2 - y1)
    area1 = (box1[2] - box1[0]) * (box1[3] - box1[1])
    area2 = (box2[2] - box2[0]) * (box2[3] - box2[1])
    union = area1 + area2 - intersection
    
    return intersection / union if union > 0 else 0.0

def non_max_suppression(boxes, scores, iou_threshold=0.5):
    """éæå¤§å€¼æŠ‘åˆ¶ï¼ˆNMSï¼‰"""
    if len(boxes) == 0:
        return []
    
    # æŒ‰åˆ†æ•°æ’åº
    indices = np.argsort(scores)[::-1]
    keep = []
    
    while len(indices) > 0:
        current = indices[0]
        keep.append(current)
        
        if len(indices) == 1:
            break
        
        # è®¡ç®—å½“å‰æ¡†ä¸å…¶ä»–æ¡†çš„IoU
        current_box = boxes[current]
        other_boxes = boxes[indices[1:]]
        
        ious = [calculate_iou(current_box, box) for box in other_boxes]
        
        # ç§»é™¤IoUå¤§äºé˜ˆå€¼çš„æ¡†
        indices = indices[1:][np.array(ious) < iou_threshold]
    
    return keep

class YOLOLoss(nn.Module):
    """YOLOæŸå¤±å‡½æ•°"""
    def __init__(self, S=7, B=2, C=20, lambda_coord=5.0, lambda_noobj=0.5):
        super(YOLOLoss, self).__init__()
        self.S = S  # ç½‘æ ¼å¤§å°
        self.B = B  # æ¯ä¸ªç½‘æ ¼çš„è¾¹ç•Œæ¡†æ•°é‡
        self.C = C  # ç±»åˆ«æ•°
        self.lambda_coord = lambda_coord
        self.lambda_noobj = lambda_noobj
    
    def forward(self, predictions, targets):
        """
        predictions: [batch_size, S*S*(B*5+C)]
        targets: [batch_size, S, S, B*5+C]
        """
        batch_size = predictions.size(0)
        predictions = predictions.view(batch_size, self.S, self.S, self.B * 5 + self.C)
        
        # åˆ†ç¦»é¢„æµ‹å€¼
        pred_boxes = predictions[..., :self.B * 5].view(batch_size, self.S, self.S, self.B, 5)
        pred_classes = predictions[..., self.B * 5:]
        
        # åˆ†ç¦»ç›®æ ‡å€¼
        target_boxes = targets[..., :self.B * 5].view(batch_size, self.S, self.S, self.B, 5)
        target_classes = targets[..., self.B * 5:]
        
        # è®¡ç®—åæ ‡æŸå¤±
        coord_mask = target_boxes[..., 4:5] > 0  # æœ‰ç›®æ ‡çš„æ¡†
        coord_loss = self.lambda_coord * torch.sum(
            coord_mask * ((pred_boxes[..., :2] - target_boxes[..., :2]) ** 2 +
                         (torch.sqrt(pred_boxes[..., 2:4]) - torch.sqrt(target_boxes[..., 2:4])) ** 2)
        )
        
        # è®¡ç®—ç½®ä¿¡åº¦æŸå¤±
        obj_mask = target_boxes[..., 4:5] > 0
        noobj_mask = target_boxes[..., 4:5] == 0
        
        obj_loss = torch.sum(obj_mask * (pred_boxes[..., 4:5] - target_boxes[..., 4:5]) ** 2)
        noobj_loss = self.lambda_noobj * torch.sum(
            noobj_mask * (pred_boxes[..., 4:5] - target_boxes[..., 4:5]) ** 2
        )
        
        # è®¡ç®—ç±»åˆ«æŸå¤±
        class_loss = torch.sum(
            obj_mask.squeeze(-1) * (pred_classes - target_classes) ** 2
        )
        
        total_loss = coord_loss + obj_loss + noobj_loss + class_loss
        return total_loss / batch_size

# ä½¿ç”¨ç¤ºä¾‹
if __name__ == "__main__":
    # æµ‹è¯•IoUè®¡ç®—
    box1 = [10, 10, 50, 50]
    box2 = [30, 30, 70, 70]
    iou = calculate_iou(box1, box2)
    print(f"IoU: {iou:.4f}")
    
    # æµ‹è¯•YOLOæŸå¤±
    S, B, C = 7, 2, 20
    predictions = torch.randn(4, S * S * (B * 5 + C))
    targets = torch.randn(4, S, S, B * 5 + C)
    
    criterion = YOLOLoss(S, B, C)
    loss = criterion(predictions, targets)
    print(f"YOLO Loss: {loss.item():.4f}")</code></pre>
                </div>
            </div>
        </div>
    </div>
    <!-- å›¾ç‰‡æ”¾å¤§å¼¹çª— -->
    <div id="imageModal" class="image-modal" onclick="closeImageModal()">
        <span class="image-modal-close" onclick="event.stopPropagation(); closeImageModal()">&times;</span>
        <img id="modalImage" class="image-modal-content" src="" alt="">
        <div id="modalCaption" class="image-modal-caption"></div>
    </div>
    <script>
        function openImageModal(img) {
            const modal = document.getElementById('imageModal');
            const modalImg = document.getElementById('modalImage');
            const modalCaption = document.getElementById('modalCaption');
            modal.classList.add('active');
            modalImg.src = img.src;
            modalCaption.textContent = img.alt || '';
            modalImg.onclick = function(e) { e.stopPropagation(); };
        }
        function closeImageModal() {
            document.getElementById('imageModal').classList.remove('active');
        }
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') closeImageModal();
        });
    </script>
    <!-- å…¬å…±è„šæœ¬ -->
    <script src="../common/tech-document.js"></script>
</body>
</html>

