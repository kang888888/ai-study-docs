<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VAE (Variational Autoencoder) å˜åˆ†è‡ªç¼–ç å™¨ - æ¶æ„è¯¦è§£</title>
    <!-- MathJax for mathematical formulas -->
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']],
                processEscapes: true,
                processEnvironments: true
            },
            options: {
                skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
            }
        };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <!-- Prism.js for code highlighting -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    
    <!-- å…¬å…±æ ·å¼ -->
    <link rel="stylesheet" href="../common/styles.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>VAE (Variational Autoencoder) å˜åˆ†è‡ªç¼–ç å™¨</h1>
            <p>åŸºäºå˜åˆ†æ¨ç†çš„ç”Ÿæˆæ¨¡å‹</p>
        </div>
        <div class="content">
            
            <div class="section">
                <h2>ğŸ“– æ ¸å¿ƒæ¦‚å¿µ</h2>
                <div class="desc-box">
                    <p>åŸºäºå˜åˆ†æ¨ç†çš„ç”Ÿæˆæ¨¡å‹ï¼Œå­¦ä¹ æ•°æ®çš„æ½œåœ¨è¡¨ç¤ºï¼ˆLatent Representationï¼‰ã€‚é€šè¿‡ç¼–ç å™¨å°†æ•°æ®æ˜ å°„åˆ°æ½œåœ¨ç©ºé—´çš„æ¦‚ç‡åˆ†å¸ƒï¼Œè§£ç å™¨ä»åˆ†å¸ƒä¸­é‡‡æ ·ç”Ÿæˆæ•°æ®ã€‚</p>
                </div>
            </div>
            <div class="section features">
                <h2>ğŸŒŸ æ ¸å¿ƒç‰¹ç‚¹</h2>
                <ul>
                    <li>æ¦‚ç‡ç”Ÿæˆï¼šå­¦ä¹ æ½œåœ¨ç©ºé—´çš„æ¦‚ç‡åˆ†å¸ƒï¼Œè€Œéç¡®å®šæ€§æ˜ å°„</li>
                    <li>ç¼–ç -è§£ç ï¼šEncoderå‹ç¼©æ•°æ®ï¼ŒDecoderé‡æ„æ•°æ®</li>
                    <li>KLæ•£åº¦çº¦æŸï¼šæ­£åˆ™åŒ–æ½œåœ¨ç©ºé—´ï¼Œä½¿å…¶æ¥è¿‘æ ‡å‡†æ­£æ€åˆ†å¸ƒ</li>
                    <li>è¿ç»­æ½œåœ¨ç©ºé—´ï¼šæ”¯æŒå¹³æ»‘æ’å€¼å’Œè¯­ä¹‰æ“ä½œ</li>
                    <li>ç†è®ºå®Œå¤‡ï¼šæœ‰ä¸¥æ ¼çš„æ•°å­¦æ¨å¯¼ï¼ˆå˜åˆ†ä¸‹ç•ŒELBOï¼‰</li>
                </ul>
            </div>
            <div class="section">
                <h2>âš™ï¸ å…³é”®æŠ€æœ¯</h2>
                <div class="tech-box"><p><strong>é‡å‚æ•°åŒ–æŠ€å·§ï¼ˆReparameterization Trickï¼‰ã€ELBOæŸå¤±ã€KLæ•£åº¦</strong></p></div>
            </div>
            <div class="section">
                <h2>ğŸš€ åº”ç”¨åœºæ™¯</h2>
                <div class="app-box"><p>å›¾åƒç”Ÿæˆã€æ•°æ®å‹ç¼©ã€å¼‚å¸¸æ£€æµ‹ã€è¡¨ç¤ºå­¦ä¹ ã€Stable Diffusionçš„VAEç¼–ç å™¨</p></div>
            </div>
            <div class="section">
                <h2>ğŸ“Š æ¶æ„å›¾è§£</h2>
                <div class="diagram-gallery">
                    <div class="diagram-item"><img src="VAEæ¶æ„å›¾.png" alt="VAEæ¶æ„å›¾" onclick="openImageModal(this)" onerror="this.parentElement.style.display='none'"><div class="caption">VAEæ¶æ„å›¾</div></div>
                    <div class="diagram-item"><img src="VAEæ½œåœ¨ç©ºé—´.png" alt="VAEæ½œåœ¨ç©ºé—´" onclick="openImageModal(this)" onerror="this.parentElement.style.display='none'"><div class="caption">VAEæ½œåœ¨ç©ºé—´</div></div>
                    <div class="diagram-item"><img src="VAEè®­ç»ƒè¿‡ç¨‹.png" alt="VAEè®­ç»ƒè¿‡ç¨‹" onclick="openImageModal(this)" onerror="this.parentElement.style.display='none'"><div class="caption">VAEè®­ç»ƒè¿‡ç¨‹</div></div>
                </div>
            </div>

            <div class="section">
                <h2>ğŸ“ æ•°å­¦åŸç†</h2>
                <div class="math-box">
                    <h3>å˜åˆ†ä¸‹ç•Œï¼ˆELBOï¼‰</h3>
                    <div class="math-formula">
                        <p>VAE çš„ä¼˜åŒ–ç›®æ ‡æ˜¯æœ€å¤§åŒ–è¯æ®ä¸‹ç•Œï¼ˆELBOï¼‰ï¼š</p>
                        <p>$$\log p(x) \geq \mathbb{E}_{z \sim q_\phi(z|x)}[\log p_\theta(x|z)] - D_{KL}(q_\phi(z|x) || p(z))$$</p>
                        <p>å…¶ä¸­ï¼š</p>
                        <ul style="list-style: none; padding-left: 20px;">
                            <li>$q_\phi(z|x)$ æ˜¯ç¼–ç å™¨ï¼ˆåéªŒåˆ†å¸ƒï¼‰</li>
                            <li>$p_\theta(x|z)$ æ˜¯è§£ç å™¨ï¼ˆä¼¼ç„¶ï¼‰</li>
                            <li>$p(z)$ æ˜¯å…ˆéªŒåˆ†å¸ƒï¼ˆé€šå¸¸ä¸ºæ ‡å‡†æ­£æ€åˆ†å¸ƒï¼‰</li>
                            <li>$D_{KL}$ æ˜¯KLæ•£åº¦</li>
                        </ul>
                    </div>
                </div>
                <div class="math-box">
                    <h3>é‡å‚æ•°åŒ–æŠ€å·§</h3>
                    <div class="math-formula">
                        <p>ä¸ºäº†å¯å¾®ï¼Œä½¿ç”¨é‡å‚æ•°åŒ–ï¼š</p>
                        <p>$$z = \mu + \sigma \odot \epsilon, \quad \epsilon \sim \mathcal{N}(0, I)$$</p>
                        <p>å…¶ä¸­ $\mu$ å’Œ $\sigma$ æ˜¯ç¼–ç å™¨è¾“å‡ºçš„å‡å€¼å’Œæ ‡å‡†å·®</p>
                    </div>
                </div>
                <div class="math-box">
                    <h3>KLæ•£åº¦</h3>
                    <div class="math-formula">
                        <p>KLæ•£åº¦é¡¹ï¼ˆå‡è®¾å…ˆéªŒä¸ºæ ‡å‡†æ­£æ€åˆ†å¸ƒï¼‰ï¼š</p>
                        <p>$$D_{KL}(q_\phi(z|x) || \mathcal{N}(0, I)) = -\frac{1}{2}\sum_{i=1}^{d}(1 + \log(\sigma_i^2) - \mu_i^2 - \sigma_i^2)$$</p>
                        <p>å…¶ä¸­ $d$ æ˜¯æ½œåœ¨ç©ºé—´çš„ç»´åº¦</p>
                    </div>
                </div>
            </div>

            <div class="section">
                <h2>ğŸ’» Python ä»£ç ç¤ºä¾‹</h2>
                <div class="code-box">
                    <h3>ä½¿ç”¨ PyTorch å®ç° VAE</h3>
                    <pre><code class="language-python">import torch
import torch.nn as nn
import torch.nn.functional as F

class VAE(nn.Module):
    """å˜åˆ†è‡ªç¼–ç å™¨"""
    def __init__(self, input_dim, hidden_dim, latent_dim):
        super(VAE, self).__init__()
        
        # ç¼–ç å™¨
        self.encoder = nn.Sequential(
            nn.Linear(input_dim, hidden_dim),
            nn.ReLU(),
            nn.Linear(hidden_dim, hidden_dim),
            nn.ReLU()
        )
        
        # å‡å€¼å’Œæ–¹å·®
        self.fc_mu = nn.Linear(hidden_dim, latent_dim)
        self.fc_logvar = nn.Linear(hidden_dim, latent_dim)
        
        # è§£ç å™¨
        self.decoder = nn.Sequential(
            nn.Linear(latent_dim, hidden_dim),
            nn.ReLU(),
            nn.Linear(hidden_dim, hidden_dim),
            nn.ReLU(),
            nn.Linear(hidden_dim, input_dim),
            nn.Sigmoid()
        )
    
    def encode(self, x):
        """ç¼–ç """
        h = self.encoder(x)
        mu = self.fc_mu(h)
        logvar = self.fc_logvar(h)
        return mu, logvar
    
    def reparameterize(self, mu, logvar):
        """é‡å‚æ•°åŒ–"""
        std = torch.exp(0.5 * logvar)
        eps = torch.randn_like(std)
        return mu + eps * std
    
    def decode(self, z):
        """è§£ç """
        return self.decoder(z)
    
    def forward(self, x):
        mu, logvar = self.encode(x)
        z = self.reparameterize(mu, logvar)
        recon_x = self.decode(z)
        return recon_x, mu, logvar

def vae_loss(recon_x, x, mu, logvar, beta=1.0):
    """VAEæŸå¤±å‡½æ•°"""
    # é‡æ„æŸå¤±
    recon_loss = F.binary_cross_entropy(recon_x, x, reduction='sum')
    
    # KLæ•£åº¦æŸå¤±
    kl_loss = -0.5 * torch.sum(1 + logvar - mu.pow(2) - logvar.exp())
    
    return recon_loss + beta * kl_loss, recon_loss, kl_loss

# ä½¿ç”¨ç¤ºä¾‹
if __name__ == "__main__":
    input_dim = 784  # MNISTå›¾åƒå±•å¹³
    hidden_dim = 400
    latent_dim = 20
    
    model = VAE(input_dim, hidden_dim, latent_dim)
    
    # æ¨¡æ‹Ÿè¾“å…¥
    x = torch.randn(32, input_dim)
    
    # å‰å‘ä¼ æ’­
    recon_x, mu, logvar = model(x)
    
    # è®¡ç®—æŸå¤±
    loss, recon_loss, kl_loss = vae_loss(recon_x, x, mu, logvar)
    
    print(f"æ€»æŸå¤±: {loss.item():.4f}")
    print(f"é‡æ„æŸå¤±: {recon_loss.item():.4f}")
    print(f"KLæŸå¤±: {kl_loss.item():.4f}")</code></pre>
                </div>
            </div>
        </div>
    </div>
    <!-- å›¾ç‰‡æ”¾å¤§å¼¹çª— -->
    <div id="imageModal" class="image-modal" onclick="closeImageModal()">
        <span class="image-modal-close" onclick="event.stopPropagation(); closeImageModal()">&times;</span>
        <img id="modalImage" class="image-modal-content" src="" alt="">
        <div id="modalCaption" class="image-modal-caption"></div>
    </div>
    <script>
        function openImageModal(img) {
            const modal = document.getElementById('imageModal');
            const modalImg = document.getElementById('modalImage');
            const modalCaption = document.getElementById('modalCaption');
            modal.classList.add('active');
            modalImg.src = img.src;
            modalCaption.textContent = img.alt || '';
            modalImg.onclick = function(e) { e.stopPropagation(); };
        }
        function closeImageModal() {
            document.getElementById('imageModal').classList.remove('active');
        }
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') closeImageModal();
        });
    </script>
    <!-- å…¬å…±è„šæœ¬ -->
    <script src="../common/tech-document.js"></script>
</body>
</html>

