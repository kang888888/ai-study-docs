<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LoRAï¼ˆLow-Rank Adaptationï¼‰- æŠ€æœ¯è¯¦è§£</title>
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']],
                processEscapes: true,
                processEnvironments: true
            },
            options: {
                skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
            }
        };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    
    <!-- å…¬å…±æ ·å¼ -->
    <link rel="stylesheet" href="../common/styles.css">
</head>
<body>
    <div class="container">
        <h1>LoRAï¼ˆLow-Rank Adaptationï¼‰ä½ç§©é€‚åº”å¾®è°ƒ</h1>
        <p class="tagline">é€šè¿‡ä½ç§©çŸ©é˜µåˆ†è§£åœ¨å†»ç»“å¤§æ¨¡å‹ä¸»å¹²çš„æƒ…å†µä¸‹æ³¨å…¥å°‘é‡å¯è®­ç»ƒå‚æ•°ï¼Œå®ç°æå…·æ€§ä»·æ¯”çš„å‚æ•°é«˜æ•ˆå¾®è°ƒã€‚</p>

        <div class="meta-grid">
            <div class="meta-card">
                <h3>æ ¸å¿ƒç›®æ ‡</h3>
                <p>åœ¨ä¿ç•™é¢„è®­ç»ƒçŸ¥è¯†çš„åŒæ—¶ï¼Œåªè®­ç»ƒç§©ä¸º r çš„ä½ç»´æ›´æ–°ï¼Œæ˜¾è‘—é™ä½æ˜¾å­˜ä¸è®¡ç®—æˆæœ¬ã€‚</p>
            </div>
            <div class="meta-card">
                <h3>å‚æ•°è§„æ¨¡</h3>
                <p>å¯è®­ç»ƒå‚æ•°å æ¯”é€šå¸¸ä½äº 1%ï¼Œé€‚åˆ 7B~70B å¤§æ¨¡å‹çš„æ¶ˆè´¹çº§æ˜¾å¡å¾®è°ƒã€‚</p>
            </div>
            <div class="meta-card">
                <h3>é€‚ç”¨åœºæ™¯</h3>
                <p>å¤šåœºæ™¯æŒ‡ä»¤å¾®è°ƒã€é¢†åŸŸé—®ç­”ã€é£æ ¼å®šåˆ¶ã€ä»£ç è‡ªåŠ¨è¡¥å…¨ç­‰ã€‚</p>
            </div>
            <div class="meta-card">
                <h3>é…å¥—å·¥å…·</h3>
                <p>PEFTã€Hugging Face Transformersã€Unslothã€Axolotlã€Lightning LoRAã€‚</p>
            </div>
        </div>

        <div class="section">
            <h2>âš™ï¸ æŠ€æœ¯è¦ç‚¹</h2>
            <ul>
                <li><strong>å†»ç»“ä¸»æƒé‡ï¼š</strong>åŸå§‹æƒé‡ $W_0$ ä¸å†æ›´æ–°ï¼Œåªåœ¨å‰å‘ä¸­å‚ä¸è®¡ç®—ï¼Œé¿å…ç¾éš¾æ€§é—å¿˜ã€‚</li>
                <li><strong>åŒå±‚ä½ç§©æ’å…¥ï¼š</strong>ä½¿ç”¨ $A \in \mathbb{R}^{d \times r}$ã€$B \in \mathbb{R}^{r \times k}$ é‡æ„æ›´æ–°çŸ©é˜µ $\Delta W = B A$ã€‚</li>
                <li><strong>å¯æ’æ‹”ç»“æ„ï¼š</strong>LoRA å±‚å¯åœ¨è®­ç»ƒåç‹¬ç«‹ä¿å­˜/åŠ è½½ï¼Œéƒ¨ç½²æ—¶æŒ‰éœ€åˆå¹¶è‡³å…¨é‡æƒé‡ã€‚</li>
                <li><strong>Rank/Alpha è°ƒå‚ï¼š</strong>å…¸å‹è®¾ç½® r=8/16ã€alpha=16/32ï¼Œæƒè¡¡è¡¨è¾¾èƒ½åŠ›ä¸èµ„æºå¼€é”€ã€‚</li>
            </ul>
        </div>

        <div class="section">
            <h2>ğŸ“Š æ¶æ„å›¾è§£</h2>
            <div class="diagram-gallery">
                <div class="diagram-item">
                    <img src="./assets/LoRAç»“æ„ç¤ºæ„.png" alt="LoRA æ’å…¥æ³¨æ„åŠ›çŸ©é˜µ" onclick="openImageModal(this)" onerror="this.parentElement.style.display='none'">
                    <div class="caption">LoRA æ’å…¥æ³¨æ„åŠ›çŸ©é˜µ</div>
                </div>
                <div class="diagram-item">
                    <img src="./assets/LoRAè®­ç»ƒæµç¨‹.png" alt="è®­ç»ƒä¸æ¨ç†æµç¨‹" onclick="openImageModal(this)" onerror="this.parentElement.style.display='none'">
                    <div class="caption">è®­ç»ƒä¸æ¨ç†æµç¨‹</div>
                </div>
                <div class="diagram-item">
                    <img src="./assets/LoRAå‚æ•°å æ¯”.png" alt="å‚æ•°æ•ˆç‡å¯¹æ¯”" onclick="openImageModal(this)" onerror="this.parentElement.style.display='none'">
                    <div class="caption">å‚æ•°æ•ˆç‡å¯¹æ¯”</div>
                </div>
            </div>
        </div>

        <div class="section">
            <h2>ğŸ“ æ•°å­¦åŸç†</h2>
            <div class="math-box">
                <h3>ä½ç§©åˆ†è§£</h3>
                <div class="math-formula">
                    <p>LoRA å°†æƒé‡æ›´æ–°è¡¨ç¤ºä¸ºï¼š</p>
                    <p>$$W = W_0 + \Delta W, \quad \Delta W = B A, \; rank(A) = rank(B) = r \ll \min(d,k)$$</p>
                    <p>è®­ç»ƒæ—¶ä»…æ›´æ–° $A,B$ï¼Œæ¨ç†é˜¶æ®µå¯å°†å…¶åˆå¹¶å› $W$ æˆ–ä»¥æ¨¡å—å½¢å¼æ³¨å…¥ã€‚</p>
                </div>
            </div>
            <div class="math-box">
                <h3>ç¼©æ”¾å› å­</h3>
                <div class="math-formula">
                    <p>ä¸ºä¿æŒæ¢¯åº¦ç¨³å®šï¼ŒLoRA å¼•å…¥ç¼©æ”¾ $\alpha/r$ï¼š</p>
                    <p>$$y = W_0 x + \frac{\alpha}{r} B A x$$</p>
                    <p>å…¶ä¸­ $\alpha$ æ§åˆ¶æ›´æ–°å¹…åº¦ï¼Œå¸¸ä¸ rank åŒé‡çº§ã€‚</p>
                </div>
            </div>
        </div>

        <div class="section">
            <h2>ğŸ’» Python ä»£ç ç¤ºä¾‹</h2>
            <div class="code-box">
                <h3>ä½¿ç”¨ PEFT æ„å»º LoRA é€‚é…å™¨</h3>
                <pre><code class="language-python">from transformers import AutoModelForCausalLM, AutoTokenizer
from peft import LoraConfig, get_peft_model

base_model = "meta-llama/Llama-2-13b-hf"
tokenizer = AutoTokenizer.from_pretrained(base_model)
model = AutoModelForCausalLM.from_pretrained(
    base_model,
    load_in_4bit=True,
    device_map="auto"
)

lora_config = LoraConfig(
    r=16,
    lora_alpha=32,
    target_modules=["q_proj", "v_proj"],
    lora_dropout=0.05,
    bias="none",
    task_type="CAUSAL_LM"
)

model = get_peft_model(model, lora_config)
model.print_trainable_parameters()

# ä¹‹åå³å¯åƒæ™®é€š SFT ä¸€æ ·ä½¿ç”¨ Trainer/Accelerate è¿›è¡Œè®­ç»ƒ
</code></pre>
            </div>
        </div>
    </div>

    <div id="imageModal" class="image-modal" onclick="closeImageModal()">
        <span class="image-modal-close" onclick="event.stopPropagation(); closeImageModal();">&times;</span>
        <img id="modalImage" class="image-modal-content" src="" alt="">
        <div id="modalCaption" class="image-modal-caption"></div>
    </div>

    <script>
        function openImageModal(img) {
            const modal = document.getElementById('imageModal');
            const modalImg = document.getElementById('modalImage');
            const modalCaption = document.getElementById('modalCaption');
            modal.classList.add('active');
            modalImg.src = img.src;
            modalCaption.textContent = img.alt || '';
        }
        function closeImageModal() {
            document.getElementById('imageModal').classList.remove('active');
        }
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') closeImageModal();
        });
    </script>
    <!-- å…¬å…±è„šæœ¬ -->
    <script src="../common/tech-document.js"></script>
</body>
</html>
