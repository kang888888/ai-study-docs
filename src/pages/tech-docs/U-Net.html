<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>U-Net - æ¶æ„è¯¦è§£</title>
    <!-- MathJax for mathematical formulas -->
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']],
                processEscapes: true,
                processEnvironments: true
            },
            options: {
                skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
            }
        };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <!-- Prism.js for code highlighting -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    
    <!-- å…¬å…±æ ·å¼ -->
    <link rel="stylesheet" href="../common/styles.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>U-Net</h1>
            <p>ä¸“ä¸ºå›¾åƒåˆ†å‰²è®¾è®¡çš„ç¼–ç å™¨-è§£ç å™¨æ¶æ„</p>
        </div>
        <div class="content">
            
            <div class="section">
                <h2>ğŸ“– æ ¸å¿ƒæ¦‚å¿µ</h2>
                <div class="desc-box">
                    <p>ä¸“ä¸ºåŒ»å­¦å›¾åƒåˆ†å‰²è®¾è®¡çš„ç¼–ç å™¨-è§£ç å™¨æ¶æ„ã€‚é€šè¿‡å¯¹ç§°çš„Uå‹ç»“æ„å’Œè·³è·ƒè¿æ¥ï¼ˆSkip Connectionï¼‰ï¼Œå°†ç¼–ç å™¨çš„é«˜åˆ†è¾¨ç‡ç‰¹å¾ç›´æ¥ä¼ é€’ç»™è§£ç å™¨ï¼Œä¿ç•™ç»†èŠ‚ä¿¡æ¯ã€‚</p>
                </div>
            </div>
            <div class="section features">
                <h2>ğŸŒŸ æ ¸å¿ƒç‰¹ç‚¹</h2>
                <ul>
                    <li>Uå‹å¯¹ç§°ç»“æ„ï¼šç¼–ç å™¨ä¸‹é‡‡æ ·ï¼Œè§£ç å™¨ä¸Šé‡‡æ ·</li>
                    <li>è·³è·ƒè¿æ¥ï¼šå°†ç¼–ç å™¨ç‰¹å¾æ‹¼æ¥åˆ°è§£ç å™¨ï¼Œä¿ç•™ç©ºé—´ç»†èŠ‚</li>
                    <li>å°‘æ ·æœ¬é«˜æ•ˆï¼šåœ¨å°æ•°æ®é›†ä¸Šä¹Ÿèƒ½è®­ç»ƒå‡ºå¥½æ•ˆæœ</li>
                    <li>åƒç´ çº§é¢„æµ‹ï¼šè¾“å‡ºä¸è¾“å…¥åŒå°ºå¯¸çš„åˆ†å‰²å›¾</li>
                    <li>å¹¿æ³›åº”ç”¨ï¼šæˆä¸ºå›¾åƒåˆ†å‰²çš„æ ‡å‡†æ¶æ„</li>
                </ul>
            </div>
            <div class="section">
                <h2>âš™ï¸ å…³é”®æŠ€æœ¯</h2>
                <div class="tech-box"><p><strong>ç¼–ç å™¨-è§£ç å™¨ã€è·³è·ƒè¿æ¥ï¼ˆConcatenationï¼‰ã€ä¸Šé‡‡æ ·ï¼ˆTransposed Convolutionï¼‰</strong></p></div>
            </div>
            <div class="section">
                <h2>ğŸš€ åº”ç”¨åœºæ™¯</h2>
                <div class="app-box"><p>åŒ»å­¦å½±åƒåˆ†å‰²ã€è¯­ä¹‰åˆ†å‰²ã€å®ä¾‹åˆ†å‰²ã€Diffusionæ¨¡å‹çš„å»å™ªç½‘ç»œ</p></div>
            </div>
            <div class="section">
                <h2>ğŸ“Š æ¶æ„å›¾è§£</h2>
                <div class="diagram-gallery">
                    <div class="diagram-item"><img src="U-Netæ¶æ„å›¾.png" alt="U-Netæ¶æ„å›¾" onclick="openImageModal(this)" onerror="this.parentElement.style.display='none'"><div class="caption">U-Netæ¶æ„å›¾</div></div>
                    <div class="diagram-item"><img src="U-Netè·³è·ƒè¿æ¥.png" alt="U-Netè·³è·ƒè¿æ¥" onclick="openImageModal(this)" onerror="this.parentElement.style.display='none'"><div class="caption">U-Netè·³è·ƒè¿æ¥</div></div>
                </div>
            </div>

            <div class="section">
                <h2>ğŸ“ æ•°å­¦åŸç†</h2>
                <div class="math-box">
                    <h3>ç¼–ç å™¨-è§£ç å™¨ç»“æ„</h3>
                    <div class="math-formula">
                        <p>ç¼–ç å™¨ï¼ˆä¸‹é‡‡æ ·ï¼‰ï¼š</p>
                        <p>$$f_i = \text{MaxPool}(\text{ReLU}(\text{Conv}(f_{i-1})))$$</p>
                        <p>è§£ç å™¨ï¼ˆä¸Šé‡‡æ ·ï¼‰ï¼š</p>
                        <p>$$g_i = \text{ReLU}(\text{Conv}(\text{Concat}(\text{Upsample}(g_{i-1}), f_{n-i})))$$</p>
                        <p>å…¶ä¸­ $f_{n-i}$ æ˜¯ç¼–ç å™¨å¯¹åº”å±‚çš„ç‰¹å¾ï¼Œé€šè¿‡è·³è·ƒè¿æ¥ä¼ é€’</p>
                    </div>
                </div>
                <div class="math-box">
                    <h3>è·³è·ƒè¿æ¥</h3>
                    <div class="math-formula">
                        <p>å°†ç¼–ç å™¨ç‰¹å¾ä¸è§£ç å™¨ç‰¹å¾æ‹¼æ¥ï¼š</p>
                        <p>$$g_i = \text{Concat}(\text{Upsample}(g_{i-1}), f_{n-i})$$</p>
                        <p>è¿™æ ·å¯ä»¥ä¿ç•™é«˜åˆ†è¾¨ç‡çš„ç©ºé—´ä¿¡æ¯ï¼Œæé«˜åˆ†å‰²ç²¾åº¦</p>
                    </div>
                </div>
            </div>

            <div class="section">
                <h2>ğŸ’» Python ä»£ç ç¤ºä¾‹</h2>
                <div class="code-box">
                    <h3>ä½¿ç”¨ PyTorch å®ç° U-Net</h3>
                    <pre><code class="language-python">import torch
import torch.nn as nn
import torch.nn.functional as F

class DoubleConv(nn.Module):
    """åŒå·ç§¯å—"""
    def __init__(self, in_channels, out_channels):
        super(DoubleConv, self).__init__()
        self.conv = nn.Sequential(
            nn.Conv2d(in_channels, out_channels, 3, padding=1),
            nn.BatchNorm2d(out_channels),
            nn.ReLU(inplace=True),
            nn.Conv2d(out_channels, out_channels, 3, padding=1),
            nn.BatchNorm2d(out_channels),
            nn.ReLU(inplace=True)
        )
    
    def forward(self, x):
        return self.conv(x)

class UNet(nn.Module):
    """U-Net æ¨¡å‹"""
    def __init__(self, in_channels=3, num_classes=1):
        super(UNet, self).__init__()
        
        # ç¼–ç å™¨ï¼ˆä¸‹é‡‡æ ·è·¯å¾„ï¼‰
        self.enc1 = DoubleConv(in_channels, 64)
        self.enc2 = DoubleConv(64, 128)
        self.enc3 = DoubleConv(128, 256)
        self.enc4 = DoubleConv(256, 512)
        
        self.pool = nn.MaxPool2d(2)
        
        # ç“¶é¢ˆå±‚
        self.bottleneck = DoubleConv(512, 1024)
        
        # è§£ç å™¨ï¼ˆä¸Šé‡‡æ ·è·¯å¾„ï¼‰
        self.up4 = nn.ConvTranspose2d(1024, 512, 2, stride=2)
        self.dec4 = DoubleConv(1024, 512)
        
        self.up3 = nn.ConvTranspose2d(512, 256, 2, stride=2)
        self.dec3 = DoubleConv(512, 256)
        
        self.up2 = nn.ConvTranspose2d(256, 128, 2, stride=2)
        self.dec2 = DoubleConv(256, 128)
        
        self.up1 = nn.ConvTranspose2d(128, 64, 2, stride=2)
        self.dec1 = DoubleConv(128, 64)
        
        # è¾“å‡ºå±‚
        self.final = nn.Conv2d(64, num_classes, 1)
    
    def forward(self, x):
        # ç¼–ç å™¨
        e1 = self.enc1(x)
        e2 = self.enc2(self.pool(e1))
        e3 = self.enc3(self.pool(e2))
        e4 = self.enc4(self.pool(e3))
        
        # ç“¶é¢ˆå±‚
        b = self.bottleneck(self.pool(e4))
        
        # è§£ç å™¨ï¼ˆå¸¦è·³è·ƒè¿æ¥ï¼‰
        d4 = self.up4(b)
        d4 = torch.cat([d4, e4], dim=1)
        d4 = self.dec4(d4)
        
        d3 = self.up3(d4)
        d3 = torch.cat([d3, e3], dim=1)
        d3 = self.dec3(d3)
        
        d2 = self.up2(d3)
        d2 = torch.cat([d2, e2], dim=1)
        d2 = self.dec2(d2)
        
        d1 = self.up1(d2)
        d1 = torch.cat([d1, e1], dim=1)
        d1 = self.dec1(d1)
        
        # è¾“å‡º
        out = self.final(d1)
        
        return out

# ä½¿ç”¨ç¤ºä¾‹
if __name__ == "__main__":
    model = UNet(in_channels=3, num_classes=1)
    
    # æ¨¡æ‹Ÿè¾“å…¥ (batch_size=4, channels=3, height=572, width=572)
    x = torch.randn(4, 3, 572, 572)
    
    # å‰å‘ä¼ æ’­
    output = model(x)
    print(f"è¾“å‡ºå½¢çŠ¶: {output.shape}")  # [4, 1, 572, 572]</code></pre>
                </div>
            </div>
        </div>
    </div>
    <!-- å›¾ç‰‡æ”¾å¤§å¼¹çª— -->
    <div id="imageModal" class="image-modal" onclick="closeImageModal()">
        <span class="image-modal-close" onclick="event.stopPropagation(); closeImageModal()">&times;</span>
        <img id="modalImage" class="image-modal-content" src="" alt="">
        <div id="modalCaption" class="image-modal-caption"></div>
    </div>
    <script>
        function openImageModal(img) {
            const modal = document.getElementById('imageModal');
            const modalImg = document.getElementById('modalImage');
            const modalCaption = document.getElementById('modalCaption');
            modal.classList.add('active');
            modalImg.src = img.src;
            modalCaption.textContent = img.alt || '';
            modalImg.onclick = function(e) { e.stopPropagation(); };
        }
        function closeImageModal() {
            document.getElementById('imageModal').classList.remove('active');
        }
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') closeImageModal();
        });
    </script>
    <!-- å…¬å…±è„šæœ¬ -->
    <script src="../common/tech-document.js"></script>
</body>
</html>

